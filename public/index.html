<!DOCTYPE html>
<html data-bs-theme="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<script nonce="gmnnonce-2025">
(function(){
  var KEY='goldmind.revision';
  var v=localStorage.getItem(KEY);
  if(!v){ v=(Math.random()<0.5)?'A':'B'; localStorage.setItem(KEY,v); }
  document.documentElement.setAttribute('data-gm-revision', v);
})();
</script>
<title>GoldMIND AI – The Trading Companion</title>

<!-- Fonts & Libraries -->
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>

<!-- Add your app styles here -->
<link href="/assets/css/styles.css?v=3" rel="stylesheet"/>

<script nonce="gmnnonce-2025">
  // Safe element updater
  function safeUpdate(id, property, value) {
    const el = document.getElementById(id);
    if (el) { el[property] = value; return true; }
    return false;
  }
</script>

<script nonce="gmnnonce-2025">(function(){
  // Define newChart always
  window.newChart = function(ctxOrElOrId, config) {
    // Resolve canvas + context
    let el=null, ctx=null;
    if (typeof ctxOrElOrId==="string") { el=document.getElementById(ctxOrElOrId); if(!el) return null; ctx=el.getContext("2d"); }
    else if (ctxOrElOrId && typeof ctxOrElOrId.getContext==="function") { el=ctxOrElOrId; ctx=el.getContext("2d"); }
    else if (ctxOrElOrId && ctxOrElOrId.canvas) { ctx=ctxOrElOrId; el=ctx.canvas; }
    if (!el || !ctx) return null;
    if (!window.Chart) { console.warn("Chart.js not loaded yet"); return null; }

    // Destroy existing chart instance for this canvas
    const prev = (window.Chart.getChart ? window.Chart.getChart(el) : el._chart) || null;
    if (prev && typeof prev.destroy==="function") { try { prev.destroy(); } catch(e) { console.debug(e); } }

    // Create chart with native constructor
    const chart = new window.Chart(ctx, config);
    if (!window.Chart.getChart) el._chart = chart; // legacy fallback
    return chart;
  };
})();
</script>

<style>
    /* ========== CSS VARIABLES - DARK MODE (DEFAULT) ========== */
    :root{
      --bg: #0b0f16; 
      --card: #121826; 
      --muted: #1a2233; 
      --text: #e8eefc; 
      --text-primary: #ffffff;
      --text-secondary: #e8eefc;
      --soft: #a9b4c7;
      --gold: #ffd700; 
      --success: #2ecc71; 
      --danger: #ff5a5f; 
      --warning: #f39c12; 
      --info: #3ab0ff;
      --shadow: 0 10px 30px rgba(0,0,0,.3);
      --form-bg: #0f1724;
      --form-border: #202b45;
      --ai-result-bg: rgba(0,0,0,0.1);
      --ai-result-border: rgba(255,255,255,0.1);
      --ai-result-text: #e8eefc;
    }

    /* ========== CSS VARIABLES - LIGHT MODE ========== */
    body.theme-light {
      --bg: linear-gradient(180deg,#f7f9fc,#eef3fb); 
      --card: #ffffff; 
      --muted: #f8f9fa; 
      --text: #162033; 
      --text-primary: #000000;
      --text-secondary: #162033;
      --soft: #6c757d;
      --gold: #ffd700; 
      --success: #2ecc71; 
      --danger: #ff5a5f; 
      --warning: #f39c12; 
      --info: #3ab0ff;
      --shadow: 0 10px 30px rgba(0,0,0,.1);
      --form-bg: #ffffff;
      --form-border: #d7e0f3;
      --ai-result-bg: rgba(255,255,255,0.8);
      --ai-result-border: rgba(0,0,0,0.1);
      --ai-result-text: #162033;
    }

    /* ========== BASE STYLES ========== */
    html,body{height:100%}
    body{
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: all 0.3s ease;
    }

    /* Dark mode background gradient */
    body:not(.theme-light) {
      background: radial-gradient(1200px 800px at 10% 0%, #0d1322 0%, #0b0f16 45%, #0a0e15 100%);
    }

    /* Light mode background */
    body.theme-light {
      background: linear-gradient(180deg,#f7f9fc,#eef3fb);
    }

    /* ========== NAVBAR ========== */
    .navbar{ 
      background: linear-gradient(90deg,#0e1423,#121a2d); 
      border-bottom: 1px solid #1b2435; 
      padding: .5rem 0; 
      transition: all 0.3s ease;
    }
    
    body.theme-light .navbar { 
      background: linear-gradient(90deg,#f0f4fb,#e8eef9); 
      border-bottom-color: #d8e1f0; 
    }

    .badge-gold{ 
      background: rgba(255,215,0,.12); 
      color: var(--gold); 
      border: 1px solid rgba(255,215,0,.35); 
    }
    
    .brand-logo{ width:130px; height:130px; }
    .brand-kicker{
      font-size:1.25rem;
      letter-spacing:.05em;
      color: var(--soft);
      text-transform:uppercase;
      font-weight: 800;
      line-height: 1.1;
    }
    .brand-sub{
      font-size:.8rem;
      color: var(--soft);
      margin-top:.1rem;
    }
    .brand-verse{
      font-size: 0.90rem;
      color: var(--soft);
      margin-top: 0.25rem;
      margin-bottom: 0.6rem;
      opacity: 0.9;
      line-height: 1.25;
    }

    .navbar .navbar-actions{ 
      display:flex; 
      align-items:center; 
      gap:.9rem; 
      flex-wrap:wrap; 
    }
    
    .form-switch{ 
      display:inline-flex; 
      align-items:center; 
      padding-left:0; 
    }
    
    .form-switch .form-check-input{ margin:0 .45rem 0 0; }
    .form-switch .form-check-label{ 
      margin:0; 
      color: var(--soft);
    }

    /* ========== CARDS & UI COMPONENTS ========== */
    .card{ 
      background: var(--card); 
      border: 1px solid #1b2538; 
      box-shadow: var(--shadow); 
      color: var(--text);
      transition: all 0.3s ease;
    }

    body.theme-light .card { 
      background: var(--card); 
      border-color: #e3eaf6; 
    }

    .card-header{ 
      background: linear-gradient(180deg,#ffd700,#e6c200); 
      color: #141414; 
      border-bottom: 1px solid #b79500; 
      font-weight: 800; 
    }
    
    body.theme-light .card-header { 
      background: linear-gradient(180deg,#ffe766,#ffd700); 
      color: #111; 
      border-bottom-color: #d7b400; 
    }

    .card-header .data-badge{ 
      font-size:.8rem; 
      padding:.2rem .5rem; 
      border-radius:999px; 
      background: rgba(255,255,255,.06); 
    }

    .text-soft{ color: var(--soft); }
    .card-title { color: var(--text-primary); }
    .card-text { color: var(--text-secondary); }

    /* ========== FORMS ========== */
    .form-control,.form-select{ 
      background: var(--form-bg); 
      color: var(--text); 
      border: 1px solid var(--form-border); 
      transition: all 0.3s ease;
    }
    
    .form-control:focus,.form-select:focus{ 
      box-shadow: 0 0 0 .25rem rgba(58,176,255,.15); 
      border-color: #3ab0ff; 
      background: var(--form-bg);
      color: var(--text);
    }

    .form-label {
      color: var(--text-primary);
      font-weight: 600;
    }

    /* ========== CHARTS ========== */
    canvas{ 
      background: #0d1422; 
      border-radius: .75rem; 
    }

    body.theme-light canvas {
      background: #f8f9fa;
    }

    .mini-label{ 
      font-size: .8rem; 
      color: var(--soft); 
    }

    /* ========== LIST GROUPS ========== */
    .list-group-item{ 
      background: transparent; 
      color: var(--text); 
      border-color: #27324b; 
      transition: all 0.3s ease;
    }
    
    body.theme-light .list-group-item { 
      background: var(--card); 
      color: var(--text); 
      border-color: #e3eaf6; 
    }

    /* ========== MODALS & OFFCANVAS ========== */
    .offcanvas{ 
      background: #0e1523; 
      color: var(--text);
      transition: all 0.3s ease;
    }

    body.theme-light .offcanvas {
      background: var(--card);
    }

    .modal-content {
      background: #0e1523 !important; 
      color: #e8eefc !important; 
      border: 1px solid #27324b !important;
    }

    body.theme-light .modal-content {
      background: var(--card) !important;
      color: var(--text) !important;
      border: 1px solid #e3eaf6 !important;
    }

    /* ========== LINKS ========== */
    .link-muted{ color: #9fb1d1; } 
    .link-muted:hover{ color: #cfe0ff; }

    body.theme-light .link-muted { color: #6c757d; }
    body.theme-light .link-muted:hover { color: #495057; }

    /* ========== FOOTER ========== */
    .footer{ color: var(--soft); }

    /* ========== BUTTONS ========== */
    .btn-gold{ 
      background: linear-gradient(135deg,#ffd700,#e6c200); 
      color: #141414; 
      border: none; 
      font-weight: 600; 
    }
    .btn-gold:hover{ 
      background: linear-gradient(135deg,#e6c200,#d4af00); 
      color: #141414; 
    }

    /* ========== MULTI-ASSET CARD STYLES ========== */
    .asset-type-card {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 193, 7, 0.05));
      border: 2px solid rgba(255, 215, 0, 0.3);
      box-shadow: 0 15px 40px rgba(255, 215, 0, 0.1);
      position: relative;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .asset-type-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 50px rgba(255, 215, 0, 0.15);
    }

    .asset-type-card.active {
      border-color: var(--gold);
      box-shadow: 0 20px 50px rgba(255, 215, 0, 0.2);
    }

    body.theme-light .asset-type-card {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.08), rgba(255, 193, 7, 0.03));
      border: 2px solid rgba(255, 215, 0, 0.2);
    }

    /* ========== DECISION ENGINE - MAIN FEATURE ========== */
    .decision-engine-card {
      background: linear-gradient(135deg, rgba(58, 176, 255, 0.1), rgba(255, 215, 0, 0.05));
      border: 2px solid rgba(58, 176, 255, 0.3);
      box-shadow: 0 20px 50px rgba(58, 176, 255, 0.15);
      position: relative;
      color: var(--text);
    }

    body.theme-light .decision-engine-card {
      background: linear-gradient(135deg, rgba(58, 176, 255, 0.08), rgba(255, 215, 0, 0.03));
      border: 2px solid rgba(58, 176, 255, 0.2);
    }

    .decision-engine-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #3ab0ff, #ffd700);
      border-radius: 8px 8px 0 0;
    }

    .decision-engine-header {
      background: linear-gradient(135deg, #3ab0ff, #2196f3);
      color: white;
      font-size: 1.25rem;
      font-weight: 800;
      text-align: center;
      padding: 1rem;
      position: relative;
    }

    .decision-engine-header::before {
      content: '🎯';
      font-size: 1.5rem;
      margin-right: 0.5rem;
    }

    /* ========== RISK MANAGEMENT STYLES ========== */
    .risk-management-card {
      background: linear-gradient(135deg, rgba(255, 90, 95, 0.1), rgba(255, 107, 107, 0.05));
      border: 2px solid rgba(255, 90, 95, 0.3);
      box-shadow: 0 15px 40px rgba(255, 90, 95, 0.1);
    }

    body.theme-light .risk-management-card {
      background: linear-gradient(135deg, rgba(255, 90, 95, 0.08), rgba(255, 107, 107, 0.03));
      border: 2px solid rgba(255, 90, 95, 0.2);
    }

    /* ========== CUSTOM INDICATORS STYLES ========== */
    .indicator-checkbox {
      background: var(--card);
      border: 2px solid var(--form-border);
      border-radius: 8px;
      padding: 0.75rem;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .indicator-checkbox:hover {
      border-color: var(--gold);
    }

    .indicator-checkbox.selected {
      border-color: var(--gold);
      background: rgba(255, 215, 0, 0.05);
    }

    /* ========== ALERT NOTIFICATION STYLES ========== */
    .alert-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      background: var(--card);
      border: 2px solid var(--warning);
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      animation: slideInRight 0.3s ease-out;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .alert-close-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: none;
      border: none;
      color: var(--soft);
      cursor: pointer;
      font-size: 1.2rem;
    }

    /* ========== AI RESULTS - FIXED COLORS ========== */
    .ai-recommendation-result {
      background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
      border: 2px solid rgba(46, 204, 113, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .ai-reasoning-result {
      background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.1));
      border: 2px solid rgba(155, 89, 182, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .ai-recommendation-result h5,
    .ai-reasoning-result h5 {
      color: var(--text-primary) !important;
      font-weight: 800;
    }

    .ai-result-text {
      color: var(--ai-result-text) !important;
      background: var(--ai-result-bg);
      border: 1px solid var(--ai-result-border);
      padding: 1rem;
      border-radius: 8px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 0.9rem;
      line-height: 1.4;
      white-space: pre-wrap;
      word-wrap: break-word;
      transition: all 0.3s ease;
    }

    /* ========== ADVANCED PREDICTIVE ANALYSIS STYLES ========== */
    .predictive-analysis-card {
      background: linear-gradient(135deg, rgba(0, 123, 255, 0.1), rgba(0, 82, 204, 0.05));
      border: 2px solid rgba(0, 123, 255, 0.3);
      box-shadow: 0 20px 50px rgba(0, 123, 255, 0.15);
      position: relative;
      color: var(--text);
    }

    body.theme-light .predictive-analysis-card {
      background: linear-gradient(135deg, rgba(0, 123, 255, 0.08), rgba(0, 82, 204, 0.03));
      border: 2px solid rgba(0, 123, 255, 0.2);
    }

    .predictive-analysis-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #007bff, #0052cc);
      border-radius: 8px 8px 0 0;
    }

    .predictive-analysis-header {
      background: linear-gradient(135deg, #007bff, #0052cc);
      color: white;
      font-size: 1.25rem;
      font-weight: 800;
      text-align: center;
      padding: 1rem;
      position: relative;
    }

    .predictive-analysis-header::before {
      content: '🔮';
      font-size: 1.5rem;
      margin-right: 0.5rem;
    }

    .prediction-card {
      background: var(--card);
      border: 1px solid var(--form-border);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    .prediction-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .prediction-confidence {
      height: 8px;
      background-color: var(--muted);
      border-radius: 4px;
      margin-top: 0.5rem;
      overflow: hidden;
    }

    .prediction-confidence-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--danger), var(--warning), var(--success));
      border-radius: 4px;
      transition: width 1s ease;
    }

    /* ========== BEHAVIOR INTELLIGENCE STYLES ========== */
    .behavior-intelligence-card {
      background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.05));
      border: 2px solid rgba(138, 43, 226, 0.3);
      box-shadow: 0 20px 50px rgba(138, 43, 226, 0.15);
      position: relative;
      color: var(--text);
    }

    body.theme-light .behavior-intelligence-card {
      background: linear-gradient(135deg, rgba(138, 43, 226, 0.08), rgba(75, 0, 130, 0.03));
      border: 2px solid rgba(138, 43, 226, 0.2);
    }

    .behavior-intelligence-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #8a2be2, #4b0082);
      border-radius: 8px 8px 0 0;
    }

    .behavior-intelligence-header {
      background: linear-gradient(135deg, #8a2be2, #4b0082);
      color: white;
      font-size: 1.25rem;
      font-weight: 800;
      text-align: center;
      padding: 1rem;
      position: relative;
    }

    .behavior-intelligence-header::before {
      content: '🧠';
      font-size: 1.5rem;
      margin-right: 0.5rem;
    }

    .behavior-pattern {
      background: var(--card);
      border: 1px solid var(--form-border);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    .behavior-pattern:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .pattern-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .pattern-bullish {
      background-color: rgba(46, 204, 113, 0.2);
      color: var(--success);
    }

    .pattern-bearish {
      background-color: rgba(231, 76, 60, 0.2);
      color: var(--danger);
    }

    .pattern-neutral {
      background-color: rgba(149, 165, 166, 0.2);
      color: var(--soft);
    }

    /* ========== MODEL INSIGHTS STYLES ========== */
    .model-insights-card {
      background: linear-gradient(135deg, rgba(255, 99, 71, 0.1), rgba(255, 69, 0, 0.05));
      border: 2px solid rgba(255, 99, 71, 0.3);
      box-shadow: 0 20px 50px rgba(255, 99, 71, 0.15);
      position: relative;
      color: var(--text);
    }

    body.theme-light .model-insights-card {
      background: linear-gradient(135deg, rgba(255, 99, 71, 0.08), rgba(255, 69, 0, 0.03));
      border: 2px solid rgba(255, 99, 71, 0.2);
    }

    .model-insights-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #ff6347, #ff4500);
      border-radius: 8px 8px 0 0;
    }

    .model-insights-header {
      background: linear-gradient(135deg, #ff6347, #ff4500);
      color: white;
      font-size: 1.25rem;
      font-weight: 800;
      text-align: center;
      padding: 1rem;
      position: relative;
    }

    .model-insights-header::before {
      content: '📊';
      font-size: 1.5rem;
      margin-right: 0.5rem;
    }

    .model-metric {
      background: var(--card);
      border: 1px solid var(--form-border);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    .model-metric:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .metric-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
    }

    .metric-label {
      font-size: 0.875rem;
      color: var(--soft);
    }

    .metric-change {
      font-size: 0.875rem;
      font-weight: 600;
    }

    .metric-change.positive {
      color: var(--success);
    }

    .metric-change.negative {
      color: var(--danger);
    }

    /* ========== FOOTER STYLES ========== */
    footer {
      background: var(--card);
      border-top: 1px solid var(--form-border);
      padding: 2rem 0;
      margin-top: 3rem;
    }

    .footer-section {
      margin-bottom: 1.5rem;
    }

    .footer-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
    }

    .footer-title i {
      margin-right: 0.5rem;
      color: var(--gold);
    }

    .footer-links {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .footer-links li {
      margin-bottom: 0.5rem;
    }

    .footer-links a {
      color: var(--soft);
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .footer-links a:hover {
      color: var(--gold);
    }

    .footer-bottom {
      border-top: 1px solid var(--form-border);
      padding-top: 1.5rem;
      margin-top: 1.5rem;
      text-align: center;
      font-size: 0.875rem;
      color: var(--soft);
    }

    .social-icons {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .social-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--muted);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--soft);
      transition: all 0.2s ease;
    }

    .social-icon:hover {
      background: var(--gold);
      color: #000;
      transform: translateY(-2px);
    }

    /* ========== RESPONSIVE DESIGN ========== */
    .small-chart{ height: 250px; }
    .medium-chart{ height: 300px; }

    @media (max-width: 576px){
      .brand-logo{ width: 84px; height: 84px; }
      .brand-kicker{ display: none; }
      
      .card-body {
        padding: 1rem 0.75rem;
      }
      
      .ai-recommendation-result,
      .ai-reasoning-result {
        padding: 1rem;
      }
      
      .ai-result-text {
        font-size: 0.8rem;
        padding: 0.75rem;
      }

      .alert-notification {
        left: 10px;
        right: 10px;
        top: 10px;
        max-width: none;
      }
    }

    @media (max-width: 768px) {
      .navbar-actions {
        gap: 0.5rem;
      }
      
      .btn-sm {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
      }
    }

    /* ========== ADDITIONAL TEXT COLOR FIXES ========== */
    .jsection-result {
      color: var(--text);
    }

    .jsection-result pre {
      color: var(--ai-result-text) !important;
    }

    /* Ensure all headings use proper contrast */
    h1, h2, h3, h4, h5, h6 {
      color: var(--text-primary);
    }

    /* Ensure all paragraph text is visible */
    p {
      color: var(--text-secondary);
    }

    /* Input placeholders */
    .form-control::placeholder,
    .form-select option {
      color: var(--soft);
    }

    body.theme-light .form-control::placeholder {
      color: #6c757d;
    }

    /* Alert styling */
    .alert {
      color: var(--text-primary);
    }

    /* Ensure buttons have proper contrast */
    .btn-outline-light {
      color: var(--text);
      border-color: var(--soft);
    }

    .btn-outline-light:hover {
      background-color: var(--soft);
      color: var(--card);
    }

    body.theme-light .btn-outline-light {
      color: var(--text);
      border-color: #6c757d;
    }

    body.theme-light .btn-outline-light:hover {
      background-color: #6c757d;
      color: white;
    }

    /* Skip to Trading button styling */
    .btn-outline-gold {
      color: var(--gold);
      border-color: var(--gold);
      text-decoration: none;
    }

    .btn-outline-gold:hover {
      background-color: var(--gold);
      color: #000;
      border-color: var(--gold);
      text-decoration: none;
    }

    .btn-outline-gold:focus,
    .btn-outline-gold:active {
      background-color: var(--gold);
      color: #000;
      border-color: var(--gold);
      box-shadow: 0 0 0 0.2rem rgba(255, 215, 0, 0.25);
    }

    /* ========== NOTIFICATION PERMISSION BANNER ========== */
    .notification-banner {
      position: fixed;
      bottom: 20px;
      left: 20px;
      right: 20px;
      background: linear-gradient(135deg, var(--info), var(--warning));
      color: white;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      animation: slideInUp 0.3s ease-out;
    }

    @keyframes slideInUp {
      from {
        transform: translateY(100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Status indicators */
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 0.5rem;
    }
    .status-active { background-color: var(--success); }
    .status-warning { background-color: var(--warning); }
    .status-error { background-color: var(--danger); }

    /* High-visibility style for the 'Test' button in Enhanced Alert Center */
    .btn-test-alert{
      font-weight: 700;
      border-width: 2px;
      border-radius: 10px;
      padding: .45rem .8rem;
      transition: box-shadow .2s, transform .05s ease-in-out;
    }
    [data-theme="light"] .btn-test-alert{
      background: #111827;
      color: #ffffff;
      border-color: #111827;
      box-shadow: 0 2px 10px rgba(17,24,39,.18);
    }
    [data-theme="dark"] .btn-test-alert{
      background: #f59e0b;
      color: #111827;
      border-color: #f59e0b;
      box-shadow: 0 2px 10px rgba(245,158,11,.28);
    }
    .btn-test-alert:hover, .btn-test-alert:focus{
      filter: brightness(1.05);
      transform: translateY(-1px);
      outline: none;
    }

    /* Remove focus ring/border from logo link and image */
    .navbar .navbar-brand,
    .navbar .navbar-brand:focus,
    .navbar .navbar-brand:focus-visible,
    .navbar .navbar-brand:active {
      outline: none !important;
      box-shadow: none !important;
    }
    .navbar .brand-logo,
    .navbar .navbar-brand img {
      border: 0 !important;
      outline: none !important;
      box-shadow: none !important;
    }
    .navbar .navbar-brand { -webkit-tap-highlight-color: transparent; }

    /* GM DISCLAIMER STYLES v1.2 START */
    :root{--gm-bg:#fff;--gm-fg:#0f172a;--gm-muted:#475569;--gm-accent:#0ea5e9;--gm-accent-600:#0284c7;--gm-ring:rgba(14,165,233,.3);--gm-shadow:rgba(2,6,23,.35)}
    @media (prefers-color-scheme: dark){:root{--gm-bg:#0b1220;--gm-fg:#e5e7eb;--gm-muted:#9ca3af;--gm-accent:#38bdf8;--gm-accent-600:#0ea5e9;--gm-ring:rgba(56,189,248,.3);--gm-shadow:rgba(0,0,0,.55)}}
    .gm-disclaimer-open{overflow:hidden!important}
    #gmDisclaimerOverlay{position:fixed;inset:0;background:rgba(2,6,23,.72);backdrop-filter:blur(2px);-webkit-backdrop-filter:blur(2px);z-index:2147483000;display:none;align-items:center;justify-content:center;padding:1rem;overflow-y:auto}
    #gmDisclaimerModal{width:100%;max-width:760px;max-height:90vh;display:flex;flex-direction:column;background:var(--gm-bg);color:var(--gm-fg);border-radius:16px;box-shadow:0 20px 50px var(--gm-shadow);border:1px solid rgba(148,163,184,.15);margin:auto}
    #gmDisclaimerHeader{padding:20px 24px;border-bottom:1px solid rgba(148,163,184,.15);flex-shrink:0}
    #gmDisclaimerTitle{margin:0;font-size:1.25rem;line-height:1.4;font-weight:700;letter-spacing:.2px}
    #gmDisclaimerBody{padding:18px 24px;font-size:.985rem;line-height:1.55;color:var(--gm-fg);overflow-y:auto;flex:1}
    #gmDisclaimerBody p{margin:0 0 .9rem 0;color:var(--gm-fg)}
    #gmDisclaimerBody .muted{color:var(--gm-muted);font-size:.95rem}
    #gmDisclaimerActions{display:flex;flex-direction:column;gap:14px;padding:18px 24px 24px;border-top:1px solid rgba(148,163,184,.15);flex-shrink:0}
    #gmAgreeBtn[disabled]{opacity:.55;cursor:not-allowed}
    #gmAgreeBtn,#gmDeclineBtn{appearance:none;border:0;border-radius:12px;padding:10px 16px;font-weight:600;font-size:.98rem;line-height:1.2;box-shadow:0 2px 8px rgba(2,6,23,.1);transition:transform .05s ease,box-shadow .2s ease;cursor:pointer}
    #gmAgreeBtn{background:var(--gm-accent);color:#fff}
    #gmAgreeBtn:not([disabled]):hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(14,165,233,.35);background:var(--gm-accent-600)}
    #gmDeclineBtn{background:transparent;border:1px solid rgba(148,163,184,.35);color:var(--gm-fg)}
    #gmDeclineBtn:hover{background:rgba(148,163,184,.08)}
    .gmRow{display:flex;align-items:flex-start;gap:10px;margin-bottom:16px}
    .gmRow input[type=checkbox]{width:18px;height:18px;margin-top:3px;accent-color:var(--gm-accent);outline:none;box-shadow:0 0 0 0 transparent;cursor:pointer;flex-shrink:0}
    .gmRow input[type=checkbox]:focus{outline:none;box-shadow:0 0 0 4px var(--gm-ring);border-radius:4px}
    #gmLegalLinks{margin-top:6px;font-size:.92rem;text-align:center}
    #gmLegalLinks a{color:var(--gm-accent);text-decoration:none}
    #gmLegalLinks a:hover{text-decoration:underline}
    .gm-button-row{display:flex;gap:12px;flex-wrap:wrap;justify-content:flex-end}
    @media (max-width:480px){
      #gmDisclaimerModal{max-height:95vh}
      #gmDisclaimerTitle{font-size:1.1rem}
      #gmDisclaimerBody{font-size:.95rem;padding:16px 20px}
      #gmAgreeBtn,#gmDeclineBtn{width:100%;padding:12px}
      .gm-button-row{flex-direction:column-reverse}
    }
    /* GM DISCLAIMER STYLES v1.2 END */

    /* Walkthrough tooltip styles - slightly larger, responsive */
    #gm-wt-tooltip {
      position: fixed;
      z-index: 2147483001 !important;
      background: rgba(15, 23, 42, 0.95) !important;
      border: 2px solid rgba(255, 215, 0, 0.5) !important;
      border-radius: 12px !important;
      padding: 1.5rem !important;
      width: min(560px, 92vw) !important;   /* was ~480px; ~+15% */
      height: auto !important;
      max-height: 72vh !important;          /* allow tall screens */
      overflow: visible !important;         /* let inner manage scroll */
    }

    /* Light mode walkthrough tooltip */
    [data-bs-theme="light"] #gm-wt-tooltip {
      background: rgba(255, 255, 255, 0.95) !important;
      border: 2px solid rgba(255, 215, 0, 0.5) !important;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3) !important;
    }

    /* Light mode content styling */
    [data-bs-theme="light"] #gm-wt-content {
      color: #0f172a !important;
    }

    /* Walkthrough content styling - column layout with scrollable body */
    #gm-wt-content {
      color: #ffffff !important;
      font-size: 0.9rem !important;
      line-height: 1.4 !important;
      height: 100% !important;
      overflow: hidden !important;
      display: flex !important;
      flex-direction: column !important;
      gap: 0.5rem !important;
    }

    /* Scrollable body section */
    #gm-wt-content .gm-wt-body {
      overflow: auto !important;
      max-height: calc(100% - 80px) !important;
    }

    /* Sticky footer with buttons */
    #gm-wt-footer {
      position: sticky !important;
      bottom: 0 !important;
      background: inherit !important;
      padding-top: 0.5rem !important;
    }

    /* Ensure buttons have proper contrast in both themes */
    #gm-wt-footer .btn {
      border-width: 1px !important;
    }

    [data-bs-theme="light"] #gm-wt-content {
      color: #0f172a !important;
    }

    #gm-wt-content h5 {
      color: #ffd700 !important;
      font-weight: 700 !important;
      margin-bottom: 0.75rem !important;
      font-size: 1.1rem !important;
    }

    [data-bs-theme="light"] #gm-wt-content h5 {
      color: #f59e0b !important;
    }

    #gm-wt-content p {
      color: #e2e8f0 !important;
      margin-bottom: 0.5rem !important;
    }

    [data-bs-theme="light"] #gm-wt-content p {
      color: #475569 !important;
    }

    #gm-wt-content strong {
      color: #ffd700 !important;
    }

    [data-bs-theme="light"] #gm-wt-content strong {
      color: #f59e0b !important;
    }

    /* Walkthrough navigation */
    #gm-wt-dots {
      display: flex !important;
      justify-content: center !important;
      align-items: center !important;
      gap: 0.5rem !important;
      margin: 0 1rem !important;
    }

    #gm-wt-dots span {
      cursor: pointer !important;
      font-size: 1.2rem !important;
      color: rgba(255, 255, 255, 0.5) !important;
      transition: all 0.2s ease !important;
    }

    [data-bs-theme="light"] #gm-wt-dots span {
      color: rgba(0, 0, 0, 0.3) !important;
    }

    #gm-wt-dots span:hover {
      color: #ffd700 !important;
      transform: scale(1.2) !important;
    }

    /* Walkthrough buttons */
    #gm-wt-prev, #gm-wt-next {
      min-width: 80px !important;
      font-weight: 600 !important;
      transition: all 0.2s ease !important;
    }

    #gm-wt-prev:hover, #gm-wt-next:hover {
      transform: translateY(-1px) !important;
    }

    /* Walkthrough highlight styles */
    .gm-wt-highlight {
      position: relative !important;
      z-index: 2147482999 !important;
      border-radius: 8px !important;
      transition: all 0.3s ease !important;
      box-shadow: 0 0 0 4px rgba(255, 215, 0, 0.5) !important;
    }

    /* Walkthrough mask */
    #gm-wt-mask {
      background: rgba(0, 0, 0, 0.7) !important;
      backdrop-filter: blur(3px) !important;
      -webkit-backdrop-filter: blur(3px) !important;
      pointer-events: auto !important;
      transition: background 0.3s ease !important;
    }

    [data-bs-theme="light"] #gm-wt-mask {
      background: rgba(0, 0, 0, 0.5) !important;
    }

    /* Walkthrough close button */
    #gm-wt-close {
      filter: brightness(0) invert(1) !important;
      opacity: 0.8 !important;
      transition: all 0.2s ease !important;
    }

    [data-bs-theme="light"] #gm-wt-close {
      filter: none !important;
      opacity: 0.6 !important;
    }

    #gm-wt-close:hover {
      opacity: 1 !important;
      transform: scale(1.1) !important;
    }

    /* Custom scrollbar for walkthrough content */
    #gm-wt-content::-webkit-scrollbar {
      width: 6px !important;
    }

    #gm-wt-content::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1) !important;
      border-radius: 3px !important;
    }

    #gm-wt-content::-webkit-scrollbar-thumb {
      background: rgba(255, 215, 0, 0.5) !important;
      border-radius: 3px !important;
    }

    #gm-wt-content::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 215, 0, 0.7) !important;
    }

    [data-bs-theme="light"] #gm-wt-content::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1) !important;
    }

    [data-bs-theme="light"] #gm-wt-content::-webkit-scrollbar-thumb {
      background: rgba(245, 158, 11, 0.5) !important;
    }

    [data-bs-theme="light"] #gm-wt-content::-webkit-scrollbar-thumb:hover {
      background: rgba(245, 158, 11, 0.7) !important;
    }

    /* Settings Panel Styles */
    .settings-section {
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--form-border);
    }
    
    .settings-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .settings-title {
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
    }
    
    .settings-title i {
      margin-right: 0.5rem;
      color: var(--gold);
    }
    
    .settings-description {
      font-size: 0.9rem;
      color: var(--soft);
      margin-bottom: 1rem;
    }

    /* Trace System Styles */
    .trace-timeline {
      position: relative;
      padding-left: 30px;
    }

    .trace-timeline::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 2px;
      background: var(--form-border);
    }

    .trace-step {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .trace-step::before {
      content: '';
      position: absolute;
      left: -34px;
      top: 0;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--gold);
    }

    .trace-step-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .trace-step-time {
      font-size: 0.8rem;
      color: var(--soft);
      margin-bottom: 0.5rem;
    }

    .trace-step-content {
      background: var(--muted);
      border-radius: 8px;
      padding: 0.75rem;
    }

    /* Model Voting Styles */
    .model-voting {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .model-vote {
      text-align: center;
      flex: 1;
    }

    .model-vote-label {
      font-size: 0.8rem;
      color: var(--soft);
      margin-bottom: 0.25rem;
    }

    .model-vote-value {
      font-size: 1.25rem;
      font-weight: 700;
    }

    .model-vote-bar {
      height: 8px;
      background: var(--muted);
      border-radius: 4px;
      margin-top: 0.5rem;
      overflow: hidden;
    }

    .model-vote-progress {
      height: 100%;
      border-radius: 4px;
    }

    .model-vote-buy {
      background: var(--success);
    }

    .model-vote-sell {
      background: var(--danger);
    }

    .model-vote-hold {
      background: var(--warning);
    }
</style>
<meta content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://api.fwvgoldmindai.com https://goldmind-api-884387776097.us-central1.run.app https://goldmind-compute-884387776097.us-central1.run.app https://fwvgoldmindai.com https://www.fwvgoldmindai.com https://admin.fwvgoldmindai.com; frame-ancestors 'self'; base-uri 'self'; form-action 'self';" http-equiv="Content-Security-Policy"/>
</head>
<body>
<!-- Notification Container for Alerts -->
<div id="notificationContainer"></div>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg sticky-top">
<div class="container-fluid px-3 px-sm-4">
<!-- Brand with larger logo + tiny kicker + presented-by -->
<a class="navbar-brand d-flex align-items-center gap-3" href="#">
<!-- Placeholder logo - replace with actual image -->
<img alt="GoldMIND AI System" class="brand-logo" src="assets/GoldMind AI logo.png"/>
<div class="d-flex flex-column">
<small class="brand-kicker">Ultimate Trading Companion</small>
<small class="brand-sub">Presented by Foster Wealth Ventures LLC</small>
<small class="brand-verse">"Commit your work to the LORD, and your plans will be established." — Prov 16:3</small>
</div>
</a>
<!-- Right-side actions (wraps on small screens) -->
<div class="ms-auto navbar-actions nav-actions d-flex align-items-center gap-2 flex-wrap" id="topActions">
<a class="btn btn-sm btn-outline-gold" href="#resolveBtn" title="Jump to trading section">⚡ Skip to Trading</a>
<button class="btn btn-sm btn-outline-light" data-bs-target="#helpModal" data-bs-toggle="modal" id="helpBtn" type="button">Help</button>
<button class="btn btn-sm btn-outline-warning" id="enableNotificationsBtn" type="button">🔔 Enable Alerts</button>
<button class="btn btn-sm btn-outline-light" id="walkthroughBtn" type="button">Walkthrough</button>
<div class="form-check form-switch m-0" title="Toggle Theme">
<input class="form-check-input" id="themeToggle" type="checkbox"/>
<label class="form-check-label text-soft" for="themeToggle">Light</label>
</div>
<button id="settingsBtn"
        class="btn btn-sm settings-btn gm-settings-btn"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#settingsPanel"
        aria-controls="settingsPanel">
  Settings
</button>

</div>
</div>
</nav>

<main class="container-fluid px-3 px-sm-4 py-4">
<div class="alert alert-danger d-none" id="globalError" role="alert"></div>

<!-- 1. MULTI-ASSET PREDICTION ENGINE -->
<section>
<h2 class="h4 fw-bold mb-3">🏆 Multi-Asset Gold Prediction Engine</h2>
<div class="row g-3 mb-4">
<div class="col-12 col-md-6 col-lg-3">
<div class="card asset-type-card h-100" data-asset-type="spot">
<div class="card-header d-flex justify-content-between align-items-center">
<span>💰 Spot Gold</span>
<span class="data-badge" id="spotGoldPrice">XAUUSD</span>
</div>
<div class="card-body">
<p class="text-soft">Current: <strong id="spotCurrentPrice">$2,045.30</strong></p>
<p class="text-soft">24h Change: <strong id="spot24hChange">+0.85%</strong></p>
<div class="mini-label">Status: <span class="badge bg-success" id="spotStatus">Active</span></div>
</div>
</div>
</div>
<div class="col-12 col-md-6 col-lg-3">
<div class="card asset-type-card h-100" data-asset-type="futures">
<div class="card-header d-flex justify-content-between align-items-center">
<span>📈 Gold Futures</span>
<span class="data-badge" id="futuresSymbol">GC</span>
</div>
<div class="card-body">
<p class="text-soft">Current: <strong id="futuresPrice">$2,048.70</strong></p>
<p class="text-soft">Volume: <strong id="futuresVolume">45,230</strong></p>
<div class="mini-label">Expiry: <span id="futuresExpiry">Dec 2024</span></div>
</div>
</div>
</div>
<div class="col-12 col-md-6 col-lg-3">
<div class="card asset-type-card h-100" data-asset-type="options">
<div class="card-header d-flex justify-content-between align-items-center">
<span>🎯 Gold Options</span>
<span class="data-badge" id="optionsSymbol">GLD</span>
</div>
<div class="card-body">
<p class="text-soft">IV Rank: <strong id="optionsIV">67%</strong></p>
<p class="text-soft">Put/Call Ratio: <strong id="putCallRatio">0.85</strong></p>
<div class="mini-label">Sentiment: <span class="badge bg-info" id="optionsSentiment">Bullish</span></div>
</div>
</div>
</div>
<div class="col-12 col-md-6 col-lg-3">
<div class="card asset-type-card h-100" data-asset-type="etfs">
<div class="card-header d-flex justify-content-between align-items-center">
<span>📊 Gold ETFs</span>
<span class="data-badge" id="etfSymbol">GLD/IAU</span>
</div>
<div class="card-body">
<p class="text-soft">GLD: <strong id="gldPrice">$188.45</strong></p>
<p class="text-soft">IAU: <strong id="iauPrice">$35.22</strong></p>
<div class="mini-label">Premium: <span id="etfPremium">-0.03%</span></div>
</div>
</div>
</div>
</div>
</section>

<!-- 2. MARKET OVERVIEW (Top Cards) - Current Status -->
<section>
<h2 class="h4 fw-bold mb-3">📊 Market Overview</h2>
<div class="row g-3 mb-4">
<div class="col-12 col-md-6 col-lg-3">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Market Status</span>
<span class="data-badge" id="badgeMarketStatus">
<span class="status-indicator status-active"></span>Active
</span>
</div>
<div class="card-body">
<p class="text-soft">Current Regime: <strong id="marketRegime">Bullish Trend</strong></p>
<p class="text-soft">Volatility Index: <strong id="marketVolatility">Medium</strong></p>
<div class="mini-label">Health: <span class="badge bg-success" id="healthStatus">Strong</span></div>
</div>
</div>
</div>
<div class="col-12 col-md-6 col-lg-3">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Today's Recommendation</span>
<span class="data-badge" id="todaySymbol">XAUUSD</span>
</div>
<div class="card-body">
<h5 class="card-title text-success" id="todayAction">BUY</h5>
<p class="text-soft">Entry: <span id="todayEntry">$2,040</span> • Target: <span id="todayTarget">$2,065</span></p>
<p class="text-soft">Confidence: <strong id="todayConfidence">82%</strong></p>
</div>
</div>
</div>
<div class="col-12 col-md-6 col-lg-3">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Risk Alert</span>
<span class="data-badge" id="biasLevel">Low</span>
</div>
<div class="card-body">
<h6 class="text-warning" id="biasHeadline">Fed Policy Uncertainty</h6>
<p class="text-soft" id="biasDetail">Monitor upcoming FOMC statements</p>
<button class="btn btn-sm btn-outline-info" id="learnMoreBias">Learn More</button>
</div>
</div>
</div>
<div class="col-12 col-md-6 col-lg-3">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Portfolio Overview</span>
<span class="data-badge" id="portfolioCcy">USD</span>
</div>
<div class="card-body">
<p class="text-soft">Current Value: <strong id="portfolioValue">$125,340</strong></p>
<p class="text-soft">Daily Change: <strong id="portfolioDailyChange">+2.15%</strong></p>
</div>
</div>
</div>
</div>
</section>

<!-- 3. PRICE PERFORMANCE + ENHANCED ALERTS -->
<section>
<h2 class="h4 fw-bold mb-3">📈 Price Performance &amp; Enhanced Alert System</h2>
<div class="row g-3 mb-4">
<div class="col-12 col-lg-8">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Gold Price Performance</span>
<div class="d-flex align-items-center gap-2">
<div class="form-check form-switch m-0">
<input checked="" class="form-check-input" id="toggleSmoothLines" type="checkbox"/>
<label class="form-check-label">Smooth lines</label>
</div>
</div>
</div>
<div class="card-body small-chart">
<canvas aria-label="Gold price chart" id="goldPriceChart" role="img"></canvas>
</div>
</div>
</div>
<div class="col-12 col-lg-4">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>🚨 Enhanced Alert Center</span>
<div class="d-flex gap-2">
<button class="btn btn-sm btn-outline-warning btn-test-alert" id="testAlert" title="Test Alert System">Test</button>
<button class="btn btn-sm btn-outline-info" id="refreshAlerts">Refresh</button>
</div>
</div>
<div class="card-body">
<div class="mb-3">
<div class="form-check form-switch">
<input checked="" class="form-check-input" id="browserNotifications" type="checkbox"/>
<label class="form-check-label text-soft">Browser Notifications</label>
</div>
<div class="form-check form-switch">
<input checked="" class="form-check-input" id="soundAlerts" type="checkbox"/>
<label class="form-check-label text-soft">Sound Alerts</label>
</div>
</div>
<ul class="list-group list-group-flush" id="alertsList">
<li class="list-group-item d-flex justify-content-between align-items-center">
<div>
<div>Price Alert <span class="badge bg-warning">Medium</span></div>
<small class="text-soft">Gold broke $2,040 resistance</small>
</div>
<small class="text-soft">2 min ago</small>
</li>
<li class="list-group-item d-flex justify-content-between align-items-center">
<div>
<div>Volume Spike</div>
<small class="text-soft">Unusual trading volume detected</small>
</div>
<small class="text-soft">5 min ago</small>
</li>
</ul>
</div>
</div>
</div>
</div>
</section>

<!-- 4. 🎯 ENHANCED DECISION ENGINE WITH RISK MANAGEMENT -->
<section>
<h2 class="h4 fw-bold mb-3">🎯 AI Decision Engine - Enhanced with Risk Management</h2>
<div class="row g-3 mb-4">
<div class="col-12">
<div class="card decision-engine-card h-100">
<div class="decision-engine-header">
Enhanced AI Decision Engine - Personalized Trading with Risk Integration
</div>
<div class="card-body">
<div class="row g-3">
<!-- Left Column: Basic Trading Info -->
<div class="col-12 col-lg-4">
<h6 class="fw-bold mb-3">📊 Trading Configuration</h6>
<div class="mb-3">
<label class="form-label fw-semibold" for="resolveUserId">User ID</label>
<input class="form-control" id="resolveUserId" placeholder="e.g. user123"/>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="selectedAssetType">Asset Type</label>
<select class="form-select" id="selectedAssetType">
<option value="spot">Spot Gold (XAUUSD)</option>
<option value="futures">Gold Futures (GC)</option>
<option value="options">Gold Options (GLD)</option>
<option value="etfs">Gold ETFs (GLD/IAU)</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="tradingStyle">Trading Style</label>
<select class="form-select" id="tradingStyle">
<option value="">Choose…</option>
<option>Day Trading</option>
<option>Swing Trading</option>
<option>Position Trading</option>
<option>Scalping</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="timeFrame">Time Frame</label>
<select class="form-select" id="timeFrame">
<option>15m</option><option>30m</option><option selected="">1h</option><option>4h</option><option>1d</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="investmentAmount">Investment Amount (USD)</label>
<input class="form-control" id="investmentAmount" min="0" placeholder="e.g. 1000" type="number"/>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="dailyGoal">Daily Profit Target (USD)</label>
<input class="form-control" id="dailyGoal" min="0" placeholder="e.g. 150" type="number"/>
</div>
</div>
<!-- Middle Column: Risk Management -->
<div class="col-12 col-lg-4">
<div class="risk-management-card p-3 h-100">
<h6 class="fw-bold mb-3">⚠️ Risk Management</h6>
<div class="mb-3">
<label class="form-label fw-semibold" for="riskTolerance">Risk Tolerance</label>
<select class="form-select" id="riskTolerance">
<option value="conservative">Conservative (1-2%)</option>
<option selected="" value="moderate">Moderate (2-5%)</option>
<option value="aggressive">Aggressive (5-10%)</option>
<option value="high_risk">High Risk (10%+)</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="maxDrawdown">Max Drawdown (%)</label>
<input class="form-control" id="maxDrawdown" max="50" min="1" type="number" value="10"/>
<div class="form-text text-soft">Maximum acceptable portfolio decline</div>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="positionSizing">Position Sizing Method</label>
<select class="form-select" id="positionSizing">
<option value="fixed_percent">Fixed % of Capital</option>
<option selected="" value="kelly">Kelly Criterion</option>
<option value="volatility_based">Volatility-Based</option>
<option value="risk_parity">Risk Parity</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="stopLossType">Stop Loss Strategy</label>
<select class="form-select" id="stopLossType">
<option value="percentage">Percentage-Based</option>
<option selected="" value="atr">ATR-Based</option>
<option value="support_resistance">Support/Resistance</option>
<option value="trailing">Trailing Stop</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="riskRewardRatio">Min Risk/Reward Ratio</label>
<select class="form-select" id="riskRewardRatio">
<option value="1:1">1:1</option>
<option selected="" value="1:2">1:2</option>
<option value="1:3">1:3</option>
<option value="1:4">1:4</option>
</select>
</div>
</div>
</div>
<!-- Right Column: Entry/Target & Execute -->
<div class="col-12 col-lg-4">
<h6 class="fw-bold mb-3">🎯 Entry &amp; Execution</h6>
<div class="mb-3">
<label class="form-label fw-semibold" for="entryPrice">Entry Price (USD)</label>
<input class="form-control" id="entryPrice" min="0" placeholder="e.g. 2035.50" step="0.01" type="number"/>
</div>
<div class="row g-2 mb-3">
<div class="col-6">
<label class="form-label fw-semibold" for="pips">Pips</label>
<input class="form-control" id="pips" placeholder="e.g. 150" type="number"/>
<div class="form-text text-soft">XAUUSD: 1 pip = $0.01</div>
</div>
<div class="col-6">
<label class="form-label fw-semibold" for="targetPrice">Target Price (USD)</label>
<input class="form-control" id="targetPrice" min="0" placeholder="auto from pips" step="0.01" type="number"/>
</div>
</div>
<div class="mb-3">
<label class="form-label fw-semibold">Recommendation Focus</label>
<div class="form-check">
<input checked="" class="form-check-input" id="focusEntry" name="recommendationFocus" type="radio" value="entry"/>
<label class="form-check-label" for="focusEntry">Entry Recommendations</label>
</div>
<div class="form-check">
<input class="form-check-input" id="focusExit" name="recommendationFocus" type="radio" value="exit"/>
<label class="form-check-label" for="focusExit">Exit Strategy</label>
</div>
<div class="form-check">
<input class="form-check-input" id="focusRisk" name="recommendationFocus" type="radio" value="risk"/>
<label class="form-check-label" for="focusRisk">Risk Management</label>
</div>
</div>
<div class="d-grid mb-3">
<button class="btn btn-gold btn-lg fs-5 fw-bold py-3" id="resolveBtn">
🧠 Get Enhanced AI Recommendation
</button>
</div>
<div class="alert alert-info p-2">
<small><strong>💡 Focus:</strong> Recommendations only - no execution. Use insights to make informed decisions in your preferred trading platform.</small>
</div>
</div>
</div>
<!-- AI Results - Enhanced Layout -->
<div class="row g-3 mt-3">
<div class="col-12 col-lg-6">
<div class="ai-recommendation-result">
<h5 class="fw-bold mb-3">🤖 Enhanced AI Analysis</h5>
<div class="jsection-result">
<pre class="ai-result-text" id="engineResult">Configure your trading preferences and risk parameters above, then click "Get Enhanced AI Recommendation" for comprehensive analysis…</pre>
</div>
</div>
</div>
<div class="col-12 col-lg-6">
<div class="ai-reasoning-result">
<div class="d-flex justify-content-between align-items-center mb-3">
<h5 class="fw-bold mb-0">🧠 Risk-Adjusted Decision Reasoning</h5>
<div class="input-group input-group-sm" style="width:180px;">
<input class="form-control" id="traceIdInput" placeholder="trace id (optional)">
<button class="btn btn-outline-light" id="loadTraceBtn">Load</button>
</div>
</div>
<div class="jsection-result">
<pre class="ai-result-text" id="traceResult">View step-by-step AI reasoning including risk management considerations…</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>

<!-- 5. ADVANCED PREDICTIVE ANALYSIS -->
<section>
<h2 class="h4 fw-bold mb-3">🔮 Advanced Predictive Analysis</h2>
<div class="row g-3 mb-4">
<div class="col-12">
<div class="card predictive-analysis-card h-100">
<div class="predictive-analysis-header">
Advanced Predictive Analysis - AI-Powered Market Forecasting
</div>
<div class="card-body">
<div class="row g-3">
<!-- LSTM Price Prediction -->
<div class="col-12 col-lg-6">
<div class="prediction-card">
<h6 class="fw-bold mb-3">📈 LSTM Price Prediction</h6>
<div class="mb-3">
<div class="row g-2">
<div class="col-6">
<label class="form-label fw-semibold" for="lstmSymbol">Symbol</label>
<input class="form-control" id="lstmSymbol" value="GLD" type="text"/>
</div>
<div class="col-6">
<label class="form-label fw-semibold" for="lstmCurrentPrice">Current Price</label>
<input class="form-control" id="lstmCurrentPrice" value="188.45" type="number" step="0.01"/>
</div>
</div>
</div>
<div class="prediction-timeline">
<div class="prediction-period mb-3">
<div class="d-flex justify-content-between align-items-center mb-1">
<span class="text-soft">1 Day Prediction:</span>
<span class="badge bg-success" id="lstm1DayDirection">UP</span>
</div>
<div class="d-flex justify-content-between align-items-center mb-1">
<span>Price:</span>
<strong id="lstm1DayPrice">$189.75</strong>
</div>
<div class="d-flex justify-content-between align-items-center">
<span>Confidence:</span>
<div class="d-flex align-items-center">
<div class="prediction-confidence flex-grow-1 me-2">
<div class="prediction-confidence-bar" style="width: 78%"></div>
</div>
<span id="lstm1DayConfidence">78%</span>
</div>
</div>
</div>
<div class="prediction-period mb-3">
<div class="d-flex justify-content-between align-items-center mb-1">
<span class="text-soft">7 Day Prediction:</span>
<span class="badge bg-success" id="lstm7DayDirection">UP</span>
</div>
<div class="d-flex justify-content-between align-items-center mb-1">
<span>Price:</span>
<strong id="lstm7DayPrice">$192.30</strong>
</div>
<div class="d-flex justify-content-between align-items-center">
<span>Confidence:</span>
<div class="d-flex align-items-center">
<div class="prediction-confidence flex-grow-1 me-2">
<div class="prediction-confidence-bar" style="width: 65%"></div>
</div>
<span id="lstm7DayConfidence">65%</span>
</div>
</div>
</div>
<div class="prediction-period">
<div class="d-flex justify-content-between align-items-center mb-1">
<span class="text-soft">30 Day Prediction:</span>
<span class="badge bg-success" id="lstm30DayDirection">UP</span>
</div>
<div class="d-flex justify-content-between align-items-center mb-1">
<span>Price:</span>
<strong id="lstm30DayPrice">$195.80</strong>
</div>
<div class="d-flex justify-content-between align-items-center">
<span>Confidence:</span>
<div class="d-flex align-items-center">
<div class="prediction-confidence flex-grow-1 me-2">
<div class="prediction-confidence-bar" style="width: 52%"></div>
</div>
<span id="lstm30DayConfidence">52%</span>
</div>
</div>
</div>
</div>
<div class="mt-3">
<button class="btn btn-sm btn-gold" id="runLstmPrediction">
Run LSTM Prediction
</button>
</div>
</div>
</div>
<!-- Bias & Sentiment Analysis -->
<div class="col-12 col-lg-6">
<div class="prediction-card">
<h6 class="fw-bold mb-3">🧠 Bias &amp; Sentiment Analysis</h6>
<div class="mb-3">
<div class="row g-2">
<div class="col-6">
<label class="form-label fw-semibold" for="sentimentScore">Sentiment Score</label>
<input class="form-control" id="sentimentScore" value="0.73" type="number" step="0.01" min="-1" max="1"/>
</div>
<div class="col-6">
<label class="form-label fw-semibold" for="sentimentLabel">Sentiment Label</label>
<select class="form-select" id="sentimentLabel">
<option value="bullish">Bullish</option>
<option value="bearish">Bearish</option>
<option value="neutral">Neutral</option>
</select>
</div>
</div>
</div>
<div class="mb-3">
<h6 class="text-soft mb-2">Bias Analysis:</h6>
<div class="row g-2">
<div class="col-6">
<div class="d-flex justify-content-between align-items-center mb-1">
<span class="text-soft">Confirmation Bias:</span>
<input class="form-control form-control-sm" id="confirmationBias" value="0.45" type="number" step="0.01" min="0" max="1" style="width: 60px;"/>
</div>
</div>
<div class="col-6">
<div class="d-flex justify-content-between align-items-center mb-1">
<span class="text-soft">Loss Aversion:</span>
<input class="form-control form-control-sm" id="lossAversion" value="0.62" type="number" step="0.01" min="0" max="1" style="width: 60px;"/>
</div>
</div>
<div class="col-6">
<div class="d-flex justify-content-between align-items-center mb-1">
<span class="text-soft">Recency Bias:</span>
<input class="form-control form-control-sm" id="recencyBias" value="0.38" type="number" step="0.01" min="0" max="1" style="width: 60px;"/>
</div>
</div>
<div class="col-6">
<div class="d-flex justify-content-between align-items-center">
<span class="text-soft">Overconfidence:</span>
<input class="form-control form-control-sm" id="overconfidence" value="0.55" type="number" step="0.01" min="0" max="1" style="width: 60px;"/>
</div>
</div>
</div>
</div>
<div class="mb-3">
<h6 class="text-soft mb-2">News Sentiment:</h6>
<div class="row g-2">
<div class="col-4">
<div class="d-flex justify-content-between align-items-center">
<span class="text-soft">Positive:</span>
<input class="form-control form-control-sm" id="newsPositive" value="68" type="number" min="0" max="100" style="width: 50px;"/>
<span class="text-soft">%</span>
</div>
</div>
<div class="col-4">
<div class="d-flex justify-content-between align-items-center">
<span class="text-soft">Neutral:</span>
<input class="form-control form-control-sm" id="newsNeutral" value="22" type="number" min="0" max="100" style="width: 50px;"/>
<span class="text-soft">%</span>
</div>
</div>
<div class="col-4">
<div class="d-flex justify-content-between align-items-center">
<span class="text-soft">Negative:</span>
<input class="form-control form-control-sm" id="newsNegative" value="10" type="number" min="0" max="100" style="width: 50px;"/>
<span class="text-soft">%</span>
</div>
</div>
</div>
</div>
<div class="mb-3">
<div class="row g-2">
<div class="col-6">
<div class="d-flex justify-content-between align-items-center mb-2">
<span class="text-soft">Social Media Buzz:</span>
<select class="form-select form-select-sm" id="socialBuzz">
<option value="low">Low</option>
<option value="medium">Medium</option>
<option value="high" selected>High</option>
</select>
</div>
</div>
<div class="col-6">
<div class="d-flex justify-content-between align-items-center mb-2">
<span class="text-soft">Institutional Flow:</span>
<input class="form-control form-control-sm" id="institutionalFlow" value="2.3" type="number" step="0.1" style="width: 60px;"/>
<span class="text-soft">B</span>
</div>
</div>
</div>
</div>
<div class="alert alert-info p-2">
<small><strong>💡 Recommendation:</strong> Detect positive bias and verify with technical analysis before making trading decisions.</small>
</div>
<div class="mt-3">
<button class="btn btn-sm btn-gold" id="runSentimentAnalysis">
Run Sentiment Analysis
</button>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>

<!-- 6. CUSTOM INDICATOR INTEGRATION -->
<section>
<h2 class="h4 fw-bold mb-3">📊 Custom Indicator Integration</h2>
<div class="row g-3 mb-4">
<div class="col-12">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>🔧 Select Active Indicators</span>
<div class="d-flex gap-2">
<button class="btn btn-sm btn-outline-success" id="selectAllIndicators">Select All</button>
<button class="btn btn-sm btn-outline-warning" id="clearAllIndicators">Clear All</button>
<button class="btn btn-sm btn-gold" id="applyIndicators">Apply Selection</button>
</div>
</div>
<div class="card-body">
<div class="row g-3" id="indicatorGrid">
<!-- Technical Indicators -->
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="sma">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_sma" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_sma">
📈 Simple Moving Average (SMA)
</label>
</div>
<small class="text-soft">20, 50, 200 period averages</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="ema">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_ema" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_ema">
📊 Exponential Moving Average (EMA)
</label>
</div>
<small class="text-soft">9, 21, 55 period EMAs</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="rsi">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_rsi" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_rsi">
⚡ Relative Strength Index (RSI)
</label>
</div>
<small class="text-soft">14-period momentum oscillator</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="macd">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_macd" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_macd">
📉 MACD
</label>
</div>
<small class="text-soft">Moving Average Convergence Divergence</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="bollinger">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_bollinger" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_bollinger">
📊 Bollinger Bands
</label>
</div>
<small class="text-soft">20-period with 2 standard deviations</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="stochastic">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_stochastic" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_stochastic">
📈 Stochastic Oscillator
</label>
</div>
<small class="text-soft">14-period %K and %D lines</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="dxy">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_dxy" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_dxy">
💵 DXY Correlation
</label>
</div>
<small class="text-soft">US Dollar Index correlation analysis</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="yields">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_yields" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_yields">
📊 Real Yields Impact
</label>
</div>
<small class="text-soft">Real interest rates impact on gold</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox" data-indicator="volume">
<div class="form-check">
<input class="form-check-input" id="ind_volume" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_volume">
📊 Volume Profile
</label>
</div>
<small class="text-soft">Volume at price levels analysis</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox" data-indicator="fibonacci">
<div class="form-check">
<input class="form-check-input" id="ind_fibonacci" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_fibonacci">
📈 Fibonacci Retracement
</label>
</div>
<small class="text-soft">Key Fibonacci levels (23.6%, 38.2%, 61.8%)</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox" data-indicator="pivot">
<div class="form-check">
<input class="form-check-input" id="ind_pivot" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_pivot">
📊 Pivot Points
</label>
</div>
<small class="text-soft">Daily, weekly, and monthly pivot levels</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox" data-indicator="ichimoku">
<div class="form-check">
<input class="form-check-input" id="ind_ichimoku" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_ichimoku">
📈 Ichimoku Cloud
</label>
</div>
<small class="text-soft">Complete Ichimoku system analysis</small>
</div>
</div>
</div>
<div class="mt-3">
<div class="card bg-transparent border-warning">
<div class="card-body p-3">
<h6 class="card-title text-warning mb-2">Selected Indicators Impact</h6>
<div id="indicatorsImpact" class="card-text text-soft mb-0">
Technical momentum signals enabled. Trend/MA filters active. USD correlation and real yields factors included.
</div>
</div>
</div>
</div>
</div>
</div>
</section>

<!-- 7. BEHAVIORAL INTELLIGENCE -->
<section>
<h2 class="h4 fw-bold mb-3">🧠 Behavioral Intelligence</h2>
<div class="row g-3 mb-4">
<div class="col-12">
<div class="card behavior-intelligence-card h-100">
<div class="behavior-intelligence-header">
Behavioral Intelligence - Understanding Trading Psychology
</div>
<div class="card-body">
<div class="row g-3">
<div class="col-12 col-lg-6">
<div class="behavior-pattern">
<h6 class="fw-bold mb-3">🧭 Cognitive Bias Influence Map</h6>
<p class="text-soft mb-3">Identifies potential psychological biases that could impact trading decisions.</p>
<div class="d-flex justify-content-between align-items-center mb-2">
<span class="text-soft">Confirmation Bias:</span>
<div class="progress flex-grow-1 ms-2" style="height: 8px;">
<div class="progress-bar bg-warning" role="progressbar" style="width: 45%" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<span class="ms-2 text-soft">45%</span>
</div>
<div class="d-flex justify-content-between align-items-center mb-2">
<span class="text-soft">Loss Aversion:</span>
<div class="progress flex-grow-1 ms-2" style="height: 8px;">
<div class="progress-bar bg-danger" role="progressbar" style="width: 62%" aria-valuenow="62" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<span class="ms-2 text-soft">62%</span>
</div>
<div class="d-flex justify-content-between align-items-center mb-2">
<span class="text-soft">Recency Bias:</span>
<div class="progress flex-grow-1 ms-2" style="height: 8px;">
<div class="progress-bar bg-info" role="progressbar" style="width: 38%" aria-valuenow="38" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<span class="ms-2 text-soft">38%</span>
</div>
<div class="d-flex justify-content-between align-items-center">
<span class="text-soft">Overconfidence:</span>
<div class="progress flex-grow-1 ms-2" style="height: 8px;">
<div class="progress-bar bg-warning" role="progressbar" style="width: 55%" aria-valuenow="55" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<span class="ms-2 text-soft">55%</span>
</div>
<div class="d-flex justify-content-between align-items-center">
<span class="text-soft">Anchoring Bias:</span>
<div class="progress flex-grow-1 ms-2" style="height: 8px;">
<div class="progress-bar bg-info" role="progressbar" style="width: 32%" aria-valuenow="32" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<span class="ms-2 text-soft">32%</span>
</div>
<div class="d-flex justify-content-between align-items-center">
<span class="text-soft">Herd Mentality:</span>
<div class="progress flex-grow-1 ms-2" style="height: 8px;">
<div class="progress-bar bg-warning" role="progressbar" style="width: 48%" aria-valuenow="48" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<span class="ms-2 text-soft">48%</span>
</div>
<div class="mt-3">
<button class="btn btn-sm btn-outline-warning" id="refreshBiasMap">
<i class="fas fa-sync-alt me-1"></i> Refresh
</button>
</div>
</div>
</div>
<div class="col-12 col-lg-6">
<div class="behavior-pattern">
<h6 class="fw-bold mb-3">📊 Trading Pattern Analysis</h6>
<p class="text-soft mb-3">Analysis of your recent trading patterns and behaviors.</p>
<div class="mb-3">
<div class="d-flex justify-content-between align-items-center mb-2">
<span class="text-soft">Pattern Recognition:</span>
<span class="pattern-badge pattern-bullish">Bullish</span>
</div>
<div class="d-flex justify-content-between align-items-center mb-2">
<span class="text-soft">Risk Profile:</span>
<span class="pattern-badge pattern-neutral">Moderate</span>
</div>
<div class="d-flex justify-content-between align-items-center">
<span class="text-soft">Decision Consistency:</span>
<span class="pattern-badge pattern-bearish">Inconsistent</span>
</div>
</div>
<div class="alert alert-info p-2">
<small><strong>💡 Insight:</strong> Your trading shows a tendency toward bullish positions but inconsistent risk management. Consider reviewing your stop-loss strategy.</small>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>

<!-- 8. MODEL INSIGHTS & CONTINUOUS LEARNING -->
<section>
<h2 class="h4 fw-bold mb-3">📊 Model Insights &amp; Continuous Learning</h2>
<div class="row g-3 mb-4">
<div class="col-12">
<div class="card model-insights-card h-100">
<div class="model-insights-header">
Model Insights & Continuous Learning - AI Improvement System
</div>
<div class="card-body">
<div class="row g-3">
<!-- Feature Importance -->
<div class="col-12 col-lg-6">
<div class="model-metric">
<h6 class="fw-bold mb-3">🎯 Feature Importance</h6>
<p class="text-soft mb-3">Top drivers behind recent predictions.</p>
<div class="mb-3">
<div class="d-flex justify-content-between align-items-center mb-2">
<span class="text-soft">RSI (14):</span>
<div class="progress flex-grow-1 ms-2" style="height: 8px;">
<div class="progress-bar bg-success" role="progressbar" style="width: 85%" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<span class="ms-2 text-soft">85%</span>
</div>
<div class="d-flex justify-content-between align-items-center mb-2">
<span class="text-soft">MACD Signal:</span>
<div class="progress flex-grow-1 ms-2" style="height: 8px;">
<div class="progress-bar bg-info" role="progressbar" style="width: 72%" aria-valuenow="72" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<span class="ms-2 text-soft">72%</span>
</div>
<div class="d-flex justify-content-between align-items-center mb-2">
<span class="text-soft">DXY Correlation:</span>
<div class="progress flex-grow-1 ms-2" style="height: 8px;">
<div class="progress-bar bg-warning" role="progressbar" style="width: 68%" aria-valuenow="68" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<span class="ms-2 text-soft">68%</span>
</div>
<div class="d-flex justify-content-between align-items-center mb-2">
<span class="text-soft">Real Yields:</span>
<div class="progress flex-grow-1 ms-2" style="height: 8px;">
<div class="progress-bar bg-danger" role="progressbar" style="width: 61%" aria-valuenow="61" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<span class="ms-2 text-soft">61%</span>
</div>
<div class="d-flex justify-content-between align-items-center">
<span class="text-soft">Volume Profile:</span>
<div class="progress flex-grow-1 ms-2" style="height: 8px;">
<div class="progress-bar bg-secondary" role="progressbar" style="width: 54%" aria-valuenow="54" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<span class="ms-2 text-soft">54%</span>
</div>
</div>
<div class="alert alert-info p-2">
<small><strong>💡 Note:</strong> Feature importance is recalculated weekly based on prediction accuracy.</small>
</div>
</div>
</div>
<!-- Trade Feedback & Learning -->
<div class="col-12 col-lg-6">
<div class="model-metric">
<h6 class="fw-bold mb-3">🔄 Trade Feedback &amp; Learning</h6>
<div class="mb-3">
<div class="form-check">
<input class="form-check-input" id="followedRecommendation" type="checkbox"/>
<label class="form-check-label" for="followedRecommendation">
Did you follow the AI recommendation?
</label>
</div>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="exitPrice">Exit Price (USD)</label>
<input class="form-control" id="exitPrice" placeholder="e.g. 2038.50" type="number"/>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="tradeNotes">Trade Outcome &amp; Notes</label>
<textarea class="form-control" id="tradeNotes" rows="3" placeholder="Describe the trade outcome and any relevant observations..."></textarea>
</div>
<div class="d-grid">
<button class="btn btn-gold" id="submitLearningData">
Submit Learning Data
</button>
</div>
<div class="mt-3">
<h6 class="text-soft mb-2">Recent Feedback Summary</h6>
<div class="d-flex justify-content-between align-items-center mb-1">
<span class="text-soft">Follow Rate:</span>
<span class="metric-value">78%</span>
</div>
<div class="d-flex justify-content-between align-items-center mb-1">
<span class="text-soft">Avg P&amp;L When Followed:</span>
<span class="metric-change positive">+2.3%</span>
</div>
<div class="d-flex justify-content-between align-items-center">
<span class="text-soft">Model Accuracy:</span>
<span class="metric-change positive">+0.8%</span>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>

</main>

<!-- Footer -->
<footer>
<div class="container-fluid px-3 px-sm-4">
<div class="row">
<div class="col-12 col-md-4 footer-section">
<div class="footer-title">
<i class="fas fa-chart-line"></i> GoldMIND AI
</div>
<p class="text-soft">Advanced AI-powered trading companion for gold market analysis and prediction.</p>
<div class="social-icons">
<a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
<a href="#" class="social-icon"><i class="fab fa-linkedin"></i></a>
<a href="#" class="social-icon"><i class="fab fa-telegram"></i></a>
<a href="#" class="social-icon"><i class="fab fa-discord"></i></a>
</div>
</div>
<div class="col-12 col-md-4 footer-section">
<div class="footer-title">
<i class="fas fa-link"></i> Quick Links
</div>
<ul class="footer-links">
<li><a href="#">Documentation</a></li>
<li><a href="#">API Reference</a></li>
<li><a href="#">Tutorials</a></li>
<li><a href="#">Community Forum</a></li>
</ul>
</div>
<div class="col-12 col-md-4 footer-section">
<div class="footer-title">
<i class="fas fa-envelope"></i> Contact
</div>
<p class="text-soft">support@goldmindai.com</p>
<p class="text-soft">Foster Wealth Ventures LLC</p>
</div>
</div>
<div class="footer-bottom">
<p class="mb-0">&copy; 2024 GoldMIND AI. All rights reserved. | <a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a></p>
</div>
</div>
</footer>

<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="helpModalLabel">GoldMIND AI Help Center</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
  <div class="mb-3">
    <h5 class="text-primary mb-3">GoldMIND AI – Enhanced Features Guide</h5>

    <ol class="mb-4" style="padding-left: 1.2rem;">
      <li class="mb-2"><strong>🏆 Multi-Asset Gold Prediction:</strong> Unified analysis across spot gold, futures, options, and ETFs with integrated risk tolerance.</li>

      <li class="mb-2"><strong>📊 Market Overview:</strong> Real-time market status, AI recommendations, bias alerts, and portfolio overview.</li>

      <li class="mb-2"><strong>🚨 Enhanced Alert System:</strong> Sophisticated browser notifications with sound alerts for price movements, volatility spikes, and news events.</li>

      <li class="mb-2"><strong>🎯 Enhanced Decision Engine:</strong> Advanced AI with integrated risk management including drawdown limits, position sizing, and risk tolerance.</li>

      <li class="mb-2"><strong>📈 Custom Indicator Integration:</strong> Select which technical and gold-specific indicators influence AI recommendations.</li>

      <li class="mb-2"><strong>🔮 Advanced Analysis:</strong> LSTM predictions and sentiment analysis with enhanced accuracy.</li>

      <li class="mb-2"><strong>🧠 Behavioral Intelligence:</strong> Cognitive bias mapping and transparent reasoning processes.</li>

      <li class="mb-2"><strong>📚 Continuous Learning:</strong> Enhanced feedback system that improves recommendations based on real trading outcomes.</li>
    </ol>

    <div class="alert alert-info">
      <strong>💡 Key Enhancement:</strong> This system focuses on providing sophisticated recommendations rather than trade execution. Use these insights to make informed decisions in your preferred trading platform.
    </div>
  </div>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

<!-- Settings Panel -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="settingsPanel" aria-labelledby="settingsPanelLabel">
<div class="offcanvas-header">
<h5 class="offcanvas-title" id="settingsPanelLabel">Settings</h5>
<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
</div>
<div class="offcanvas-body">
<div class="settings-section">
<div class="settings-title">
<i class="fas fa-user"></i> Account Settings
</div>
<p class="settings-description">Manage your account preferences and profile information.</p>
<div class="mb-3">
<label class="form-label">Display Name</label>
<input type="text" class="form-control" placeholder="Your name">
</div>
<div class="mb-3">
<label class="form-label">Email</label>
<input type="email" class="form-control" placeholder="your@email.com">
</div>
</div>
<div class="settings-section">
<div class="settings-title">
<i class="fas fa-bell"></i> Notification Settings
</div>
<p class="settings-description">Configure how and when you receive notifications.</p>
<div class="form-check form-switch mb-3">
<input class="form-check-input" id="priceAlerts" type="checkbox" checked>
<label class="form-check-label" for="priceAlerts">Price Alerts</label>
</div>
<div class="form-check form-switch mb-3">
<input class="form-check-input" id="predictionAlerts" type="checkbox" checked>
<label class="form-check-label" for="predictionAlerts">Prediction Updates</label>
</div>
<div class="form-check form-switch mb-3">
<input class="form-check-input" id="dailySummary" type="checkbox">
<label class="form-check-label" for="dailySummary">Daily Summary</label>
</div>
<div class="mb-3">
<label class="form-label fw-semibold">Alert Frequency</label>
<select class="form-select" id="alertFrequency">
<option value="realtime">Real-time</option>
<option value="5min">Every 5 minutes</option>
<option value="15min" selected>Every 15 minutes</option>
<option value="1hour">Every hour</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold">Price Change Threshold (%)</label>
<input class="form-control" id="priceThreshold" type="number" value="2" min="0.5" max="10" step="0.5">
<div class="form-text text-soft">Alert when price changes by this percentage</div>
</div>
<div class="form-check form-switch mb-3">
<input class="form-check-input" id="volatilityAlerts" type="checkbox" checked>
<label class="form-check-label" for="volatilityAlerts">Volatility Alerts</label>
</div>
<div class="form-check form-switch mb-3">
<input class="form-check-input" id="economicNewsAlerts" type="checkbox">
<label class="form-check-label" for="economicNewsAlerts">Economic News Alerts</label>
</div>
</div>
<div class="settings-section">
<div class="settings-title">
<i class="fas fa-chart-line"></i> Trading Preferences
</div>
<p class="settings-description">Set your default trading parameters.</p>
<div class="mb-3">
<label class="form-label">Default Asset Type</label>
<select class="form-select">
<option value="spot">Spot Gold (XAUUSD)</option>
<option value="futures">Gold Futures (GC)</option>
<option value="options">Gold Options (GLD)</option>
<option value="etfs">Gold ETFs (GLD/IAU)</option>
</select>
</div>
<div class="mb-3">
<label class="form-label">Default Time Frame</label>
<select class="form-select">
<option value="15m">15m</option>
<option value="30m">30m</option>
<option value="1h" selected>1h</option>
<option value="4h">4h</option>
<option value="1d">1d</option>
</select>
</div>
</div>
<div class="d-grid">
  <button class="btn btn-gold" id="saveSettingsBtn">Save Settings</button>
</div>
</div>
</div>

<!-- Disclaimer Modal -->
<div id="gmDisclaimerOverlay">
<div id="gmDisclaimerModal">
<div id="gmDisclaimerHeader">
<h2 id="gmDisclaimerTitle">GoldMIND AI Disclaimer</h2>
</div>
<div id="gmDisclaimerBody">
  <p>Welcome to GoldMIND AI. GoldMIND is a trading companion that offers research and model-generated recommendations for educational purposes to help you analyze markets and strengthen your trading process.</p>

  <p>GoldMIND AI is not a broker-dealer, investment adviser, or fiduciary. All market data, analytics, and recommendations are provided for educational and informational purposes only.</p>

  <p><strong>Behavioral & Bias Awareness:</strong> GoldMIND may highlight potential psychological/behavioral trading biases (e.g., confirmation bias, loss aversion, anchoring, recency, overconfidence) inferred from your inputs and settings. These are heuristic indicators intended to encourage self-reflection and discipline; they are not diagnoses, clinical advice, or guarantees of performance.</p>

  <p>This platform does not execute trades, place orders, or simulate trading activity, and it does not connect to any brokerage account.</p>

  <p>The insights and recommendations generated by GoldMIND AI should not be interpreted as personalized financial advice or a recommendation to buy or sell any security. You are solely responsible for your investment decisions and outcomes.</p>

  <p>By selecting "I Agree," you confirm that you understand and accept these terms.</p>

  <div class="gmRow">
    <input type="checkbox" id="gmAcknowledge">
    <label for="gmAcknowledge">I understand GoldMIND AI is a trading companion offering research and recommendations (including bias-awareness indicators) for educational purposes only, and not financial advice.</label>
  </div>
</div>
<div id="gmDisclaimerActions">
<div class="gm-button-row">
<button id="gmDeclineBtn">Decline & Exit</button>
<button id="gmAgreeBtn" disabled>I Agree & Continue</button>
</div>
</div>
<div id="gmLegalLinks">
<a href="#" target="_blank">Privacy Policy</a> | <a href="#" target="_blank">Terms of Service</a>
</div>
</div>
</div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script nonce="gmnnonce-2025">
// Theme Toggle
(() => {
  const STORAGE_KEY = "gm-theme";
  const getStored = () => localStorage.getItem(STORAGE_KEY);
  const getPreferred = () => window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
  
  const applyTheme = (theme) => {
    const root = document.documentElement;
    const body = document.body;
    
    // For Bootstrap 5.3 components
    root.setAttribute("data-bs-theme", theme);
    // For our CSS blocks using [data-theme="light"/"dark"]
    root.setAttribute("data-theme", theme);
    // For our CSS blocks using body.theme-light
    if (theme === "light") {
      body.classList.add("theme-light");
    } else {
      body.classList.remove("theme-light");
    }
    
    // Sync UI
    const toggle = document.getElementById("themeToggle");
    if (toggle) {
      toggle.checked = (theme === "dark");
      toggle.setAttribute("aria-checked", String(theme === "dark"));
    }
    
    const label = document.querySelector('label[for="themeToggle"]');
    if (label) label.textContent = theme === "dark" ? "Dark" : "Light";
  };
  
  const init = () => {
    const theme = getStored() || getPreferred();
    applyTheme(theme);
    
    const toggle = document.getElementById("themeToggle");
    if (toggle) {
      toggle.addEventListener("change", () => {
        const next = toggle.checked ? "dark" : "light";
        localStorage.setItem(STORAGE_KEY, next);
        applyTheme(next);
      });
    }
  };
  
  // React to OS changes if user hasn't chosen manually
  const mq = window.matchMedia("(prefers-color-scheme: dark)");
  mq.addEventListener("change", (e) => {
    if (!getStored()) {
      applyTheme(e.matches ? "dark" : "light");
    }
  });
  
  // Initialize when DOM is ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }

  // Settings persistence
  (() => {
    const SETTINGS_KEY = "goldmind.settings.notifications";

    // Load settings from localStorage
    const loadSettings = () => {
      const stored = localStorage.getItem(SETTINGS_KEY);
      if (stored) {
        try {
          return JSON.parse(stored);
        } catch (e) {
          console.warn("Failed to parse stored settings:", e);
        }
      }
      return {};
    };

    // Save settings to localStorage
    const saveSettings = (settings) => {
      localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
    };

    // Initialize settings on page load
    const initSettings = () => {
      const settings = loadSettings();

      // Apply settings to form elements
      const priceAlerts = document.getElementById("priceAlerts");
      const predictionAlerts = document.getElementById("predictionAlerts");
      const dailySummary = document.getElementById("dailySummary");
      const alertFrequency = document.getElementById("alertFrequency");
      const priceThreshold = document.getElementById("priceThreshold");
      const volatilityAlerts = document.getElementById("volatilityAlerts");
      const economicNewsAlerts = document.getElementById("economicNewsAlerts");

      if (priceAlerts && settings.priceAlerts !== undefined) {
        priceAlerts.checked = settings.priceAlerts;
      }
      if (predictionAlerts && settings.predictionAlerts !== undefined) {
        predictionAlerts.checked = settings.predictionAlerts;
      }
      if (dailySummary && settings.dailySummary !== undefined) {
        dailySummary.checked = settings.dailySummary;
      }
      if (alertFrequency && settings.alertFrequency) {
        alertFrequency.value = settings.alertFrequency;
      }
      if (priceThreshold && settings.priceThreshold) {
        priceThreshold.value = settings.priceThreshold;
      }
      if (volatilityAlerts && settings.volatilityAlerts !== undefined) {
        volatilityAlerts.checked = settings.volatilityAlerts;
      }
      if (economicNewsAlerts && settings.economicNewsAlerts !== undefined) {
        economicNewsAlerts.checked = settings.economicNewsAlerts;
      }
    };

    // Save settings when form changes
    const setupSettingsListeners = () => {
      const saveSettingsBtn = document.getElementById("saveSettingsBtn");
      if (saveSettingsBtn) {
        saveSettingsBtn.addEventListener("click", () => {
          const settings = {
            priceAlerts: document.getElementById("priceAlerts")?.checked ?? true,
            predictionAlerts: document.getElementById("predictionAlerts")?.checked ?? true,
            dailySummary: document.getElementById("dailySummary")?.checked ?? false,
            alertFrequency: document.getElementById("alertFrequency")?.value ?? "15min",
            priceThreshold: document.getElementById("priceThreshold")?.value ?? "2",
            volatilityAlerts: document.getElementById("volatilityAlerts")?.checked ?? true,
            economicNewsAlerts: document.getElementById("economicNewsAlerts")?.checked ?? false
          };

          saveSettings(settings);

          // Show success notification
          if (typeof showNotification === 'function') {
            showNotification("Settings Saved", "Your notification preferences have been saved.");
          }
        });
      }
    };

    // Initialize settings when DOM is ready
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", () => {
        initSettings();
        setupSettingsListeners();
      });
    } else {
      initSettings();
      setupSettingsListeners();
    }
  })();
})();

// Notification System
(() => {
  // Check for notification permission
  const checkNotificationPermission = () => {
    if ("Notification" in window) {
      if (Notification.permission === "default") {
        const notificationBanner = document.createElement("div");
        notificationBanner.className = "notification-banner";
        notificationBanner.innerHTML = `
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>Enable Notifications</strong>
              <p class="mb-0">Stay updated with price alerts and trading signals</p>
            </div>
            <div>
              <button class="btn btn-light btn-sm me-2" id="enableNotifications">Enable</button>
              <button class="btn btn-outline-light btn-sm" id="dismissNotifications">Dismiss</button>
            </div>
          </div>
        `;
        document.body.appendChild(notificationBanner);
        
        document.getElementById("enableNotifications").addEventListener("click", () => {
          Notification.requestPermission().then(permission => {
            if (permission === "granted") {
              showNotification("Notifications Enabled", "You will now receive price alerts and trading signals.");
            }
            notificationBanner.remove();
          });
        });
        
        document.getElementById("dismissNotifications").addEventListener("click", () => {
          notificationBanner.remove();
        });
      }
    }
  };
  
  // Show notification
  const showNotification = (title, body) => {
    if ("Notification" in window && Notification.permission === "granted") {
      new Notification(title, { body, icon: "assets/GoldMind AI logo.png" });
    }
  };
  
  // Initialize notification system
  checkNotificationPermission();
  
  // Test alert button
  const testAlertBtn = document.getElementById("testAlert");
  if (testAlertBtn) {
    // Disable test button if notifications are blocked
    const updateTestButtonState = () => {
      if ("Notification" in window) {
        testAlertBtn.disabled = Notification.permission === "denied";
      }
    };

    // Initial state check
    updateTestButtonState();

    // Update state when permission changes
    if ("Notification" in window) {
      Notification.requestPermission().then(updateTestButtonState);
    }

    testAlertBtn.addEventListener("click", () => {
      if ("Notification" in window && Notification.permission === "granted") {
        showNotification("Test Alert", "This is a test notification from GoldMIND AI.");

        // Add to alerts list
        const alertsList = document.getElementById("alertsList");
        if (alertsList) {
          const alertItem = document.createElement("li");
          alertItem.className = "list-group-item d-flex justify-content-between align-items-center";
          alertItem.innerHTML = `
            <div>
              <div>Test Alert <span class="badge bg-info">Info</span></div>
              <small class="text-soft">This is a test notification</small>
            </div>
            <small class="text-soft">Just now</small>
          `;
          alertsList.insertBefore(alertItem, alertsList.firstChild);
        }
      } else if ("Notification" in window && Notification.permission === "denied") {
        // Show banner prompting user to enable notifications
        const banner = document.createElement("div");
        banner.className = "notification-banner";
        banner.innerHTML = `
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>Enable Notifications Required</strong>
              <p class="mb-0">Please enable notifications in your browser settings to receive alerts</p>
            </div>
            <div>
              <button class="btn btn-light btn-sm" id="enableFromBanner">Enable</button>
              <button class="btn btn-outline-light btn-sm" id="dismissBanner">Dismiss</button>
            </div>
          </div>
        `;
        document.body.appendChild(banner);

        document.getElementById("enableFromBanner")?.addEventListener("click", () => {
          Notification.requestPermission().then(permission => {
            if (permission === "granted") {
              banner.remove();
              updateTestButtonState();
            }
          });
        });

        document.getElementById("dismissBanner")?.addEventListener("click", () => {
          banner.remove();
        });
      }
    });
  }
  
  // Enable notifications button
  const enableNotificationsBtn = document.getElementById("enableNotificationsBtn");
  if (enableNotificationsBtn) {
    enableNotificationsBtn.addEventListener("click", () => {
      if ("Notification" in window) {
        Notification.requestPermission().then(permission => {
          if (permission === "granted") {
            showNotification("Notifications Enabled", "You will now receive price alerts and trading signals.");
            enableNotificationsBtn.classList.add("d-none");

            // Persist alerts enabled state
            localStorage.setItem("goldmind.alerts.enabled", "true");
          }
        });
      }
    });
  }

  // Check if alerts were previously enabled and hide button
  if (localStorage.getItem("goldmind.alerts.enabled") === "true") {
    if (enableNotificationsBtn) {
      enableNotificationsBtn.classList.add("d-none");
    }
  }
})();

// Initialize Chart
(() => {
  const ctx = document.getElementById('goldPriceChart');
  if (ctx) {
    // Generate sample data
    const labels = [];
    const data = [];
    const now = new Date();
    
    for (let i = 30; i >= 0; i--) {
      const date = new Date(now);
      date.setDate(date.getDate() - i);
      labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
      
      // Generate sample price data with some randomness
      const basePrice = 2040;
      const variation = Math.sin(i / 5) * 10 + Math.random() * 5 - 2.5;
      data.push(basePrice + variation);
    }
    
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Gold Price (USD)',
          data: data,
          borderColor: '#ffd700',
          backgroundColor: 'rgba(255, 215, 0, 0.1)',
          borderWidth: 2,
          tension: 0.4,
          fill: true,
          pointRadius: 0,
          pointHoverRadius: 5,
          pointHoverBackgroundColor: '#ffd700'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            mode: 'index',
            intersect: false,
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            titleColor: '#fff',
            bodyColor: '#fff',
            borderColor: '#ffd700',
            borderWidth: 1,
            padding: 10,
            displayColors: false,
            callbacks: {
              label: function(context) {
                return `Price: $${context.parsed.y.toFixed(2)}`;
              }
            }
          }
        },
        scales: {
          x: {
            grid: {
              display: false
            },
            ticks: {
              color: '#a9b4c7',
              maxRotation: 0,
              autoSkip: true,
              maxTicksLimit: 8
            }
          },
          y: {
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: '#a9b4c7',
              callback: function(value) {
                return '$' + value.toFixed(0);
              }
            }
          }
        },
        interaction: {
          mode: 'nearest',
          axis: 'x',
          intersect: false
        }
      }
    });
    
    // Toggle smooth lines
    const toggleSmoothLines = document.getElementById('toggleSmoothLines');
    if (toggleSmoothLines) {
      toggleSmoothLines.addEventListener('change', function() {
        const chart = Chart.getChart(ctx);
        if (chart) {
          chart.data.datasets[0].tension = this.checked ? 0.4 : 0;
          chart.update();
        }
      });
    }
  }
})();

// Asset Type Cards
(() => {
  const assetCards = document.querySelectorAll('.asset-type-card');
  assetCards.forEach(card => {
    card.addEventListener('click', function() {
      // Remove active class from all cards
      assetCards.forEach(c => c.classList.remove('active'));
      // Add active class to clicked card
      this.classList.add('active');
      
      // Update selected asset type in decision engine
      const assetType = this.getAttribute('data-asset-type');
      const assetSelect = document.getElementById('selectedAssetType');
      if (assetSelect) {
        assetSelect.value = assetType;
      }
    });
  });
})();

// Indicator Selection
(() => {
  const indicatorCheckboxes = document.querySelectorAll('.indicator-checkbox');
  const selectAllBtn = document.getElementById('selectAllIndicators');
  const clearAllBtn = document.getElementById('clearAllIndicators');
  const applyBtn = document.getElementById('applyIndicators');
  const indicatorsImpact = document.getElementById('indicatorsImpact');
  
  // Function to update indicators impact text
  const updateIndicatorsImpact = () => {
    const selectedIndicators = [];
    indicatorCheckboxes.forEach(checkbox => {
      const input = checkbox.querySelector('input[type="checkbox"]');
      if (input.checked) {
        selectedIndicators.push(checkbox.getAttribute('data-indicator'));
      }
    });
    
    if (selectedIndicators.length === 0) {
      indicatorsImpact.textContent = 'No indicators selected. Please select at least one indicator for analysis.';
      return;
    }
    
    let impactText = 'Technical analysis includes: ';
    
    // Group indicators by type
    const technicalIndicators = [];
    const goldSpecificIndicators = [];
    const advancedIndicators = [];
    
    selectedIndicators.forEach(indicator => {
      if (['sma', 'ema', 'rsi', 'macd', 'bollinger', 'stochastic'].includes(indicator)) {
        technicalIndicators.push(indicator);
      } else if (['dxy', 'yields'].includes(indicator)) {
        goldSpecificIndicators.push(indicator);
      } else {
        advancedIndicators.push(indicator);
      }
    });
    
    // Build impact text based on selected indicators
    if (technicalIndicators.length > 0) {
      if (technicalIndicators.includes('sma') || technicalIndicators.includes('ema')) {
        impactText += 'trend analysis with moving averages';
      }
      if (technicalIndicators.includes('rsi')) {
        impactText += ', momentum signals from RSI';
      }
      if (technicalIndicators.includes('macd')) {
        impactText += ', MACD divergence detection';
      }
      if (technicalIndicators.includes('bollinger')) {
        impactText += ', volatility bands';
      }
      if (technicalIndicators.includes('stochastic')) {
        impactText += ', stochastic oscillator';
      }
    }
    
    if (goldSpecificIndicators.length > 0) {
      if (goldSpecificIndicators.includes('dxy')) {
        impactText += ', USD correlation factors';
      }
      if (goldSpecificIndicators.includes('yields')) {
        impactText += ', real yields impact';
      }
    }
    
    if (advancedIndicators.length > 0) {
      if (advancedIndicators.includes('volume')) {
        impactText += ', volume profile analysis';
      }
      if (advancedIndicators.includes('fibonacci')) {
        impactText += ', Fibonacci retracement levels';
      }
      if (advancedIndicators.includes('pivot')) {
        impactText += ', pivot point support/resistance';
      }
      if (advancedIndicators.includes('ichimoku')) {
        impactText += ', Ichimoku cloud signals';
      }
    }
    
    impactText += '. ';
    
    // Add confidence level based on number of indicators
    if (selectedIndicators.length >= 8) {
      impactText += 'High confidence with comprehensive multi-factor analysis.';
    } else if (selectedIndicators.length >= 5) {
      impactText += 'Moderate to high confidence with balanced indicator mix.';
    } else {
      impactText += 'Basic analysis. Consider adding more indicators for higher confidence.';
    }
    
    indicatorsImpact.textContent = impactText;
  };
  
  // Handle checkbox clicks
  indicatorCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('click', function() {
      const input = this.querySelector('input[type="checkbox"]');
      input.checked = !input.checked;
      
      if (input.checked) {
        this.classList.add('selected');
      } else {
        this.classList.remove('selected');
      }
      
      updateIndicatorsImpact();
    });
  });
  
  // Select all indicators
  if (selectAllBtn) {
    selectAllBtn.addEventListener('click', function() {
      indicatorCheckboxes.forEach(checkbox => {
        const input = checkbox.querySelector('input[type="checkbox"]');
        input.checked = true;
        checkbox.classList.add('selected');
      });
      updateIndicatorsImpact();
    });
  }
  
  // Clear all indicators
  if (clearAllBtn) {
    clearAllBtn.addEventListener('click', function() {
      indicatorCheckboxes.forEach(checkbox => {
        const input = checkbox.querySelector('input[type="checkbox"]');
        input.checked = false;
        checkbox.classList.remove('selected');
      });
      updateIndicatorsImpact();
    });
  }
  
  // Apply indicator selection
  if (applyBtn) {
    applyBtn.addEventListener('click', function() {
      const selectedIndicators = [];
      indicatorCheckboxes.forEach(checkbox => {
        const input = checkbox.querySelector('input[type="checkbox"]');
        if (input.checked) {
          selectedIndicators.push(checkbox.getAttribute('data-indicator'));
        }
      });
      
      // Show notification
      if (typeof showNotification === 'function') {
        showNotification('Indicators Updated', `${selectedIndicators.length} indicators have been applied to your analysis.`);
      }
      
      updateIndicatorsImpact();
    });
  }
  
  // Initialize impact text
  updateIndicatorsImpact();
})();

// AI Decision Engine
(() => {
  const resolveBtn = document.getElementById('resolveBtn');
  const engineResult = document.getElementById('engineResult');
  const traceResult = document.getElementById('traceResult');
  const loadTraceBtn = document.getElementById('loadTraceBtn');
  const traceIdInput = document.getElementById('traceIdInput');
  
  // Generate AI recommendation
  if (resolveBtn) {
    resolveBtn.addEventListener('click', function() {
      // Show loading state
      if (engineResult) {
        engineResult.textContent = 'Analyzing market data and generating recommendation...';
      }
      
      // Simulate API call
      setTimeout(() => {
        // Generate sample recommendation
        const recommendation = `
RECOMMENDATION: BUY XAUUSD
ENTRY: $2,042.50
STOP LOSS: $2,037.00
TAKE PROFIT: $2,055.00
RISK/REWARD: 1:2.5
CONFIDENCE: 78%

REASONING:
- RSI (14) at 42.3 indicating oversold conditions
- Price approaching key support at $2,040
- MACD showing bullish divergence
- DXY weakening, supporting gold prices
- Real yields declining, positive for gold

RISK CONSIDERATIONS:
- Fed policy uncertainty remains high
- Upcoming CPI data may impact volatility
- Consider position sizing based on your risk tolerance

NEXT STEPS:
1. Monitor price action at $2,040 support level
2. Consider scaling in if price holds above support
3. Set stop loss below $2,037 for risk management
4. Take partial profits at $2,050 if reached
        `;
        
        if (engineResult) {
          engineResult.textContent = recommendation;
        }
        
        // Generate sample reasoning trace
        const trace = `
STEP 1: MARKET ANALYSIS
- Analyzed 30-day price history for XAUUSD
- Identified key support/resistance levels
- Assessed current market regime: Bullish with correction

STEP 2: TECHNICAL INDICATORS
- RSI (14): 42.3 (oversold, bullish signal)
- MACD: Bullish divergence detected
- Moving Averages: Price above 50-day MA, below 200-day MA
- Volume: Average, no significant anomalies

STEP 3: FUNDAMENTAL FACTORS
- DXY Index: Weakening trend (-0.8% today)
- Real Yields: Declining (-2bps today)
- Fed Policy: Uncertainty high, but no immediate changes expected
- Geopolitical: Elevated tensions supporting safe-haven demand

STEP 4: RISK ASSESSMENT
- Market Volatility: Medium (VIX at 18.5)
- Liquidity: High for XAUUSD
- Event Risk: Moderate (CPI data this week)
- Technical Risk: Low (clear support/resistance levels)

STEP 5: POSITION SIZING
- Recommended Risk: 2% of portfolio
- Position Size: Based on Kelly Criterion
- Stop Loss: $2,037 (0.27% below entry)
- Take Profit: $2,055 (1.2% above entry)

STEP 6: FINAL RECOMMENDATION
- Signal: BUY
- Confidence: 78%
- Time Horizon: 3-5 days
- Risk/Reward: 1:2.5
        `;
        
        if (traceResult) {
          traceResult.textContent = trace;
        }
        
        // Show notification
        if (typeof showNotification === 'function') {
          showNotification('Analysis Complete', 'Your AI recommendation is ready. Review the analysis before making trading decisions.');
        }
      }, 2000);
    });
  }
  
  // Load trace by ID
  if (loadTraceBtn && traceIdInput) {
    loadTraceBtn.addEventListener('click', function() {
      const traceId = traceIdInput.value.trim();
      if (traceId) {
        if (traceResult) {
          traceResult.textContent = `Loading trace for ID: ${traceId}...`;
        }
        
        // Simulate API call
        setTimeout(() => {
          if (traceResult) {
            traceResult.textContent = `Trace ID: ${traceId}\n\nThis is a <strong>sample trace</strong> for demonstration purposes. In a production environment, this would load the actual reasoning trace for the specified ID.

<strong>Processing Time Breakdown:</strong>
• Data Ingestion: 120ms
• Feature Processing: 340ms
• Model Inference: 680ms
• Risk Integration: 110ms
• Validation: 45ms
• Total: 1.295s

<strong>Model Voting Results:</strong>
• Model 1: BUY (Weight: 0.32)
• Model 2: BUY (Weight: 0.28)
• Model 3: HOLD (Weight: 0.18)
• Model 4: BUY (Weight: 0.14)
• Model 5: BUY (Weight: 0.08)
• <strong>Consensus: BUY</strong>
          `;
          }
        }, 1000);
      }
    });
  }
})();

// LSTM Prediction
(() => {
  const runLstmBtn = document.getElementById('runLstmPrediction');
  const lstmSymbol = document.getElementById('lstmSymbol');
  const lstmCurrentPrice = document.getElementById('lstmCurrentPrice');
  const lstm1DayPrice = document.getElementById('lstm1DayPrice');
  const lstm7DayPrice = document.getElementById('lstm7DayPrice');
  const lstm30DayPrice = document.getElementById('lstm30DayPrice');
  const lstm1DayConfidence = document.getElementById('lstm1DayConfidence');
  const lstm7DayConfidence = document.getElementById('lstm7DayConfidence');
  const lstm30DayConfidence = document.getElementById('lstm30DayConfidence');
  const lstm1DayDirection = document.getElementById('lstm1DayDirection');
  const lstm7DayDirection = document.getElementById('lstm7DayDirection');
  const lstm30DayDirection = document.getElementById('lstm30DayDirection');
  
  if (runLstmBtn) {
    runLstmBtn.addEventListener('click', function() {
      // Show loading state
      this.disabled = true;
      this.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Running...';
      
      // Get input values
      const symbol = lstmSymbol.value || 'GLD';
      const currentPrice = parseFloat(lstmCurrentPrice.value) || 188.45;
      
      // Simulate API call
      setTimeout(() => {
        // Generate random predictions based on current price
        const day1Change = (Math.random() * 4 - 2); // -2% to +2%
        const day7Change = (Math.random() * 8 - 4); // -4% to +4%
        const day30Change = (Math.random() * 12 - 6); // -6% to +6%
        
        const day1Price = currentPrice * (1 + day1Change / 100);
        const day7Price = currentPrice * (1 + day7Change / 100);
        const day30Price = currentPrice * (1 + day30Change / 100);
        
        // Update UI
        if (lstm1DayPrice) lstm1DayPrice.textContent = `$${day1Price.toFixed(2)}`;
        if (lstm7DayPrice) lstm7DayPrice.textContent = `$${day7Price.toFixed(2)}`;
        if (lstm30DayPrice) lstm30DayPrice.textContent = `$${day30Price.toFixed(2)}`;
        
        // Update confidence levels (inversely related to time horizon)
        const day1Confidence = Math.floor(75 + Math.random() * 20); // 75-95%
        const day7Confidence = Math.floor(60 + Math.random() * 20); // 60-80%
        const day30Confidence = Math.floor(45 + Math.random() * 20); // 45-65%
        
        if (lstm1DayConfidence) lstm1DayConfidence.textContent = `${day1Confidence}%`;
        if (lstm7DayConfidence) lstm7DayConfidence.textContent = `${day7Confidence}%`;
        if (lstm30DayConfidence) lstm30DayConfidence.textContent = `${day30Confidence}%`;
        
        // Update confidence bars
        const day1Bar = document.querySelector('#lstm1DayConfidence').previousElementSibling.querySelector('.prediction-confidence-bar');
        const day7Bar = document.querySelector('#lstm7DayConfidence').previousElementSibling.querySelector('.prediction-confidence-bar');
        const day30Bar = document.querySelector('#lstm30DayConfidence').previousElementSibling.querySelector('.prediction-confidence-bar');
        
        if (day1Bar) day1Bar.style.width = `${day1Confidence}%`;
        if (day7Bar) day7Bar.style.width = `${day7Confidence}%`;
        if (day30Bar) day30Bar.style.width = `${day30Confidence}%`;
        
        // Update direction badges
        const day1Dir = day1Change > 0 ? 'UP' : 'DOWN';
        const day7Dir = day7Change > 0 ? 'UP' : 'DOWN';
        const day30Dir = day30Change > 0 ? 'UP' : 'DOWN';
        
        if (lstm1DayDirection) {
          lstm1DayDirection.textContent = day1Dir;
          lstm1DayDirection.className = day1Dir === 'UP' ? 'badge bg-success' : 'badge bg-danger';
        }
        if (lstm7DayDirection) {
          lstm7DayDirection.textContent = day7Dir;
          lstm7DayDirection.className = day7Dir === 'UP' ? 'badge bg-success' : 'badge bg-danger';
        }
        if (lstm30DayDirection) {
          lstm30DayDirection.textContent = day30Dir;
          lstm30DayDirection.className = day30Dir === 'UP' ? 'badge bg-success' : 'badge bg-danger';
        }
        
        // Reset button
        this.disabled = false;
        this.innerHTML = 'Run LSTM Prediction';
        
        // Show notification
        if (typeof showNotification === 'function') {
          showNotification('LSTM Prediction Complete', `Updated predictions for ${symbol} based on current price of $${currentPrice.toFixed(2)}`);
        }
      }, 2000);
    });
  }
})();

// Sentiment Analysis
(() => {
  const runSentimentBtn = document.getElementById('runSentimentAnalysis');
  const sentimentScore = document.getElementById('sentimentScore');
  const sentimentLabel = document.getElementById('sentimentLabel');
  const confirmationBias = document.getElementById('confirmationBias');
  const lossAversion = document.getElementById('lossAversion');
  const recencyBias = document.getElementById('recencyBias');
  const overconfidence = document.getElementById('overconfidence');
  const newsPositive = document.getElementById('newsPositive');
  const newsNeutral = document.getElementById('newsNeutral');
  const newsNegative = document.getElementById('newsNegative');
  const socialBuzz = document.getElementById('socialBuzz');
  const institutionalFlow = document.getElementById('institutionalFlow');
  
  if (runSentimentBtn) {
    runSentimentBtn.addEventListener('click', function() {
      // Show loading state
      this.disabled = true;
      this.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Running...';
      
      // Simulate API call
      setTimeout(() => {
        // Generate random sentiment score based on inputs
        const score = parseFloat(sentimentScore.value) || (Math.random() * 2 - 1); // -1 to 1
        const label = sentimentLabel.value || (score > 0.2 ? 'bullish' : score < -0.2 ? 'bearish' : 'neutral');
        
        // Update bias values with small random changes
        const confirmationValue = parseFloat(confirmationBias.value) || (Math.random());
        const lossValue = parseFloat(lossAversion.value) || (Math.random());
        const recencyValue = parseFloat(recencyBias.value) || (Math.random());
        const overconfValue = parseFloat(overconfidence.value) || (Math.random());
        
        // Update bias progress bars
        const confirmationBar = document.querySelector('#confirmationBias').closest('.d-flex').querySelector('.progress-bar');
        const lossBar = document.querySelector('#lossAversion').closest('.d-flex').querySelector('.progress-bar');
        const recencyBar = document.querySelector('#recencyBias').closest('.d-flex').querySelector('.progress-bar');
        const overconfBar = document.querySelector('#overconfidence').closest('.d-flex').querySelector('.progress-bar');
        
        if (confirmationBar) {
          confirmationBar.style.width = `${confirmationValue * 100}%`;
          confirmationBar.setAttribute('aria-valuenow', confirmationValue * 100);
        }
        if (lossBar) {
          lossBar.style.width = `${lossValue * 100}%`;
          lossBar.setAttribute('aria-valuenow', lossValue * 100);
        }
        if (recencyBar) {
          recencyBar.style.width = `${recencyValue * 100}%`;
          recencyBar.setAttribute('aria-valuenow', recencyValue * 100);
        }
        if (overconfBar) {
          overconfBar.style.width = `${overconfValue * 100}%`;
          overconfBar.setAttribute('aria-valuenow', overconfValue * 100);
        }
        
        // Update percentage displays
        const confirmationPercent = confirmationBar.closest('.d-flex').querySelector('.text-soft:last-child');
        const lossPercent = lossBar.closest('.d-flex').querySelector('.text-soft:last-child');
        const recencyPercent = recencyBar.closest('.d-flex').querySelector('.text-soft:last-child');
        const overconfPercent = overconfBar.closest('.d-flex').querySelector('.text-soft:last-child');
        
        if (confirmationPercent) confirmationPercent.textContent = `${Math.round(confirmationValue * 100)}%`;
        if (lossPercent) lossPercent.textContent = `${Math.round(lossValue * 100)}%`;
        if (recencyPercent) recencyPercent.textContent = `${Math.round(recencyValue * 100)}%`;
        if (overconfPercent) overconfPercent.textContent = `${Math.round(overconfValue * 100)}%`;
        
        // Reset button
        this.disabled = false;
        this.innerHTML = 'Run Sentiment Analysis';
        
        // Show notification
        if (typeof showNotification === 'function') {
          showNotification('Sentiment Analysis Complete', `Overall sentiment: ${label} (${score.toFixed(2)})`);
        }
      }, 2000);
    });
  }
})();

// Model Insights & Continuous Learning
(() => {
  const submitLearningBtn = document.getElementById('submitLearningData');
  const followedRecommendation = document.getElementById('followedRecommendation');
  const exitPrice = document.getElementById('exitPrice');
  const tradeNotes = document.getElementById('tradeNotes');
  
  if (submitLearningBtn) {
    submitLearningBtn.addEventListener('click', function() {
      // Validate form
      let isValid = true;
      
      if (!followedRecommendation.checked) {
        isValid = false;
      }
      
      if (!exitPrice.value.trim()) {
        isValid = false;
      }
      
      if (!isValid) {
        if (typeof showNotification === 'function') {
          showNotification('Validation Error', 'Please fill in all required fields.');
        }
        return;
      }
      
      // Show loading state
      this.disabled = true;
      this.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Submitting...';
      
      // Simulate API call
      setTimeout(() => {
        // Reset form
        followedRecommendation.checked = false;
        exitPrice.value = '';
        tradeNotes.value = '';
        
        // Reset button
        this.disabled = false;
        this.innerHTML = 'Submit Learning Data';
        
        // Show notification
        if (typeof showNotification === 'function') {
          showNotification('Feedback Submitted', 'Thank you for your feedback. This will help improve our AI models.');
        }
      }, 1500);
    });
  }
})();

// Behavioral Intelligence
(() => {
  const refreshBiasMapBtn = document.getElementById('refreshBiasMap');
  
  if (refreshBiasMapBtn) {
    refreshBiasMapBtn.addEventListener('click', function() {
      // Show loading state
      this.disabled = true;
      this.innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>Refreshing...';
      
      // Simulate API call
      setTimeout(() => {
        // Update bias values with random changes
        const biasBars = document.querySelectorAll('.behavior-pattern .progress-bar');
        biasBars.forEach(bar => {
          const currentValue = parseInt(bar.getAttribute('aria-valuenow'));
          const change = Math.floor(Math.random() * 11) - 5; // Random change between -5 and +5
          const newValue = Math.max(0, Math.min(100, currentValue + change));
          bar.style.width = `${newValue}%`;
          bar.setAttribute('aria-valuenow', newValue);
          
          // Update the corresponding percentage display
          const percentDisplay = bar.closest('.d-flex').querySelector('.text-soft:last-child');
          if (percentDisplay) {
            percentDisplay.textContent = `${newValue}%`;
          }
        });
        
        // Reset button
        this.disabled = false;
        this.innerHTML = '<i class="fas fa-sync-alt me-1"></i> Refresh';
        
        // Show notification
        if (typeof showNotification === 'function') {
          showNotification('Bias Map Updated', 'Your cognitive bias influence map has been refreshed with the latest analysis.');
        }
      }, 1500);
    });
  }
})();

// Disclaimer Modal with Enhanced Features
(() => {
  // Recreate variables for disclaimer elements
  const disclaimerOverlay = document.getElementById('gmDisclaimerOverlay');
  const agreeBtn = document.getElementById('gmAgreeBtn');
  const declineBtn = document.getElementById('gmDeclineBtn');
  const acknowledgeCheckbox = document.getElementById('gmAcknowledge');

  // Handle decline button - redirect to company site
  if (declineBtn) {
    declineBtn.addEventListener('click', function() {
      // Redirect to company site
      window.location.href = 'https://fosterwealthventures.com/';
    });
  }

  // Create dev hooks for external access
  window.GoldmindDisclaimer = {
    reset: () => {
      localStorage.removeItem('goldmind.disclaimer.accepted.v1');
      showDisclaimer();
    },
    show: showDisclaimer,
    close: closeDisclaimer,
    hasAccepted: () => {
      const stored = localStorage.getItem('goldmind.disclaimer.accepted.v1');
      return stored ? JSON.parse(stored).accepted === true : false;
    }
  };

  // Bind checkbox change event to enable/disable Agree button
  if (acknowledgeCheckbox && agreeBtn) {
    acknowledgeCheckbox.addEventListener('change', function() {
      agreeBtn.disabled = !this.checked;
    });
  }

  // Handle agree button - save to localStorage and dispatch events
  if (agreeBtn) {
    agreeBtn.addEventListener('click', function() {
      const consentData = {
        accepted: true,
        ts: new Date().toISOString(),
        version: 'v1'
      };

      // Save to localStorage with versioned key
      localStorage.setItem('goldmind.disclaimer.accepted.v1', JSON.stringify(consentData));

      // Dispatch custom event for disclaimer acceptance
      const event = new CustomEvent('goldmind:disclaimer:accepted', {
        detail: consentData
      });
      document.dispatchEvent(event);

      // Close disclaimer
      closeDisclaimer();

      // Auto-start the tour immediately after acceptance
      try { (startWalkthrough || window.startWalkthrough || window.startGoldMindTour)?.(); } catch(e) { console.warn('[Walkthrough] start failed', e); }
    });
  }

  // Function to show disclaimer modal
  function showDisclaimer() {
    if (disclaimerOverlay) {
      disclaimerOverlay.style.display = 'flex';
      document.body.classList.add('gm-disclaimer-open');

      // Focus management - trap focus on checkbox
      if (acknowledgeCheckbox) {
        acknowledgeCheckbox.focus();
      }

      // Keyboard navigation - Escape to close
      const handleKeyDown = (e) => {
        if (e.key === 'Escape') {
          closeDisclaimer();
        }
      };

      document.addEventListener('keydown', handleKeyDown);

      // Click outside to close
      disclaimerOverlay.addEventListener('click', (e) => {
        if (e.target === disclaimerOverlay) {
          closeDisclaimer();
        }
      });

      // Cleanup function
      const cleanup = () => {
        document.removeEventListener('keydown', handleKeyDown);
      };

      // Store cleanup function for later use
      disclaimerOverlay._cleanup = cleanup;
    }
  }

  // Function to close disclaimer modal
  function closeDisclaimer() {
    if (disclaimerOverlay) {
      disclaimerOverlay.style.display = 'none';
      document.body.classList.remove('gm-disclaimer-open');

      // Run cleanup if available
      if (disclaimerOverlay._cleanup) {
        disclaimerOverlay._cleanup();
      }
    }
  }

  // Function to show walkthrough prompt CTA
  function showWalkthroughPrompt() {
    // Create a toast notification for walkthrough prompt
    const toast = document.createElement('div');
    toast.className = 'position-fixed top-0 end-0 m-3 alert alert-info alert-dismissible fade show';
    toast.style.zIndex = '9999';
    toast.innerHTML = `
      <div class="d-flex align-items-center">
        <div>
          <strong>🚀 Ready to explore GoldMIND AI?</strong><br>
          <small>Take a quick tour to discover powerful features that can enhance your trading decisions.</small>
        </div>
        <div class="ms-3">
          <button class="btn btn-sm btn-primary me-2" id="startTourBtn">Start Tour</button>
          <button class="btn btn-sm btn-outline-secondary" id="dismissTourBtn">Maybe Later</button>
        </div>
      </div>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    `;

    document.body.appendChild(toast);

    // Handle tour button click
    const startTourBtn = document.getElementById('startTourBtn');
    if (startTourBtn) {
      startTourBtn.addEventListener('click', () => {
        // Dispatch custom event for walkthrough prompt
        const tourEvent = new CustomEvent('goldmind:tour:prompt', {
          detail: { action: 'start' }
        });
        document.dispatchEvent(tourEvent);

        // Start walkthrough
        (startWalkthrough || window.startWalkthrough || window.startGoldMindTour)?.();

        toast.remove();
      });
    }

    // Handle dismiss button
    const dismissTourBtn = document.getElementById('dismissTourBtn');
    if (dismissTourBtn) {
      dismissTourBtn.addEventListener('click', () => {
        toast.remove();
      });
    }

    // Auto-remove after 10 seconds
    setTimeout(() => {
      if (toast.parentNode) {
        toast.remove();
      }
    }, 10000);
  }

  // Initialize disclaimer on first load when no acceptance record exists
  const hasAcceptedDisclaimer = localStorage.getItem('goldmind.disclaimer.accepted.v1');
  if (!hasAcceptedDisclaimer) {
    // Show disclaimer immediately on first load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', showDisclaimer);
    } else {
      showDisclaimer();
    }
  }
})();

// Walkthrough System with Enhanced Features
(() => {
  // Listen for goldmind:tour:prompt event from Task 1
  document.addEventListener('goldmind:tour:prompt', (e) => {
    const toast = document.createElement('div');
    toast.className = 'position-fixed top-0 end-0 m-3 alert alert-info alert-dismissible fade show';
    toast.style.zIndex = '9999';
    toast.innerHTML = `
      <div class="d-flex align-items-center">
        <div>
          <strong>🚀 Ready for a quick tour?</strong><br>
          <small>Click Walkthrough to start the 60-second tour.</small>
        </div>
        <button class="btn btn-sm btn-primary ms-3" id="tourPromptBtn">Got it</button>
      </div>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    `;

    document.body.appendChild(toast);

    // Auto-dismiss after 5 seconds or on button click
    const dismissToast = () => {
      toast.remove();
    };

    document.getElementById('tourPromptBtn')?.addEventListener('click', dismissToast);
    setTimeout(dismissToast, 5000);
  });

  // Define the walkthrough steps (trimmed for 420x280px container)
  const STEPS = [
    {
      selector: ".navbar-brand",
      title: "👋 Welcome to GoldMIND AI!",
      benefit: "Discover AI-powered gold trading features that give you an edge in the market.",
      tip: "💡 Exit anytime with ESC or 'Skip'. Use arrow keys or buttons to navigate.",
      details: "GoldMIND AI combines ML, technical analysis, and risk management into one intelligent trading companion."
    },

    // 1) Multi-Asset Gold Selection
    {
      selector: ".asset-type-card[data-asset-type='spot']",
      title: "🏆 Multi-Asset Gold Selection",
      benefit: "Trade spot gold, futures, options, or ETFs from one dashboard.",
      tip: "💡 Click any card to activate. Start with Spot Gold (XAUUSD) - most liquid.",
      details: "Each type has unique traits: Spot for simplicity, Futures for leverage, Options for hedging, ETFs for long-term."
    },

    // 2) Settings
    {
      selector: '#settingsPanel, #settingsDrawer, .settings-drawer, a[href="#settings"], #settingsBtn, #settingsToggle, [data-action="open-settings"], .open-settings',
      title: "⚙️ Settings",
      benefit: "Customize GoldMIND for your trading style and preferences.",
      details: "• Chart smoothing, default timeframes, trading style\n• Daily profit targets and alert thresholds\n• Notification preferences and risk parameters",
      tip: "💾 Settings save locally and sync across sessions."
    },

    // 3) Live Price Performance Chart
    {
      selector: "#goldPriceChart",
      title: "📈 Live Price Performance Chart",
      benefit: "Track 30-day gold trends with real-time updates every 10 seconds.",
      tip: "💡 Toggle 'Smooth lines' for patterns or sharp lines for precision.",
      details: "Identify support/resistance levels before requesting AI recommendations."
    },

    // 4) Enhanced Alert Center
    {
      selector: "#alertsList",
      title: "🚨 Enhanced Alert Center",
      benefit: "Get instant notifications when gold breaks key price levels.",
      tip: "💡 Enable browser notifications. Set thresholds in Settings (1-3%).",
      details: "Example: Gold breaks $2,040 → Alert → Check AI → Trade in 30 seconds."
    },

    // 5) Risk Management
    {
      selector: ".risk-management-card",
      title: "⚠️ Risk Management",
      benefit: "Set guardrails so AI never suggests trades beyond your comfort level.",
      tip: "💡 Start conservative: 10% max drawdown + ATR stops + Kelly sizing.",
      details: "This protects capital. Most AI tools ignore risk - GoldMIND enforces it."
    },

    // 6) AI Decision Engine
    {
      selector: "#resolveBtn",
      title: "🎯 AI Decision Engine",
      benefit: "Get complete trading plans: position size, entry/exit, risk management.",
      tip: "💡 Fill your style, amount, goals. AI customizes to YOUR profile.",
      details: "Combines LSTM, indicators & risk into unified recommendations."
    },

    // 7) Custom Indicators
    {
      selector: "#indicatorGrid",
      title: "📊 Custom Indicators",
      benefit: "Select which signals influence AI recommendations and confidence scores.",
      tip: "💡 Day traders: RSI + MACD. Swing traders: SMA + DXY. Start with 3-5.",
      details: "See live impact: Adding indicators can boost confidence 68% → 82%."
    },

    // 8) LSTM Predictions
    {
      selector: ".predictive-analysis-card",
      title: "🔮 LSTM Price Predictions",
      benefit: "Neural network forecasts for 1, 7, and 30-day price targets.",
      tip: "💡 Use as ONE input in decisions. Don't treat as guaranteed outcomes.",
      details: "Current accuracy: 83.5% over last 30 days (real-time tracking)."
    },

    // 9) Learning Feedback
    {
      selector: "#submitLearningData",
      title: "🧠 Learning Feedback",
      benefit: "Report outcomes so AI learns YOUR patterns and improves accuracy.",
      tip: "💡 Submit even if you don't follow AI. Explain why for personalization.",
      details: "Users with 3+ feedbacks see 15% higher accuracy."
    },

    // 10) Completion
    {
      selector: "footer",
      title: "🎉 You're Ready to Trade Smarter!",
      benefit: "You now know all core features. Re-run tour anytime from navbar.",
      tip: "💡 Next: Enable alerts, set risk tolerance, get first AI recommendation!",
      details: "Remember: GoldMIND recommends, YOU decide. Always do your own research."
    }
  ];
  
  const walkthroughBtn = document.getElementById('walkthroughBtn');

  if (walkthroughBtn) {
    walkthroughBtn.addEventListener('click', function(e) {
      e.preventDefault();
      try {
        // Defensive: end any stale tour state before starting fresh
        window.GM_Tour?.end?.();
      } catch (e) { /* no-op */ }

      (startWalkthrough || window.startWalkthrough || window.startGoldMindTour)?.();
    });
  }

  function startWalkthrough() {
    // Always remove any previous tooltip/mask/highlight and start at step 1
    const existingTooltip = document.getElementById('gm-wt-tooltip');
    const existingMask = document.getElementById('gm-wt-mask');

    if (existingTooltip) existingTooltip.remove();
    if (existingMask) existingMask.remove();
    document.querySelectorAll('.gm-wt-highlight').forEach(el => {
      el.classList.remove('gm-wt-highlight');
    });

    let currentStep = 0;

    // Create tooltip element (uniform 420x280px, no internal scroll)
    const tooltip = document.createElement('div');
    tooltip.id = 'gm-wt-tooltip';
    tooltip.style.overflow = 'hidden !important';
    tooltip.innerHTML = `
      <div id="gm-wt-content" style="height: 100% !important; overflow: hidden !important;">
        <h5 id="gm-wt-title">${STEPS[0].title}</h5>
        <div class="gm-wt-body" style="overflow: auto !important; max-height: calc(100% - 80px);">
          <div id="gm-wt-benefit" class="mb-2">${STEPS[0].benefit}</div>
          <div id="gm-wt-details" class="mb-2">${STEPS[0].details}</div>
          <div id="gm-wt-tip" class="mb-2">${STEPS[0].tip}</div>
        </div>
        <div id="gm-wt-footer" class="mt-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <button id="gm-wt-prev" class="btn btn-sm btn-outline-light">Previous</button>
            <div id="gm-wt-dots">
              ${STEPS.map((_, i) => `<span>${i === 0 ? '●' : '○'}</span>`).join('')}
            </div>
            <button id="gm-wt-next" class="btn btn-sm btn-outline-light">Next</button>
          </div>
          <button id="gm-wt-skip" class="btn btn-sm btn-outline-warning w-100">Skip Tour</button>
        </div>
      </div>
      <button id="gm-wt-close" class="position-absolute top-0 end-0 m-2 btn btn-link text-white p-0">
        <i class="fas fa-times"></i>
      </button>
    `;
    document.body.appendChild(tooltip);
    
    // Create mask element
    const mask = document.createElement('div');
    mask.id = 'gm-wt-mask';
    document.body.appendChild(mask);
    
    // Function to position tooltip centered over target element
    const positionTooltip = () => {
      const element = document.querySelector(STEPS[currentStep].selector);
      if (element) {
        // Remove previous highlight
        document.querySelectorAll('.gm-wt-highlight').forEach(el => {
          el.classList.remove('gm-wt-highlight');
        });

        // Add highlight to current element
        element.classList.add('gm-wt-highlight');

        const rect = element.getBoundingClientRect();
        const tooltipRect = { width: 420, height: 280 }; // Fixed size

        // Calculate center position over target
        const targetCenterX = rect.left + (rect.width / 2);
        const targetCenterY = rect.top + (rect.height / 2);

        let left = targetCenterX - (tooltipRect.width / 2);
        let top = targetCenterY - (tooltipRect.height / 2);

        // Clamp to viewport boundaries while maintaining overlap
        if (left < 10) left = 10;
        if (left + tooltipRect.width > window.innerWidth - 10) {
          left = window.innerWidth - tooltipRect.width - 10;
        }
        if (top < 10) top = 10;
        if (top + tooltipRect.height > window.innerHeight - 10) {
          top = window.innerHeight - tooltipRect.height - 10;
        }

        tooltip.style.top = `${top}px`;
        tooltip.style.left = `${left}px`;

        // Scroll element into view if needed
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    };
    
    // Function to update step
    const updateStep = () => {
      const title = document.getElementById('gm-wt-title');
      const benefit = document.getElementById('gm-wt-benefit');
      const details = document.getElementById('gm-wt-details');
      const tip = document.getElementById('gm-wt-tip');
      const dots = document.querySelectorAll('#gm-wt-dots span');
      const prevBtn = document.getElementById('gm-wt-prev');
      const nextBtn = document.getElementById('gm-wt-next');

      if (title) title.textContent = STEPS[currentStep].title;
      if (benefit) benefit.textContent = STEPS[currentStep].benefit;
      if (details) details.textContent = STEPS[currentStep].details || '';
      if (tip) tip.textContent = STEPS[currentStep].tip || '';

      dots.forEach((dot, i) => {
        dot.textContent = i === currentStep ? '●' : '○';
      });

      if (prevBtn) prevBtn.style.visibility = currentStep === 0 ? 'hidden' : 'visible';
      if (nextBtn) nextBtn.textContent = currentStep === STEPS.length - 1 ? 'Finish' : 'Next';

      // Auto-open Settings offcanvas on Settings slide
      if (currentStep === 2) { // Settings step (index 2)
        const settingsPanel = document.getElementById('settingsPanel');
        if (settingsPanel && !settingsPanel.classList.contains('show')) {
          const oc = new bootstrap.Offcanvas('#settingsPanel');
          oc.show();

          // Scroll to top for consistent first-field view
          const settingsBody = settingsPanel.querySelector('.offcanvas-body');
          if (settingsBody) {
            settingsBody.scrollTop = 0;
          }
        }
      }

      positionTooltip();
    };
    
    // Event listeners
    document.getElementById('gm-wt-next').addEventListener('click', () => {
      if (currentStep < STEPS.length - 1) {
        currentStep++;
        updateStep();
      } else {
        // Close walkthrough
        tooltip.remove();
        mask.remove();
        document.querySelectorAll('.gm-wt-highlight').forEach(el => {
          el.classList.remove('gm-wt-highlight');
        });
      }
    });

    document.getElementById('gm-wt-prev').addEventListener('click', () => {
      if (currentStep > 0) {
        currentStep--;
        updateStep();
      }
    });

    document.getElementById('gm-wt-skip').addEventListener('click', () => {
      tooltip.remove();
      mask.remove();
      document.querySelectorAll('.gm-wt-highlight').forEach(el => {
        el.classList.remove('gm-wt-highlight');
      });
    });

    document.getElementById('gm-wt-close').addEventListener('click', () => {
      tooltip.remove();
      mask.remove();
      document.querySelectorAll('.gm-wt-highlight').forEach(el => {
        el.classList.remove('gm-wt-highlight');
      });
    });

    // Keyboard navigation
    const handleKeyDown = (e) => {
      if (document.getElementById('gm-wt-tooltip')) {
        if (e.key === 'ArrowRight') {
          document.getElementById('gm-wt-next').click();
        } else if (e.key === 'ArrowLeft') {
          document.getElementById('gm-wt-prev').click();
        } else if (e.key === 'Escape') {
          document.getElementById('gm-wt-close').click();
        }
      }
    };

    document.addEventListener('keydown', handleKeyDown);

    // Cleanup on tooltip removal
    tooltip.addEventListener('remove', () => {
      document.removeEventListener('keydown', handleKeyDown);
    });

    // Handle window resize
    window.addEventListener('resize', positionTooltip);

    // Initialize
    updateStep();
  }

  // Expose for external callers (disclaimer/toast/button)
  window.startWalkthrough = startWalkthrough;
  // Backward-compat alias if other code calls this name:
  window.startGoldMindTour = startWalkthrough;
})();
</script>
</body>
</html>