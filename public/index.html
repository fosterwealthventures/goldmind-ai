<!DOCTYPE html>

<html data-bs-theme="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>GoldMIND AI – The Trading Companion</title>


<!-- Fonts & Libraries -->
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<script>
// -- Chart.js safe wrapper (prevents "Canvas is already in use") --
(function(){
  // Define newChart always
  window.newChart = function(ctxOrElOrId, config) {
    // Resolve canvas + context
    let el=null, ctx=null;
    if (typeof ctxOrElOrId==="string") { el=document.getElementById(ctxOrElOrId); if(!el) return null; ctx=el.getContext("2d"); }
    else if (ctxOrElOrId && typeof ctxOrElOrId.getContext==="function") { el=ctxOrElOrId; ctx=el.getContext("2d"); }
    else if (ctxOrElOrId && ctxOrElOrId.canvas) { ctx=ctxOrElOrId; el=ctx.canvas; }
    if (!el || !ctx) return null;
    if (!window.Chart) { console.warn("Chart.js not loaded yet"); return null; }

    // Destroy existing chart instance for this canvas
    const prev = (window.Chart.getChart ? window.Chart.getChart(el) : el._chart) || null;
    if (prev && typeof prev.destroy==="function") { try { prev.destroy(); } catch(e) { console.debug(e); } }

    // Create chart with native constructor
    const chart = new window.Chart(ctx, config);
    if (!window.Chart.getChart) el._chart = chart; // legacy fallback
    return chart;
  };
})();
</script>
<style>
    /* ========== CSS VARIABLES - DARK MODE (DEFAULT) ========== */
    :root{
      --bg: #0b0f16; 
      --card: #121826; 
      --muted: #1a2233; 
      --text: #e8eefc; 
      --text-primary: #ffffff;
      --text-secondary: #e8eefc;
      --soft: #a9b4c7;
      --gold: #ffd700; 
      --success: #2ecc71; 
      --danger: #ff5a5f; 
      --warning: #f39c12; 
      --info: #3ab0ff;
      --shadow: 0 10px 30px rgba(0,0,0,.3);
      --form-bg: #0f1724;
      --form-border: #202b45;
      --ai-result-bg: rgba(0,0,0,0.1);
      --ai-result-border: rgba(255,255,255,0.1);
      --ai-result-text: #e8eefc;
    }

    /* ========== CSS VARIABLES - LIGHT MODE ========== */
    body.theme-light {
      --bg: linear-gradient(180deg,#f7f9fc,#eef3fb); 
      --card: #ffffff; 
      --muted: #f8f9fa; 
      --text: #162033; 
      --text-primary: #000000;
      --text-secondary: #162033;
      --soft: #6c757d;
      --gold: #ffd700; 
      --success: #2ecc71; 
      --danger: #ff5a5f; 
      --warning: #f39c12; 
      --info: #3ab0ff;
      --shadow: 0 10px 30px rgba(0,0,0,.1);
      --form-bg: #ffffff;
      --form-border: #d7e0f3;
      --ai-result-bg: rgba(255,255,255,0.8);
      --ai-result-border: rgba(0,0,0,0.1);
      --ai-result-text: #162033;
    }

    /* ========== BASE STYLES ========== */
    html,body{height:100%}
    body{
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: all 0.3s ease;
    }

    /* Dark mode background gradient */
    body:not(.theme-light) {
      background: radial-gradient(1200px 800px at 10% 0%, #0d1322 0%, #0b0f16 45%, #0a0e15 100%);
    }

    /* Light mode background */
    body.theme-light {
      background: linear-gradient(180deg,#f7f9fc,#eef3fb);
    }

    /* ========== NAVBAR ========== */
    .navbar{ 
      background: linear-gradient(90deg,#0e1423,#121a2d); 
      border-bottom: 1px solid #1b2435; 
      padding: .5rem 0; 
      transition: all 0.3s ease;
    }
    
    body.theme-light .navbar { 
      background: linear-gradient(90deg,#f0f4fb,#e8eef9); 
      border-bottom-color: #d8e1f0; 
    }

    .badge-gold{ 
      background: rgba(255,215,0,.12); 
      color: var(--gold); 
      border: 1px solid rgba(255,215,0,.35); 
    }
    
    .brand-logo{ width:130px; height:130px; }
    .brand-kicker{ 
      font-size:.75rem; 
      letter-spacing:.05em; 
      color: var(--soft); 
      text-transform:uppercase; 
    }
    .brand-sub{ 
      font-size:.8rem; 
      color: var(--soft); 
      margin-top:.1rem; 
    }

    .navbar .navbar-actions{ 
      display:flex; 
      align-items:center; 
      gap:.9rem; 
      flex-wrap:wrap; 
    }
    
    .form-switch{ 
      display:inline-flex; 
      align-items:center; 
      padding-left:0; 
    }
    
    .form-switch .form-check-input{ margin:0 .45rem 0 0; }
    .form-switch .form-check-label{ 
      margin:0; 
      color: var(--soft);
    }

    /* ========== CARDS & UI COMPONENTS ========== */
    .card{ 
      background: var(--card); 
      border: 1px solid #1b2538; 
      box-shadow: var(--shadow); 
      color: var(--text);
      transition: all 0.3s ease;
    }

    body.theme-light .card { 
      background: var(--card); 
      border-color: #e3eaf6; 
    }

    .card-header{ 
      background: linear-gradient(180deg,#ffd700,#e6c200); 
      color: #141414; 
      border-bottom: 1px solid #b79500; 
      font-weight: 800; 
    }
    
    body.theme-light .card-header { 
      background: linear-gradient(180deg,#ffe766,#ffd700); 
      color: #111; 
      border-bottom-color: #d7b400; 
    }

    .card-header .data-badge{ 
      font-size:.8rem; 
      padding:.2rem .5rem; 
      border-radius:999px; 
      background: rgba(255,255,255,.06); 
    }

    .text-soft{ color: var(--soft); }
    .card-title { color: var(--text-primary); }
    .card-text { color: var(--text-secondary); }

    /* ========== FORMS ========== */
    .form-control,.form-select{ 
      background: var(--form-bg); 
      color: var(--text); 
      border: 1px solid var(--form-border); 
      transition: all 0.3s ease;
    }
    
    .form-control:focus,.form-select:focus{ 
      box-shadow: 0 0 0 .25rem rgba(58,176,255,.15); 
      border-color: #3ab0ff; 
      background: var(--form-bg);
      color: var(--text);
    }

    .form-label {
      color: var(--text-primary);
      font-weight: 600;
    }

    /* ========== CHARTS ========== */
    canvas{ 
      background: #0d1422; 
      border-radius: .75rem; 
    }

    body.theme-light canvas {
      background: #f8f9fa;
    }

    .mini-label{ 
      font-size: .8rem; 
      color: var(--soft); 
    }

    /* ========== LIST GROUPS ========== */
    .list-group-item{ 
      background: transparent; 
      color: var(--text); 
      border-color: #27324b; 
      transition: all 0.3s ease;
    }
    
    body.theme-light .list-group-item { 
      background: var(--card); 
      color: var(--text); 
      border-color: #e3eaf6; 
    }

    /* ========== MODALS & OFFCANVAS ========== */
    .offcanvas{ 
      background: #0e1523; 
      color: var(--text);
      transition: all 0.3s ease;
    }

    body.theme-light .offcanvas {
      background: var(--card);
    }

    .modal-content {
      background: #0e1523 !important; 
      color: #e8eefc !important; 
      border: 1px solid #27324b !important;
    }

    body.theme-light .modal-content {
      background: var(--card) !important;
      color: var(--text) !important;
      border: 1px solid #e3eaf6 !important;
    }

    /* ========== LINKS ========== */
    .link-muted{ color: #9fb1d1; } 
    .link-muted:hover{ color: #cfe0ff; }

    body.theme-light .link-muted { color: #6c757d; }
    body.theme-light .link-muted:hover { color: #495057; }

    /* ========== FOOTER ========== */
    .footer{ color: var(--soft); }

    /* ========== BUTTONS ========== */
    .btn-gold{ 
      background: linear-gradient(135deg,#ffd700,#e6c200); 
      color: #141414; 
      border: none; 
      font-weight: 600; 
    }
    .btn-gold:hover{ 
      background: linear-gradient(135deg,#e6c200,#d4af00); 
      color: #141414; 
    }

    /* ========== MULTI-ASSET CARD STYLES ========== */
    .asset-type-card {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 193, 7, 0.05));
      border: 2px solid rgba(255, 215, 0, 0.3);
      box-shadow: 0 15px 40px rgba(255, 215, 0, 0.1);
      position: relative;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .asset-type-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 50px rgba(255, 215, 0, 0.15);
    }

    .asset-type-card.active {
      border-color: var(--gold);
      box-shadow: 0 20px 50px rgba(255, 215, 0, 0.2);
    }

    body.theme-light .asset-type-card {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.08), rgba(255, 193, 7, 0.03));
      border: 2px solid rgba(255, 215, 0, 0.2);
    }

    /* ========== DECISION ENGINE - MAIN FEATURE ========== */
    .decision-engine-card {
      background: linear-gradient(135deg, rgba(58, 176, 255, 0.1), rgba(255, 215, 0, 0.05));
      border: 2px solid rgba(58, 176, 255, 0.3);
      box-shadow: 0 20px 50px rgba(58, 176, 255, 0.15);
      position: relative;
      color: var(--text);
    }

    body.theme-light .decision-engine-card {
      background: linear-gradient(135deg, rgba(58, 176, 255, 0.08), rgba(255, 215, 0, 0.03));
      border: 2px solid rgba(58, 176, 255, 0.2);
    }

    .decision-engine-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #3ab0ff, #ffd700);
      border-radius: 8px 8px 0 0;
    }

    .decision-engine-header {
      background: linear-gradient(135deg, #3ab0ff, #2196f3);
      color: white;
      font-size: 1.25rem;
      font-weight: 800;
      text-align: center;
      padding: 1rem;
      position: relative;
    }

    .decision-engine-header::before {
      content: '🎯';
      font-size: 1.5rem;
      margin-right: 0.5rem;
    }

    /* ========== RISK MANAGEMENT STYLES ========== */
    .risk-management-card {
      background: linear-gradient(135deg, rgba(255, 90, 95, 0.1), rgba(255, 107, 107, 0.05));
      border: 2px solid rgba(255, 90, 95, 0.3);
      box-shadow: 0 15px 40px rgba(255, 90, 95, 0.1);
    }

    body.theme-light .risk-management-card {
      background: linear-gradient(135deg, rgba(255, 90, 95, 0.08), rgba(255, 107, 107, 0.03));
      border: 2px solid rgba(255, 90, 95, 0.2);
    }

    /* ========== CUSTOM INDICATORS STYLES ========== */
    .indicator-checkbox {
      background: var(--card);
      border: 2px solid var(--form-border);
      border-radius: 8px;
      padding: 0.75rem;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .indicator-checkbox:hover {
      border-color: var(--gold);
    }

    .indicator-checkbox.selected {
      border-color: var(--gold);
      background: rgba(255, 215, 0, 0.05);
    }

    /* ========== ALERT NOTIFICATION STYLES ========== */
    .alert-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      background: var(--card);
      border: 2px solid var(--warning);
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      animation: slideInRight 0.3s ease-out;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .alert-close-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: none;
      border: none;
      color: var(--soft);
      cursor: pointer;
      font-size: 1.2rem;
    }

    /* ========== AI RESULTS - FIXED COLORS ========== */
    .ai-recommendation-result {
      background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
      border: 2px solid rgba(46, 204, 113, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .ai-reasoning-result {
      background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.1));
      border: 2px solid rgba(155, 89, 182, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .ai-recommendation-result h5,
    .ai-reasoning-result h5 {
      color: var(--text-primary) !important;
      font-weight: 800;
    }

    .ai-result-text {
      color: var(--ai-result-text) !important;
      background: var(--ai-result-bg);
      border: 1px solid var(--ai-result-border);
      padding: 1rem;
      border-radius: 8px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 0.9rem;
      line-height: 1.4;
      white-space: pre-wrap;
      word-wrap: break-word;
      transition: all 0.3s ease;
    }

    /* ========== RESPONSIVE DESIGN ========== */
    .small-chart{ height: 250px; }
    .medium-chart{ height: 300px; }

    @media (max-width: 576px){
      .brand-logo{ width: 84px; height: 84px; }
      .brand-kicker{ display: none; }
      
      .card-body {
        padding: 1rem 0.75rem;
      }
      
      .ai-recommendation-result,
      .ai-reasoning-result {
        padding: 1rem;
      }
      
      .ai-result-text {
        font-size: 0.8rem;
        padding: 0.75rem;
      }

      .alert-notification {
        left: 10px;
        right: 10px;
        top: 10px;
        max-width: none;
      }
    }

    @media (max-width: 768px) {
      .navbar-actions {
        gap: 0.5rem;
      }
      
      .btn-sm {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
      }
    }

    /* ========== ADDITIONAL TEXT COLOR FIXES ========== */
    .jsection-result {
      color: var(--text);
    }

    .jsection-result pre {
      color: var(--ai-result-text) !important;
    }

    /* Ensure all headings use proper contrast */
    h1, h2, h3, h4, h5, h6 {
      color: var(--text-primary);
    }

    /* Ensure all paragraph text is visible */
    p {
      color: var(--text-secondary);
    }

    /* Input placeholders */
    .form-control::placeholder,
    .form-select option {
      color: var(--soft);
    }

    body.theme-light .form-control::placeholder {
      color: #6c757d;
    }

    /* Alert styling */
    .alert {
      color: var(--text-primary);
    }

    /* Ensure buttons have proper contrast */
    .btn-outline-light {
      color: var(--text);
      border-color: var(--soft);
    }

    .btn-outline-light:hover {
      background-color: var(--soft);
      color: var(--card);
    }

    body.theme-light .btn-outline-light {
      color: var(--text);
      border-color: #6c757d;
    }

    body.theme-light .btn-outline-light:hover {
      background-color: #6c757d;
      color: white;
    }

    /* Skip to Trading button styling */
    .btn-outline-gold {
      color: var(--gold);
      border-color: var(--gold);
      text-decoration: none;
    }

    .btn-outline-gold:hover {
      background-color: var(--gold);
      color: #000;
      border-color: var(--gold);
      text-decoration: none;
    }

    .btn-outline-gold:focus,
    .btn-outline-gold:active {
      background-color: var(--gold);
      color: #000;
      border-color: var(--gold);
      box-shadow: 0 0 0 0.2rem rgba(255, 215, 0, 0.25);
    }

    /* ========== NOTIFICATION PERMISSION BANNER ========== */
    .notification-banner {
      position: fixed;
      bottom: 20px;
      left: 20px;
      right: 20px;
      background: linear-gradient(135deg, var(--info), var(--warning));
      color: white;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      animation: slideInUp 0.3s ease-out;
    }

    @keyframes slideInUp {
      from {
        transform: translateY(100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Status indicators */
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 0.5rem;
    }
    .status-active { background-color: var(--success); }
    .status-warning { background-color: var(--warning); }
    .status-error { background-color: var(--danger); }
  </style>
<meta content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://api.fwvgoldmindai.com https://goldmind-api-884387776097.us-central1.run.app https://goldmind-compute-884387776097.us-central1.run.app https://fwvgoldmindai.com https://www.fwvgoldmindai.com https://admin.fwvgoldmindai.com; frame-ancestors 'self'; base-uri 'self'; form-action 'self';" http-equiv="Content-Security-Policy"/>
<style>
/* --- Visibility tweaks (light & dark), non-invasive --- */
:root{ --focus-accent:#f59e0b; } /* amber */
[data-theme="light"]{
  --focus-bg:#fffbe6; /* soft amber tint */
  --focus-fg:#111827;
  --contrast-btn-bg:#111827;
  --contrast-btn-fg:#ffffff;
  --contrast-btn-border:#111827;
}
[data-theme="dark"]{
  --focus-bg:#1f2937; /* slate-800 */
  --focus-fg:#f3f4f6;
  --contrast-btn-bg:#f59e0b;
  --contrast-btn-fg:#111827;
  --contrast-btn-border:#f59e0b;
}

.focus-note{
  background: var(--focus-bg) !important;
  color: var(--focus-fg) !important;
  border-left: 4px solid var(--focus-accent) !important;
  box-shadow: 0 4px 14px rgba(0,0,0,.08);
  border-radius: 10px;
}
.focus-note .badge, .focus-note strong{ color: var(--focus-accent); }

.btn-contrast{
  background: var(--contrast-btn-bg) !important;
  color: var(--contrast-btn-fg) !important;
  border: 2px solid var(--contrast-btn-border) !important;
  font-weight: 700;
}
.btn-contrast:focus, .btn-contrast:hover{
  filter: brightness(1.05);
  transform: translateY(-1px);
}

/* Keep original button paddings and sizes from bootstrap/tailwind if present */
</style>
<style>
/* Footer styling */
footer {
  text-align: center;
  font-size: 0.85rem;
  margin-top: 2rem;
  padding: 1rem 0;
  border-top: 1px solid rgba(0,0,0,0.1);
}
[data-theme="light"] footer {
  color: #4b5563; /* gray-700 */
  background: #f9fafb; /* gray-50 */
}
[data-theme="dark"] footer {
  color: #d1d5db; /* gray-300 */
  background: #111827; /* gray-900 */
  border-top: 1px solid rgba(255,255,255,0.1);
}
footer a {
  color: inherit;
  text-decoration: underline;
  margin: 0 0.35rem;
}
footer a:hover {
  color: #f59e0b; /* amber hover accent */
}
</style>
<style>
footer {
  text-align: center;
  font-size: 0.85rem;
  margin-top: 2rem;
  padding: 1rem 0;
  border-top: 1px solid rgba(0,0,0,0.1);
}
[data-theme="light"] footer {
  color: #111827; /* enforce visible dark text */
  background: #f9fafb;
}
[data-theme="dark"] footer {
  color: #f3f4f6; /* enforce visible light text */
  background: #111827;
  border-top: 1px solid rgba(255,255,255,0.1);
}
footer a {
  color: inherit;
  text-decoration: underline;
  margin: 0 0.35rem;
}
footer a:hover {
  color: #f59e0b;
}
</style>
<style>
html, body {
  height: 100%;
  margin: 0;
  display: flex;
  flex-direction: column;
}
main {
  flex: 1 0 auto;
}
footer {
  flex-shrink: 0;
  text-align: center;
  font-size: 0.85rem;
  margin-top: auto;
  padding: 1rem 0;
  border-top: 1px solid rgba(0,0,0,0.1);
}
[data-theme="light"] footer {
  color: #111827;
  background: #f9fafb;
}
[data-theme="dark"] footer {
  color: #f3f4f6;
  background: #111827;
  border-top: 1px solid rgba(255,255,255,0.1);
}
footer a {
  color: inherit;
  text-decoration: underline;
  margin: 0 0.35rem;
}
footer a:hover {
  color: #f59e0b;
}
</style>
<style>
/* Responsive tuning for sticky footer */
footer {
  opacity: 0.9; /* slightly muted by default (desktop) */
  font-size: 0.8rem; /* a touch smaller on desktop */
}
footer a { padding: 0 .15rem; }

/* Mobile: roomier touch targets and slightly larger text */
@media (max-width: 640px) {
  footer {
    font-size: 0.95rem;
    padding: 1.1rem 0;
    line-height: 1.5;
    opacity: 1; /* full clarity on mobile */
  }
  footer a {
    padding: 0 .35rem; /* easier tapping */
  }
}
</style>
<style>
/* High-visibility style for the 'Test' button in Enhanced Alert Center */
.btn-test-alert{
  font-weight: 700;
  border-width: 2px;
  border-radius: 10px;
  padding: .45rem .8rem;
  transition: box-shadow .2s, transform .05s ease-in-out;
}
[data-theme="light"] .btn-test-alert{
  background: #111827;
  color: #ffffff;
  border-color: #111827;
  box-shadow: 0 2px 10px rgba(17,24,39,.18);
}
[data-theme="dark"] .btn-test-alert{
  background: #f59e0b;
  color: #111827;
  border-color: #f59e0b;
  box-shadow: 0 2px 10px rgba(245,158,11,.28);
}
.btn-test-alert:hover, .btn-test-alert:focus{
  filter: brightness(1.05);
  transform: translateY(-1px);
  outline: none;
}
</style>
<!-- Frontend → Backend config (define BEFORE loading the client) -->
<script>
(() => {
  const STORAGE_KEY = "gm-theme";

  const getStored = () => localStorage.getItem(STORAGE_KEY);
  const getPreferred = () =>
    window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";

  const applyTheme = (theme) => {
    const root = document.documentElement;
    const body = document.body;
    // For Bootstrap 5.3 components
    root.setAttribute("data-bs-theme", theme);
    // For our CSS blocks using [data-theme="light"/"dark"]
    root.setAttribute("data-theme", theme);
    // For our CSS blocks using body.theme-light
    if (theme === "light") {
      body.classList.add("theme-light");
    } else {
      body.classList.remove("theme-light");
    }
    // Sync UI
    const toggle = document.getElementById("themeToggle");
    if (toggle) toggle.checked = (theme === "dark");
    if (toggle) toggle.setAttribute("aria-checked", String(theme === "dark"));
const label = document.querySelector('label[for="themeToggle"]');
    if (label) label.textContent = theme === "dark" ? "Dark" : "Light";
  };

  const init = () => {
    const theme = getStored() || getPreferred();
    applyTheme(theme);
    const toggle = document.getElementById("themeToggle");
    if (toggle) {
      toggle.addEventListener("change", () => {
        const next = toggle.checked ? "dark" : "light";
        localStorage.setItem(STORAGE_KEY, next);
        applyTheme(next);
      });
    }
  };

  // React to OS changes if user hasn't chosen manually
  const mq = window.matchMedia("(prefers-color-scheme: dark)");
  mq.addEventListener("change", (e) => {
    if (!getStored()) {
      applyTheme(e.matches ? "dark" : "light");
    }
  });

  // Initialize when DOM is ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }
})();
</script>
<style>
/* Remove focus ring/border from logo link and image */
.navbar .navbar-brand,
.navbar .navbar-brand:focus,
.navbar .navbar-brand:focus-visible,
.navbar .navbar-brand:active {
  outline: none !important;
  box-shadow: none !important;
}
.navbar .brand-logo,
.navbar .navbar-brand img {
  border: 0 !important;
  outline: none !important;
  box-shadow: none !important;
}
.navbar .navbar-brand { -webkit-tap-highlight-color: transparent; }
</style>
</head>
<body>
<!-- Notification Container for Alerts -->
<div id="notificationContainer"></div>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg sticky-top">
<div class="container-fluid px-3 px-sm-4">
<!-- Brand with larger logo + tiny kicker + presented-by -->
<a class="navbar-brand d-flex align-items-center gap-3" href="#">
<!-- Placeholder logo - replace with actual image -->
<img alt="GoldMIND AI System" class="brand-logo" src="assets/GoldMind AI logo.png"/>
<div class="d-flex flex-column">
<small class="brand-kicker">Ultimate Trading Companion</small>
<small class="brand-sub">Presented by Foster Wealth Ventures LLC</small>
<small class="brand-verse">“Commit your work to the LORD, and your plans will be established.” — Prov 16:3</small>
</div>
</a>
<!-- Right-side actions (wraps on small screens) -->
<div class="ms-auto navbar-actions">
<a class="btn btn-sm btn-outline-gold" href="#resolveBtn" title="Jump to trading section">⚡ Skip to Trading</a>
<button class="btn btn-sm btn-outline-light" data-bs-target="#helpModal" data-bs-toggle="modal" id="helpBtn" type="button">Help</button>
<button class="btn btn-sm btn-outline-warning d-none" id="enableNotificationsBtn" type="button">🔔 Enable Alerts</button>
<button class="btn btn-sm btn-outline-light" id="walkthroughBtn" type="button">Walkthrough</button>
<div class="form-check form-switch m-0" title="Toggle Theme">
<input class="form-check-input" id="themeToggle" type="checkbox"/>
<label class="form-check-label text-soft" for="themeToggle">Light</label>
</div>
<button aria-controls="settingsPanel" class="btn btn-sm btn-outline-info" data-bs-target="#settingsPanel" data-bs-toggle="offcanvas" type="button">Settings</button>
</div>
</div>
</nav>
<main class="container-fluid px-3 px-sm-4 py-4">
<div class="alert alert-danger d-none" id="globalError" role="alert"></div>
<!-- 1. MULTI-ASSET PREDICTION ENGINE -->
<section>
<h2 class="h4 fw-bold mb-3">🏆 Multi-Asset Gold Prediction Engine</h2>
<div class="row g-3 mb-4">
<div class="col-12 col-md-6 col-lg-3">
<div class="card asset-type-card h-100" data-asset-type="spot">
<div class="card-header d-flex justify-content-between align-items-center">
<span>💰 Spot Gold</span>
<span class="data-badge" id="spotGoldPrice">XAUUSD</span>
</div>
<div class="card-body">
<p class="text-soft">Current: <strong id="spotCurrentPrice">$2,045.30</strong></p>
<p class="text-soft">24h Change: <strong id="spot24hChange">+0.85%</strong></p>
<div class="mini-label">Status: <span class="badge bg-success" id="spotStatus">Active</span></div>
</div>
</div>
</div>
<div class="col-12 col-md-6 col-lg-3">
<div class="card asset-type-card h-100" data-asset-type="futures">
<div class="card-header d-flex justify-content-between align-items-center">
<span>📈 Gold Futures</span>
<span class="data-badge" id="futuresSymbol">GC</span>
</div>
<div class="card-body">
<p class="text-soft">Current: <strong id="futuresPrice">$2,048.70</strong></p>
<p class="text-soft">Volume: <strong id="futuresVolume">45,230</strong></p>
<div class="mini-label">Expiry: <span id="futuresExpiry">Dec 2024</span></div>
</div>
</div>
</div>
<div class="col-12 col-md-6 col-lg-3">
<div class="card asset-type-card h-100" data-asset-type="options">
<div class="card-header d-flex justify-content-between align-items-center">
<span>🎯 Gold Options</span>
<span class="data-badge" id="optionsSymbol">GLD</span>
</div>
<div class="card-body">
<p class="text-soft">IV Rank: <strong id="optionsIV">67%</strong></p>
<p class="text-soft">Put/Call Ratio: <strong id="putCallRatio">0.85</strong></p>
<div class="mini-label">Sentiment: <span class="badge bg-info" id="optionsSentiment">Bullish</span></div>
</div>
</div>
</div>
<div class="col-12 col-md-6 col-lg-3">
<div class="card asset-type-card h-100" data-asset-type="etfs">
<div class="card-header d-flex justify-content-between align-items-center">
<span>📊 Gold ETFs</span>
<span class="data-badge" id="etfSymbol">GLD/IAU</span>
</div>
<div class="card-body">
<p class="text-soft">GLD: <strong id="gldPrice">$188.45</strong></p>
<p class="text-soft">IAU: <strong id="iauPrice">$35.22</strong></p>
<div class="mini-label">Premium: <span id="etfPremium">-0.03%</span></div>
</div>
</div>
</div>
</div>
</section>
<!-- 2. MARKET OVERVIEW (Top Cards) - Current Status -->
<section>
<h2 class="h4 fw-bold mb-3">📊 Market Overview</h2>
<div class="row g-3 mb-4">
<div class="col-12 col-md-6 col-lg-3">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Market Status</span>
<span class="data-badge" id="badgeMarketStatus">
<span class="status-indicator status-active"></span>Active
              </span>
</div>
<div class="card-body">
<p class="text-soft">Current Regime: <strong id="marketRegime">Bullish Trend</strong></p>
<p class="text-soft">Volatility Index: <strong id="marketVolatility">Medium</strong></p>
<div class="mini-label">Health: <span class="badge bg-success" id="healthStatus">Strong</span></div>
</div>
</div>
</div>
<div class="col-12 col-md-6 col-lg-3">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Today's Recommendation</span>
<span class="data-badge" id="todaySymbol">XAUUSD</span>
</div>
<div class="card-body">
<h5 class="card-title text-success" id="todayAction">BUY</h5>
<p class="text-soft">Entry: <span id="todayEntry">$2,040</span> • Target: <span id="todayTarget">$2,065</span></p>
<p class="text-soft">Confidence: <strong id="todayConfidence">82%</strong></p>
</div>
</div>
</div>
<div class="col-12 col-md-6 col-lg-3">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Risk Alert</span>
<span class="data-badge" id="biasLevel">Low</span>
</div>
<div class="card-body">
<h6 class="text-warning" id="biasHeadline">Fed Policy Uncertainty</h6>
<p class="text-soft" id="biasDetail">Monitor upcoming FOMC statements</p>
<button class="btn btn-sm btn-outline-info" id="learnMoreBias">Learn More</button>
</div>
</div>
</div>
<div class="col-12 col-md-6 col-lg-3">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Portfolio Overview</span>
<span class="data-badge" id="portfolioCcy">USD</span>
</div>
<div class="card-body">
<p class="text-soft">Current Value: <strong id="portfolioValue">$125,340</strong></p>
<p class="text-soft">Daily Change: <strong id="portfolioDailyChange">+2.15%</strong></p>
</div>
</div>
</div>
</div>
</section>
<!-- 3. PRICE PERFORMANCE + ENHANCED ALERTS -->
<section>
<h2 class="h4 fw-bold mb-3">📈 Price Performance &amp; Enhanced Alert System</h2>
<div class="row g-3 mb-4">
<div class="col-12 col-lg-8">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Gold Price Performance</span>
<div class="d-flex align-items-center gap-2">
<div class="form-check form-switch m-0">
<input checked="" class="form-check-input" id="toggleSmoothLines" type="checkbox"/>
<label class="form-check-label">Smooth lines</label>
</div>
</div>
</div>
<div class="card-body small-chart">
<canvas aria-label="Gold price chart" id="goldPriceChart" role="img"></canvas>
</div>
</div>
</div>
<div class="col-12 col-lg-4">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>🚨 Enhanced Alert Center</span>
<div class="d-flex gap-2">
<button class="btn btn-sm btn-outline-warning" id="testAlert" title="Test Alert System">Test</button>
<button class="btn btn-sm btn-outline-info" id="refreshAlerts">Refresh</button>
</div>
</div>
<div class="card-body">
<div class="mb-3">
<div class="form-check form-switch">
<input checked="" class="form-check-input" id="browserNotifications" type="checkbox"/>
<label class="form-check-label text-soft">Browser Notifications</label>
</div>
<div class="form-check form-switch">
<input checked="" class="form-check-input" id="soundAlerts" type="checkbox"/>
<label class="form-check-label text-soft">Sound Alerts</label>
</div>
</div>
<ul class="list-group list-group-flush" id="alertsList">
<li class="list-group-item d-flex justify-content-between align-items-center">
<div>
<div>Price Alert <span class="badge bg-warning">Medium</span></div>
<small class="text-soft">Gold broke $2,040 resistance</small>
</div>
<small class="text-soft">2 min ago</small>
</li>
<li class="list-group-item d-flex justify-content-between align-items-center">
<div>
<div>Volume Spike</div>
<small class="text-soft">Unusual trading volume detected</small>
</div>
<small class="text-soft">5 min ago</small>
</li>
</ul>
</div>
</div>
</div>
</div>
</section>
<!-- 4. 🎯 ENHANCED DECISION ENGINE WITH RISK MANAGEMENT -->
<section>
<h2 class="h4 fw-bold mb-3">🎯 AI Decision Engine - Enhanced with Risk Management</h2>
<div class="row g-3 mb-4">
<div class="col-12">
<div class="card decision-engine-card h-100">
<div class="decision-engine-header">
              Enhanced AI Decision Engine - Personalized Trading with Risk Integration
            </div>
<div class="card-body">
<div class="row g-3">
<!-- Left Column: Basic Trading Info -->
<div class="col-12 col-lg-4">
<h6 class="fw-bold mb-3">📊 Trading Configuration</h6>
<div class="mb-3">
<label class="form-label fw-semibold" for="resolveUserId">User ID</label>
<input class="form-control" id="resolveUserId" placeholder="e.g. user123">
</input></div>
<div class="mb-3">
<label class="form-label fw-semibold" for="selectedAssetType">Asset Type</label>
<select class="form-select" id="selectedAssetType">
<option value="spot">Spot Gold (XAUUSD)</option>
<option value="futures">Gold Futures (GC)</option>
<option value="options">Gold Options (GLD)</option>
<option value="etfs">Gold ETFs (GLD/IAU)</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="tradingStyle">Trading Style</label>
<select class="form-select" id="tradingStyle">
<option value="">Choose…</option>
<option>Day Trading</option>
<option>Swing Trading</option>
<option>Position Trading</option>
<option>Scalping</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="timeFrame">Time Frame</label>
<select class="form-select" id="timeFrame">
<option>15m</option><option>30m</option><option selected="">1h</option><option>4h</option><option>1d</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="investmentAmount">Investment Amount (USD)</label>
<input class="form-control" id="investmentAmount" min="0" placeholder="e.g. 1000" type="number">
</input></div>
<div class="mb-3">
<label class="form-label fw-semibold" for="dailyGoal">Daily Profit Target (USD)</label>
<input class="form-control" id="dailyGoal" min="0" placeholder="e.g. 150" type="number">
</input></div>
</div>
<!-- Middle Column: Risk Management -->
<div class="col-12 col-lg-4">
<div class="risk-management-card p-3 h-100">
<h6 class="fw-bold mb-3">⚠️ Risk Management</h6>
<div class="mb-3">
<label class="form-label fw-semibold" for="riskTolerance">Risk Tolerance</label>
<select class="form-select" id="riskTolerance">
<option value="conservative">Conservative (1-2%)</option>
<option selected="" value="moderate">Moderate (2-5%)</option>
<option value="aggressive">Aggressive (5-10%)</option>
<option value="high_risk">High Risk (10%+)</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="maxDrawdown">Max Drawdown (%)</label>
<input class="form-control" id="maxDrawdown" max="50" min="1" type="number" value="10">
<div class="form-text text-soft">Maximum acceptable portfolio decline</div>
</input></div>
<div class="mb-3">
<label class="form-label fw-semibold" for="positionSizing">Position Sizing Method</label>
<select class="form-select" id="positionSizing">
<option value="fixed_percent">Fixed % of Capital</option>
<option selected="" value="kelly">Kelly Criterion</option>
<option value="volatility_based">Volatility-Based</option>
<option value="risk_parity">Risk Parity</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="stopLossType">Stop Loss Strategy</label>
<select class="form-select" id="stopLossType">
<option value="percentage">Percentage-Based</option>
<option selected="" value="atr">ATR-Based</option>
<option value="support_resistance">Support/Resistance</option>
<option value="trailing">Trailing Stop</option>
</select>
</div>
<div class="mb-3">
<label class="form-label fw-semibold" for="riskRewardRatio">Min Risk/Reward Ratio</label>
<select class="form-select" id="riskRewardRatio">
<option value="1:1">1:1</option>
<option selected="" value="1:2">1:2</option>
<option value="1:3">1:3</option>
<option value="1:4">1:4</option>
</select>
</div>
</div>
</div>
<!-- Right Column: Entry/Target & Execute -->
<div class="col-12 col-lg-4">
<h6 class="fw-bold mb-3">🎯 Entry &amp; Execution</h6>
<div class="mb-3">
<label class="form-label fw-semibold" for="entryPrice">Entry Price (USD)</label>
<input class="form-control" id="entryPrice" min="0" placeholder="e.g. 2035.50" step="0.01" type="number"/>
</div>
<div class="row g-2 mb-3">
<div class="col-6">
<label class="form-label fw-semibold" for="pips">Pips</label>
<input class="form-control" id="pips" placeholder="e.g. 150" type="number"/>
<div class="form-text text-soft">XAUUSD: 1 pip = $0.01</div>
</div>
<div class="col-6">
<label class="form-label fw-semibold" for="targetPrice">Target Price (USD)</label>
<input class="form-control" id="targetPrice" min="0" placeholder="auto from pips" step="0.01" type="number"/>
</div>
</div>
<div class="mb-3">
<label class="form-label fw-semibold">Recommendation Focus</label>
<div class="form-check">
<input checked="" class="form-check-input" id="focusEntry" name="recommendationFocus" type="radio" value="entry"/>
<label class="form-check-label" for="focusEntry">Entry Recommendations</label>
</div>
<div class="form-check">
<input class="form-check-input" id="focusExit" name="recommendationFocus" type="radio" value="exit"/>
<label class="form-check-label" for="focusExit">Exit Strategy</label>
</div>
<div class="form-check">
<input class="form-check-input" id="focusRisk" name="recommendationFocus" type="radio" value="risk"/>
<label class="form-check-label" for="focusRisk">Risk Management</label>
</div>
</div>
<div class="d-grid mb-3">
<button class="btn btn-gold btn-lg fs-5 fw-bold py-3" id="resolveBtn">
                      🧠 Get Enhanced AI Recommendation
                    </button>
</div>
<div class="alert alert-info p-2">
<small><strong>💡 Focus:</strong> Recommendations only - no execution. Use insights to make informed decisions in your preferred trading platform.</small>
</div>
</div>
</div>
<!-- AI Results - Enhanced Layout -->
<div class="row g-3 mt-3">
<div class="col-12 col-lg-6">
<div class="ai-recommendation-result">
<h5 class="fw-bold mb-3">🤖 Enhanced AI Analysis</h5>
<div class="jsection-result">
<pre class="ai-result-text" id="engineResult">Configure your trading preferences and risk parameters above, then click "Get Enhanced AI Recommendation" for comprehensive analysis…</pre>
</div>
</div>
</div>
<div class="col-12 col-lg-6">
<div class="ai-reasoning-result">
<div class="d-flex justify-content-between align-items-center mb-3">
<h5 class="fw-bold mb-0">🧠 Risk-Adjusted Decision Reasoning</h5>
<div class="input-group input-group-sm" style="width:180px;">
<input class="form-control" id="traceIdInput" placeholder="trace id (optional)">
<button class="btn btn-outline-light" id="loadTraceBtn">Load</button>
</input></div>
</div>
<div class="jsection-result">
<pre class="ai-result-text" id="traceResult">View step-by-step AI reasoning including risk management considerations…</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<!-- 5. CUSTOM INDICATOR INTEGRATION -->
<section>
<h2 class="h4 fw-bold mb-3">📊 Custom Indicator Integration</h2>
<div class="row g-3 mb-4">
<div class="col-12">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>🔧 Select Active Indicators</span>
<div class="d-flex gap-2">
<button class="btn btn-sm btn-outline-success" id="selectAllIndicators">Select All</button>
<button class="btn btn-sm btn-outline-warning" id="clearAllIndicators">Clear All</button>
<button class="btn btn-sm btn-gold" id="applyIndicators">Apply Selection</button>
</div>
</div>
<div class="card-body">
<div class="row g-3" id="indicatorGrid">
<!-- Technical Indicators -->
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="sma">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_sma" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_sma">
                        📈 Simple Moving Average (SMA)
                      </label>
</div>
<small class="text-soft">20, 50, 200 period averages</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="ema">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_ema" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_ema">
                        📊 Exponential Moving Average (EMA)
                      </label>
</div>
<small class="text-soft">9, 21, 55 period EMAs</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="rsi">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_rsi" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_rsi">
                        ⚡ Relative Strength Index (RSI)
                      </label>
</div>
<small class="text-soft">14-period momentum oscillator</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="macd">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_macd" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_macd">
                        🌊 MACD
                      </label>
</div>
<small class="text-soft">12,26,9 convergence/divergence</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox" data-indicator="bollinger">
<div class="form-check">
<input class="form-check-input" id="ind_bollinger" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_bollinger">
                        🔍 Bollinger Bands
                      </label>
</div>
<small class="text-soft">20-period, 2 std deviation bands</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox" data-indicator="stochastic">
<div class="form-check">
<input class="form-check-input" id="ind_stochastic" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_stochastic">
                        🎯 Stochastic Oscillator
                      </label>
</div>
<small class="text-soft">%K(14,3) %D(3) momentum indicator</small>
</div>
</div>
<!-- Gold-Specific Indicators -->
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="dxy_correlation">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_dxy" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_dxy">
                        💵 DXY Correlation
                      </label>
</div>
<small class="text-soft">US Dollar Index inverse correlation</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox selected" data-indicator="real_yields">
<div class="form-check">
<input checked="" class="form-check-input" id="ind_yields" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_yields">
                        📊 Real Yields Impact
                      </label>
</div>
<small class="text-soft">10-year TIPS yield analysis</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox" data-indicator="cot_data">
<div class="form-check">
<input class="form-check-input" id="ind_cot" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_cot">
                        📋 COT Positioning
                      </label>
</div>
<small class="text-soft">Commitment of Traders sentiment</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox" data-indicator="gold_miners">
<div class="form-check">
<input class="form-check-input" id="ind_miners" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_miners">
                        ⛏️ Gold Miners Ratio
                      </label>
</div>
<small class="text-soft">GDX/GLD ratio analysis</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox" data-indicator="vix_correlation">
<div class="form-check">
<input class="form-check-input" id="ind_vix" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_vix">
                        🌪️ VIX Correlation
                      </label>
</div>
<small class="text-soft">Fear index correlation analysis</small>
</div>
</div>
<div class="col-12 col-md-6 col-lg-4">
<div class="indicator-checkbox" data-indicator="central_bank_policy">
<div class="form-check">
<input class="form-check-input" id="ind_cb_policy" type="checkbox"/>
<label class="form-check-label fw-semibold" for="ind_cb_policy">
                        🏦 Central Bank Policy
                      </label>
</div>
<small class="text-soft">Fed policy impact assessment</small>
</div>
</div>
</div>
<div class="row g-3 mt-3">
<div class="col-12">
<div class="jsection-result">
<h6 class="fw-bold">Selected Indicators Impact:</h6>
<pre class="ai-result-text" id="indicatorResult">Selected: SMA, EMA, RSI, MACD, DXY Correlation, Real Yields Impact

These indicators suggest:
• Technical momentum is bullish (RSI: 65, MACD positive crossover)
• Moving averages show upward trend confirmation
• DXY weakness supports gold strength
• Real yields declining, favorable for gold
• Overall signal: BULLISH with medium confidence

Apply different combinations to see how they influence AI recommendations…</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<!-- 6. ADVANCED PREDICTIVE ANALYSIS -->
<section>
<h2 class="h4 fw-bold mb-3">🔮 Advanced Predictive Analysis</h2>
<div class="row g-3 mb-4">
<div class="col-12 col-lg-6">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>LSTM Price Prediction</span>
<button class="btn btn-sm btn-outline-info" id="refreshPredict">Refresh</button>
</div>
<div class="card-body">
<div class="mini-label mb-2">Symbol</div>
<div class="input-group mb-3">
<input class="form-control" id="predictSymbol" value="GLD">
<button class="btn btn-outline-light" id="predictBtn">Predict</button>
</input></div>
<div class="jsection-result">
<pre id="predictResult">{
  "symbol": "GLD",
  "current_price": 188.45,
  "predictions": {
    "1_day": {
      "price": 189.75,
      "confidence": 0.78,
      "direction": "UP"
    },
    "7_days": {
      "price": 192.30,
      "confidence": 0.65,
      "direction": "UP"
    },
    "30_days": {
      "price": 195.80,
      "confidence": 0.52,
      "direction": "UP"
    }
  },
  "factors": ["DXY weakness", "Fed dovish signals", "Geopolitical tensions"],
  "risk_assessment": "Medium volatility expected",
  "model_accuracy": "83.5% (last 30 days)"
}</pre>
</div>
</div>
</div>
</div>
<div class="col-12 col-lg-6">
<div class="card h-100">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Bias &amp; Sentiment Analysis</span>
<button class="btn btn-sm btn-outline-info" id="refreshBias">Refresh</button>
</div>
<div class="card-body">
<div class="mini-label mb-2">Symbol</div>
<div class="input-group mb-3">
<input class="form-control" id="biasSymbol" value="GLD">
<button class="btn btn-outline-light" id="biasBtn">Analyze</button>
</input></div>
<div class="jsection-result">
<pre id="biasResult">{
  "symbol": "GLD",
  "sentiment_score": 0.73,
  "sentiment": "Bullish",
  "bias_analysis": {
    "confirmation_bias": 0.45,
    "anchoring_bias": 0.32,
    "recency_bias": 0.28,
    "loss_aversion": 0.51
  },
  "news_sentiment": {
    "positive": 68,
    "neutral": 22,
    "negative": 10
  },
  "social_media_buzz": "High",
  "institutional_flows": "Net buying (+$2.3B this week)",
  "recommendation": "Positive bias detected - validate with technical analysis"
}</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<!-- 7. BEHAVIORAL INTELLIGENCE -->
<section>
<h2 class="h4 fw-bold mb-3">🧠 Behavioral Intelligence</h2>
<div class="row g-3 mb-4">
<div class="col-12">
<div class="card h-100" id="biasInfluenceCard">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Cognitive Bias Influence Map</span>
<button class="btn btn-sm btn-outline-info" id="refreshBiasInfluence">Refresh</button>
</div>
<div class="card-body medium-chart">
<canvas aria-label="Bias influence map" id="biasInfluenceChart" role="img"></canvas>
<div class="mini-label mt-2 text-soft">Identifies potential psychological biases that could impact trading decisions.</div>
</div>
</div>
</div>
</div>
</section>
<!-- 8. MODEL INSIGHTS & CONTINUOUS LEARNING -->
<section>
<h2 class="h4 fw-bold mb-3">📊 Model Insights &amp; Continuous Learning</h2>
<div class="row g-3 mb-4">
<div class="col-12 col-lg-6">
<div class="card h-100" id="featureImportanceCard">
<div class="card-header d-flex justify-content-between align-items-center">
<span>Feature Importance</span>
<span class="data-badge">Model</span>
</div>
<div class="card-body medium-chart">
<canvas aria-label="Feature importance chart" id="featureImportanceChart" role="img"></canvas>
<div class="mini-label mt-2 text-soft">Top drivers behind recent predictions.</div>
</div>
</div>
</div>
<div class="col-12 col-lg-6">
<div class="card h-100">
<div class="card-header">Trade Feedback &amp; Learning</div>
<div class="card-body">
<div class="row g-3">
<div class="col-12 col-md-6">
<div class="mb-3">
<label class="form-label" for="feedbackFollowed">Did you follow the AI recommendation?</label>
<select class="form-select" id="feedbackFollowed">
<option value="">Choose…</option><option value="yes">Yes</option><option value="no">No</option><option value="partial">Partial</option>
</select>
</div>
<div class="mb-3">
<label class="form-label" for="exitPrice">Exit Price (USD)</label>
<input class="form-control" id="exitPrice" min="0" placeholder="e.g. 2038.50" step="0.01" type="number">
<div class="form-text text-soft">Used to calculate realized P&amp;L.</div>
</input></div>
</div>
<div class="col-12 col-md-6">
<div class="mb-3">
<label class="form-label" for="feedbackText">Trade outcome &amp; notes</label>
<textarea class="form-control" id="feedbackText" placeholder="What happened? Market conditions, fills, slippage, emotions…" rows="4"></textarea>
</div>
<div class="d-grid">
<button class="btn btn-outline-info" id="feedbackBtn">Submit Learning Data</button>
</div>
</div>
</div>
<div class="jsection-result mt-3">
<pre id="feedbackResult">Your trading feedback helps improve AI recommendations…

Recent feedback summary:
• 78% follow rate on AI recommendations
• Average P&amp;L when followed: +2.3%
• Most common reasons for not following: "Market volatility", "Risk tolerance"
• AI accuracy improving: 83.5% → 85.2% (last 30 days)</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<!-- Footer -->
<div class="row mt-4">
<div class="col-12 text-center footer">
<small>© <span id="yearNow"></span> GoldMIND AI • <a class="link-muted" href="#" id="viewTraffic">View revision traffic split</a></small>
</div>
</div>
</main>
<!-- Settings Offcanvas -->
<div aria-labelledby="settingsLabel" class="offcanvas offcanvas-end" id="settingsPanel" tabindex="-1">
<div class="offcanvas-header">
<h5 class="offcanvas-title" id="settingsLabel">Settings</h5>
<button aria-label="Close" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" type="button"></button>
</div>
<div class="offcanvas-body">
<div class="form-check form-switch mb-3">
<input checked="" class="form-check-input" id="toggleSmoothLinesSetting" type="checkbox"/>
<label class="form-check-label" for="toggleSmoothLinesSetting">Smooth lines on charts</label>
</div>
<div class="mb-3">
<label class="form-label" for="defaultTradingStyle">Default Trading Style</label>
<select class="form-select" id="defaultTradingStyle">
<option value="">(none)</option>
<option>Day Trading</option><option>Swing Trading</option><option>Position Trading</option><option>Scalping</option>
</select>
</div>
<div class="mb-3">
<label class="form-label" for="defaultTimeFrame">Default Time Frame</label>
<select class="form-select" id="defaultTimeFrame">
<option>15m</option><option>30m</option><option selected="">1h</option><option>4h</option><option>1d</option>
</select>
</div>
<div class="mb-3">
<label class="form-label" for="dailyGoalSetting">Daily Profit Target (USD)</label>
<input class="form-control" id="dailyGoalSetting" min="0" placeholder="e.g. 150" type="number">
</input></div>
<hr/>
<h6 class="fw-bold mb-3">🚨 Alert Settings</h6>
<div class="mb-3">
<label class="form-label" for="alertFrequency">Alert Frequency</label>
<select class="form-select" id="alertFrequency">
<option value="realtime">Real-time</option>
<option selected="" value="5min">Every 5 minutes</option>
<option value="15min">Every 15 minutes</option>
<option value="1hour">Every hour</option>
</select>
</div>
<div class="mb-3">
<label class="form-label" for="priceChangeThreshold">Price Change Alert (%)</label>
<input class="form-control" id="priceChangeThreshold" max="10" min="0.1" step="0.1" type="number" value="2">
<div class="form-text text-soft">Alert when gold moves by this percentage</div>
</input></div>
<div class="form-check form-switch mb-3">
<input checked="" class="form-check-input" id="volatilityAlerts" type="checkbox"/>
<label class="form-check-label">Volatility Spike Alerts</label>
</div>
<div class="form-check form-switch mb-3">
<input checked="" class="form-check-input" id="newsAlerts" type="checkbox"/>
<label class="form-check-label">Economic News Alerts</label>
</div>
<div class="d-grid gap-2">
<button class="btn btn-gold" id="saveSettingsBtn">Save</button>
<div class="text-center mini-label" id="settingsStatus">—</div>
</div>
</div>
</div>
<!-- Help Modal -->
<div aria-hidden="true" aria-labelledby="helpLabel" class="modal fade" id="helpModal" tabindex="-1">
<div class="modal-dialog modal-lg modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="helpLabel">GoldMIND AI – Enhanced Features Guide</h5>
<button aria-label="Close" class="btn-close btn-close-white" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<ol class="text-soft">
<li><strong>🏆 Multi-Asset Gold Prediction</strong>: Unified analysis across spot gold, futures, options, and ETFs with integrated risk tolerance.</li>
<li><strong>📊 Market Overview</strong>: Real-time market status, AI recommendations, bias alerts, and portfolio overview.</li>
<li><strong>🚨 Enhanced Alert System</strong>: Sophisticated browser notifications with sound alerts for price movements, volatility spikes, and news events.</li>
<li><strong>🎯 Enhanced Decision Engine</strong>: Advanced AI with integrated risk management including drawdown limits, position sizing, and risk tolerance.</li>
<li><strong>📊 Custom Indicator Integration</strong>: Select which technical and gold-specific indicators influence AI recommendations.</li>
<li><strong>🔮 Advanced Analysis</strong>: LSTM predictions and sentiment analysis with enhanced accuracy.</li>
<li><strong>🧠 Behavioral Intelligence</strong>: Cognitive bias mapping and transparent reasoning processes.</li>
<li><strong>📊 Continuous Learning</strong>: Enhanced feedback system that improves recommendations based on real trading outcomes.</li>
</ol>
<div class="alert alert-info mt-3">
<strong>💡 Key Enhancement:</strong> This system focuses on providing sophisticated recommendations rather than trade execution. Use these insights to make informed decisions in your preferred trading platform.
          </div>
</div>
<div class="modal-footer">
<button class="btn btn-outline-light" data-bs-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!-- Notification Permission Banner (initially hidden) -->
<div class="notification-banner d-none" id="notificationBanner">
<div class="d-flex justify-content-between align-items-center">
<div>
<strong>🔔 Enable Browser Notifications</strong>
<p class="mb-0 small">Get real-time alerts for gold price movements and trading opportunities.</p>
</div>
<div class="d-flex gap-2">
<button class="btn btn-warning btn-sm" id="enableNotifications">Enable</button>
<button class="btn btn-outline-light btn-sm" id="dismissNotifications">Not Now</button>
</div>
</div>
</div>
<!-- Scripts -->
<!-- 1) Load Chart.js BEFORE your app code -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<!-- 2) (Optional but recommended) Safe wrapper for re-creating charts -->
<script>
(function(){
  if (!window.Chart) return; // wrapper will be redefined after Chart loads if needed
  window.newChart = function(target, config){
    let el=null, ctx=null;
    if (typeof target === 'string') { el = document.getElementById(target); if (!el) return null; ctx = el.getContext('2d'); }
    else if (target && typeof target.getContext === 'function') { el = target; ctx = el.getContext('2d'); }
    else if (target && target.canvas) { ctx = target; el = ctx.canvas; }
    if (!ctx || !el) return null;
    const prev = (Chart.getChart ? Chart.getChart(el) : el._chart) || null;
    if (prev && typeof prev.destroy === 'function') { try{ prev.destroy(); }catch(e){} }
    const chart = new Chart(ctx, config);
    if (!Chart.getChart) el._chart = chart; // legacy
    return chart;
  };
})();
</script>
<!-- 3) Helper to wait until Chart.js is ready -->
<script>
function whenChartReady(cb){
  if (window.Chart) return cb();
  const s = document.querySelector('script[src*="chart"]');
  if (s) return s.addEventListener('load', cb, { once:true });
  const iv = setInterval(() => { if (window.Chart) { clearInterval(iv); cb(); } }, 25);
}
</script>
<!-- 4) Your main inline app code (defines loadGoldPriceChart, loadFeatureImportance, loadBiasInfluence, etc.) -->
 <script src="/dashboard/assets/js/config.js"></script>
<script src="/dashboard/assets/js/api.js"></script>
<script nonce="gmnnonce-2025">
  // ... all your app code and function definitions ...
  // function loadGoldPriceChart(){ ... }
  // function loadFeatureImportance(){ ... }
  // function loadBiasInfluence(){ ... }
</script>
<!-- 5) NOW call the inits (AFTER functions exist) -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  whenChartReady(() => {
    if (typeof loadGoldPriceChart === 'function')   loadGoldPriceChart();
    if (typeof loadFeatureImportance === 'function') loadFeatureImportance();
    if (typeof loadBiasInfluence === 'function')     loadBiasInfluence();
  });
});
</script>

// ======= ENHANCED GOLDMIND AI DASHBOARD FUNCTIONALITY =======

// Global state management
const AppState = {
  selectedAssetType: 'spot',
      selectedIndicators: ['sma', 'ema', 'rsi', 'macd', 'dxy_correlation', 'real_yields'],
      notificationPermission: 'default',
      alertFrequency: '5min',
      theme: 'dark',
      chartInstances: {},
      mockData: {
        multiAsset: {
          spot: { symbol: 'XAUUSD', price: 2045.30, change_24h: 0.85, status: 'Active' },
          futures: { symbol: 'GC', price: 2048.70, volume: '45,230', expiry: 'Dec 2024' },
          options: { symbol: 'GLD', iv_rank: '67%', put_call_ratio: '0.85', sentiment: 'Bullish' },
          etfs: { symbols: 'GLD/IAU', gld_price: 188.45, iau_price: 35.22, premium: '-0.03%' }
        },
        alerts: [
          { title: 'Price Alert', message: 'Gold broke $2,040 resistance', severity: 'medium', time: '2 min ago' },
          { title: 'Volume Spike', message: 'Unusual trading volume detected', severity: 'low', time: '5 min ago' },
          { title: 'Fed Policy Update', message: 'FOMC minutes released', severity: 'high', time: '15 min ago' }
        ]
      }
    };

    // ======= NOTIFICATION SYSTEM =======
    function requestNotificationPermission() {
      if ('Notification' in window) {
        Notification.requestPermission().then(permission => {
          AppState.notificationPermission = permission;
          updateNotificationUI();
          if (permission === 'granted') {
            showSuccessNotification('Notifications enabled! You\'ll now receive real-time trading alerts.');
          }
        });
      }
    }

    function updateNotificationUI() {
      const banner = document.getElementById('notificationBanner');
      const enableBtn = document.getElementById('enableNotificationsBtn');
      
      if (AppState.notificationPermission === 'default') {
        banner?.classList.remove('d-none');
        enableBtn?.classList.remove('d-none');
      } else {
        banner?.classList.add('d-none');
        enableBtn?.classList.add('d-none');
      }
    }

    function showNotification(title, message, type = 'info') {
      // Browser notification
      if (AppState.notificationPermission === 'granted' && document.getElementById('browserNotifications')?.checked) {
        const notification = new Notification(`GoldMIND AI: ${title}`, {
          body: message,
          icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMzIiIGZpbGw9IiNGRkQ3MDAiLz4KPHN2ZyB4PSIxNiIgeT0iMTYiIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjMTQxNDE0Ij4KPHA+U29saWQgZ29sZCBpY29uPC9wPgo8L3N2Zz4KPC9zdmc+',
          tag: 'goldmind-alert',
          requireInteraction: true
        });
        
        notification.onclick = () => {
          window.focus();
          notification.close();
        };
      }

      // In-page notification
      const container = document.getElementById('notificationContainer');
      const alertDiv = document.createElement('div');
      alertDiv.className = 'alert-notification';
      alertDiv.innerHTML = `
        <button class="alert-close-btn" onclick="this.parentElement.remove()">×</button>
        <div class="d-flex align-items-start gap-2">
          <div class="fs-4">${type === 'warning' ? '⚠️' : type === 'success' ? '✅' : 'ℹ️'}</div>
          <div>
            <strong>${title}</strong>
            <p class="mb-0 small">${message}</p>
          </div>
        </div>
      
  .gmwth-header{ position: sticky; top:0; background: rgba(18,20,26,.96); backdrop-filter:saturate(120%) blur(2px);
    display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.08); z-index:2; }
  .gmwth-title{ font-weight:800; letter-spacing:.2px; }
  .gmwth-close{ border:none; background:transparent; color:inherit; font-size:20px; cursor:pointer; padding:6px; line-height:1; border-radius:8px; }
  .gmwth-body{ padding:16px; }
  .gmwth-footer{ position: sticky; bottom:0; background: linear-gradient(to top, rgba(18,20,26,.96), rgba(18,20,26,.0));
    padding:12px 16px; display:flex; justify-content:flex-end; gap:8px; border-top:1px solid rgba(255,255,255,.08); z-index:2; }
  .gmwth-btn{ border:1px solid rgba(255,255,255,.15); border-radius:10px; padding:.45rem .8rem; background:transparent; color:inherit; }
  .gmwth-btn.primary{ background:linear-gradient(135deg,#ffd700,#e6c200); color:#141414; border-color:#d4af00; font-weight:700 }
`;
      
      container.appendChild(alertDiv);
      
      // Play sound if enabled
      if (document.getElementById('soundAlerts')?.checked) {
        playAlertSound(type);
      }
      
      // Auto remove after 8 seconds
      setTimeout(() => {
        if (alertDiv.parentElement) {
          alertDiv.remove();
        }
      }, 8000);
    }

    function showSuccessNotification(message) {
      showNotification('Success', message, 'success');
    }

    function showWarningNotification(message) {
      showNotification('Alert', message, 'warning');
    }

    function playAlertSound(type = 'info') {
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = type === 'warning' ? 800 : type === 'success' ? 600 : 400;
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.5);
      } catch (e) {
        console.log('Audio not available:', e.message);
      }
    }

    // ======= MULTI-ASSET MANAGEMENT =======
    function setupAssetTypeSelection() {
      const cards = document.querySelectorAll('.asset-type-card');
      cards.forEach(card => {
        card.addEventListener('click', () => {
          // Remove active from all cards
          cards.forEach(c => c.classList.remove('active'));
          // Add active to clicked card
          card.classList.add('active');
          
          // Update the select dropdown
          const assetType = card.dataset.assetType;
          document.getElementById('selectedAssetType').value = assetType;
          AppState.selectedAssetType = assetType;
          
          showSuccessNotification(`Selected ${assetType.charAt(0).toUpperCase() + assetType.slice(1)} Gold for analysis`);
          
          // Update relevant displays
          updateAssetSpecificData(assetType);
        });
      });
    }

    function updateAssetSpecificData(assetType) {
      const data = AppState.mockData.multiAsset[assetType];
      if (!data) return;

      // Update recommendation context
      document.getElementById('todaySymbol').textContent = data.symbol || assetType.toUpperCase();
      
      // Update entry price placeholder based on asset type
      const entryPriceInput = document.getElementById('entryPrice');
      if (assetType === 'spot') {
        entryPriceInput.placeholder = 'e.g. 2040.50';
      } else if (assetType === 'etfs') {
        entryPriceInput.placeholder = 'e.g. 188.45';
      }
    }

    // ======= INDICATOR MANAGEMENT =======
    function setupIndicatorSelection() {
      const indicators = document.querySelectorAll('.indicator-checkbox');
      
      indicators.forEach(indicator => {
        const checkbox = indicator.querySelector('input[type="checkbox"]');
        
        checkbox.addEventListener('change', () => {
          indicator.classList.toggle('selected', checkbox.checked);
          updateSelectedIndicators();
        });
        
        // Initialize state
        indicator.classList.toggle('selected', checkbox.checked);
      });

      document.getElementById('selectAllIndicators')?.addEventListener('click', () => {
        indicators.forEach(indicator => {
          const checkbox = indicator.querySelector('input[type="checkbox"]');
          checkbox.checked = true;
          indicator.classList.add('selected');
        });
        updateSelectedIndicators();
      });

      document.getElementById('clearAllIndicators')?.addEventListener('click', () => {
        indicators.forEach(indicator => {
          const checkbox = indicator.querySelector('input[type="checkbox"]');
          checkbox.checked = false;
          indicator.classList.remove('selected');
        });
        updateSelectedIndicators();
      });

      document.getElementById('applyIndicators')?.addEventListener('click', applySelectedIndicators);
    }

    function updateSelectedIndicators() {
      AppState.selectedIndicators = [];
      document.querySelectorAll('.indicator-checkbox input:checked').forEach(checkbox => {
        const indicator = checkbox.closest('.indicator-checkbox');
        AppState.selectedIndicators.push(indicator.dataset.indicator);
      });
    }

    async function applySelectedIndicators() {
      const selectedCount = AppState.selectedIndicators.length;
      
      // Simulate API call with realistic response
      await new Promise(resolve => setTimeout(resolve, 500));
      
      const indicatorAnalysis = generateIndicatorAnalysis(AppState.selectedIndicators);
      document.getElementById('indicatorResult').textContent = indicatorAnalysis;
      
      showSuccessNotification(`Applied ${selectedCount} indicators to AI analysis`);
    }

    function generateIndicatorAnalysis(indicators) {
      const analysis = {
        selected: indicators.map(ind => ind.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())).join(', '),
        signals: []
      };

      // Generate realistic signals based on selected indicators
      if (indicators.includes('sma')) analysis.signals.push('• Moving averages show upward trend confirmation');
      if (indicators.includes('rsi')) analysis.signals.push('• Technical momentum is bullish (RSI: 65, above 50)');
      if (indicators.includes('macd')) analysis.signals.push('• MACD positive crossover detected');
      if (indicators.includes('dxy_correlation')) analysis.signals.push('• DXY weakness supports gold strength');
      if (indicators.includes('real_yields')) analysis.signals.push('• Real yields declining, favorable for gold');
      if (indicators.includes('bollinger')) analysis.signals.push('• Price near upper Bollinger Band, potential resistance');
      if (indicators.includes('vix_correlation')) analysis.signals.push('• VIX elevated, supporting safe-haven demand');

      const bullishSignals = analysis.signals.filter(s => s.includes('bullish') || s.includes('upward') || s.includes('supports')).length;
      const totalSignals = analysis.signals.length;
      const confidence = Math.round((bullishSignals / Math.max(totalSignals, 1)) * 100);
      
      const sentiment = confidence > 60 ? 'BULLISH' : confidence < 40 ? 'BEARISH' : 'NEUTRAL';

      return `Selected: ${analysis.selected}

These indicators suggest:
${analysis.signals.join('\n')}
• Overall signal: ${sentiment} with ${confidence > 70 ? 'high' : confidence > 50 ? 'medium' : 'low'} confidence

Apply different combinations to see how they influence AI recommendations…`;
    }

    // ======= ENHANCED DECISION ENGINE =======
    function setupDecisionEngine() {
      // Pips to target price calculation
      document.getElementById('pips')?.addEventListener('input', updateTargetFromPips);
      document.getElementById('targetPrice')?.addEventListener('input', updatePipsFromTarget);
      document.getElementById('entryPrice')?.addEventListener('input', () => {
        updateTargetFromPips();
        updatePipsFromTarget();
      });

      // Main resolution button
      document.getElementById('resolveBtn')?.addEventListener('click', generateEnhancedRecommendation);
      
      // Trace loading
      document.getElementById('loadTraceBtn')?.addEventListener('click', loadDecisionTrace);
    }

    function updateTargetFromPips() {
      const entry = parseFloat(document.getElementById('entryPrice')?.value || 0);
      const pips = parseFloat(document.getElementById('pips')?.value || 0);
      if (isFinite(entry) && isFinite(pips) && entry > 0 && pips !== 0) {
        const pipValue = AppState.selectedAssetType === 'spot' ? 0.01 : 0.01; // Adjust per asset type
        document.getElementById('targetPrice').value = (entry + (pips * pipValue)).toFixed(2);
      }
    }

    function updatePipsFromTarget() {
      const entry = parseFloat(document.getElementById('entryPrice')?.value || 0);
      const target = parseFloat(document.getElementById('targetPrice')?.value || 0);
      if (isFinite(entry) && isFinite(target) && entry > 0 && target > 0) {
        const pipValue = AppState.selectedAssetType === 'spot' ? 0.01 : 0.01;
        document.getElementById('pips').value = Math.round((target - entry) / pipValue);
      }
    }

    async function generateEnhancedRecommendation() {
      const button = document.getElementById('resolveBtn');
      const originalText = button.innerHTML;
      button.innerHTML = '🔄 Analyzing...';
      button.disabled = true;

      try {
        // Collect all parameters
        const config = {
          user_id: document.getElementById('resolveUserId')?.value || 'demo_user',
          asset_type: document.getElementById('selectedAssetType')?.value || 'spot',
          trading_style: document.getElementById('tradingStyle')?.value || 'Swing Trading',
          timeframe: document.getElementById('timeFrame')?.value || '1h',
          capital: parseFloat(document.getElementById('investmentAmount')?.value || 10000),
          daily_goal: parseFloat(document.getElementById('dailyGoal')?.value || 150),
          entry_price: parseFloat(document.getElementById('entryPrice')?.value || 2040),
          pips: parseFloat(document.getElementById('pips')?.value || 50),
          target_price: parseFloat(document.getElementById('targetPrice')?.value || 2045),
          risk_tolerance: document.getElementById('riskTolerance')?.value || 'moderate',
          max_drawdown: parseFloat(document.getElementById('maxDrawdown')?.value || 10),
          position_sizing: document.getElementById('positionSizing')?.value || 'kelly',
          stop_loss_type: document.getElementById('stopLossType')?.value || 'atr',
          risk_reward_ratio: document.getElementById('riskRewardRatio')?.value || '1:2',
          recommendation_focus: document.querySelector('input[name="recommendationFocus"]:checked')?.value || 'entry',
          selected_indicators: AppState.selectedIndicators
        };

        // Simulate API processing
        await new Promise(resolve => setTimeout(resolve, 2000));

        // Generate comprehensive recommendation
        const recommendation = generateMockRecommendation(config);
        document.getElementById('engineResult').textContent = recommendation;

        // Generate reasoning
        const reasoning = generateMockReasoning(config);
        document.getElementById('traceResult').textContent = reasoning;

        showSuccessNotification('Enhanced AI recommendation generated successfully!');

      } catch (error) {
        document.getElementById('engineResult').textContent = 'Error generating recommendation: ' + error.message;
        showWarningNotification('Failed to generate recommendation. Please try again.');
      } finally {
        button.innerHTML = originalText;
        button.disabled = false;
      }
    }

    function generateMockRecommendation(config) {
      const isLong = config.entry_price < config.target_price;
      const riskAmount = (config.capital * (config.max_drawdown / 100));
      const potentialProfit = Math.abs(config.target_price - config.entry_price);
      const stopLoss = isLong ? 
        config.entry_price - (potentialProfit * 0.5) : 
        config.entry_price + (potentialProfit * 0.5);

      return `{
  "recommendation": {
    "action": "${isLong ? 'BUY' : 'SELL'}",
    "asset": "${config.asset_type.toUpperCase()}",
    "symbol": "${config.asset_type === 'spot' ? 'XAUUSD' : config.asset_type === 'etfs' ? 'GLD' : 'GC'}",
    "confidence": ${Math.random() * 0.3 + 0.65},
    "entry_price": ${config.entry_price},
    "target_price": ${config.target_price},
    "stop_loss": ${stopLoss.toFixed(2)},
    "risk_reward_ratio": "${config.risk_reward_ratio}"
  },
  "risk_management": {
    "position_size": "${Math.round(riskAmount)}",
    "max_risk": "${config.max_drawdown}%",
    "sizing_method": "${config.position_sizing}",
    "stop_type": "${config.stop_loss_type}",
    "risk_per_trade": "${Math.round(riskAmount * 0.02)}"
  },
  "market_analysis": {
    "trend": "${isLong ? 'Bullish' : 'Bearish'}",
    "volatility": "Medium",
    "support_levels": [${(config.entry_price - 5).toFixed(2)}, ${(config.entry_price - 10).toFixed(2)}],
    "resistance_levels": [${(config.target_price + 5).toFixed(2)}, ${(config.target_price + 10).toFixed(2)}]
  },
  "indicators_used": ${JSON.stringify(config.selected_indicators)},
  "timeframe": "${config.timeframe}",
  "strategy": "${config.trading_style}",
  "expected_duration": "${config.trading_style === 'Day Trading' ? '4-8 hours' : config.trading_style === 'Scalping' ? '15-30 minutes' : '1-3 days'}",
  "notes": "Based on ${config.selected_indicators.length} technical indicators and current market conditions. Risk-adjusted for ${config.risk_tolerance} tolerance."
}`;
    }

    function generateMockReasoning(config) {
      return `ENHANCED AI DECISION REASONING
================================

RISK ASSESSMENT:
• Capital at Risk: ${config.max_drawdown}% (${config.risk_tolerance} tolerance)
• Position Sizing: ${config.position_sizing} method selected
• Stop Loss Strategy: ${config.stop_loss_type}-based protection

TECHNICAL ANALYSIS:
• Selected Indicators: ${config.selected_indicators.length} active
• Primary Signal: ${config.entry_price < config.target_price ? 'BULLISH' : 'BEARISH'} momentum
• Timeframe Focus: ${config.timeframe} chart analysis
• Trading Style: Optimized for ${config.trading_style}

MARKET CONTEXT:
• Asset Type: ${config.asset_type.toUpperCase()} gold exposure
• Current Regime: Trending market conditions
• Volatility Environment: Medium (suitable for ${config.trading_style})

RECOMMENDATION LOGIC:
1. Entry Trigger: Technical confluence at ${config.entry_price}
2. Target Rationale: ${config.risk_reward_ratio} risk-reward ratio
3. Risk Controls: ATR-based stops with ${config.max_drawdown}% maximum portfolio risk
4. Position Size: Kelly Criterion suggests optimal allocation
5. Time Horizon: ${config.trading_style === 'Day Trading' ? 'Intraday' : 'Multi-day'} holding period

BIAS CHECKS:
✓ Confirmation bias: Multiple indicator validation
✓ Anchoring: Entry based on technical levels, not round numbers
✓ Overconfidence: Risk limits enforced regardless of confidence
✓ Recency bias: Long-term trend context included

EXECUTION NOTES:
• Monitor for ${config.recommendation_focus === 'entry' ? 'optimal entry conditions' : config.recommendation_focus === 'exit' ? 'profit-taking opportunities' : 'risk management triggers'}
• Daily target: ${config.daily_goal} (${((config.daily_goal / config.capital) * 100).toFixed(2)}% of capital)
• Market hours: Consider liquidity patterns for ${config.asset_type} trading

This recommendation integrates technical analysis, risk management, and behavioral safeguards for enhanced decision-making.`;
    }

    async function loadDecisionTrace() {
      const traceId = document.getElementById('traceIdInput')?.value?.trim();
      const output = document.getElementById('traceResult');
      
      output.textContent = 'Loading trace…';
      
      try {
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        if (traceId) {
          output.textContent = `TRACE ID: ${traceId}
DECISION PATH ANALYSIS
=====================

This trace shows how the AI reached its recommendation:

1. Data Ingestion (0.12s)
   - Market data: XAUUSD, DXY, TIPS yields
   - Technical indicators: ${AppState.selectedIndicators.length} active
   - Risk parameters: User-defined tolerances

2. Feature Processing (0.34s)
   - Price action analysis: Bullish momentum detected
   - Indicator confluence: 78% agreement
   - Risk-reward calculation: 1:2.3 ratio available

3. Model Inference (0.45s)
   - LSTM prediction: 73% confidence UP
   - Ensemble vote: 4/5 models agree
   - Bias adjustment: -0.03 recency correction

4. Risk Integration (0.18s)
   - Position sizing: Kelly suggests 3.2% allocation
   - Drawdown check: Within ${document.getElementById('maxDrawdown')?.value || 10}% limit
   - Stop placement: ATR(14) = $8.50

5. Final Validation (0.09s)
   - Sanity checks: PASSED
   - Risk controls: ACTIVE
   - Confidence threshold: MET (>65%)

TOTAL PROCESSING: 1.18s
RECOMMENDATION: HIGH CONFIDENCE BUY`;
        } else {
          output.textContent = 'Enter a trace ID to load specific decision analysis, or leave blank for the most recent trace.';
        }
      } catch (error) {
        output.textContent = 'Error loading trace: ' + error.message;
      }
    }

    // ======= CHART MANAGEMENT =======
    function setupCharts() {
      setupGoldPriceChart();
      setupBiasInfluenceChart();
      setupFeatureImportanceChart();
    }

    function setupGoldPriceChart() {
      const canvas = document.getElementById('goldPriceChart');
      if (!canvas || !window.Chart) return;

      const ctx = canvas.getContext('2d');
      
      // Generate mock price data
      const labels = [];
      const prices = [];
      const basePrice = 2040;
      
      for (let i = 30; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        labels.push(date.toLocaleDateString());
        prices.push(basePrice + (Math.random() - 0.5) * 40 + i * 0.3);
      }

      AppState.chartInstances.goldPrice = newChart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'Gold Price (USD)',
            data: prices,
            borderColor: '#ffd700',
            backgroundColor: 'rgba(255, 215, 0, 0.1)',
            borderWidth: 2,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          elements: {
            line: {
              tension: document.getElementById('toggleSmoothLines')?.checked ? 0.35 : 0
            }
          },
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.body).getPropertyValue('--soft')
              }
            }
          },
          scales: {
            x: {
              ticks: { color: getComputedStyle(document.body).getPropertyValue('--soft') },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            y: {
              ticks: { color: getComputedStyle(document.body).getPropertyValue('--soft') },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            }
          }
        }
      });

      // Toggle smooth lines functionality
      document.getElementById('toggleSmoothLines')?.addEventListener('change', function() {
        if (AppState.chartInstances.goldPrice) {
          AppState.chartInstances.goldPrice.options.elements.line.tension = this.checked ? 0.35 : 0;
          AppState.chartInstances.goldPrice.update();
        }
      });
    }

    function setupBiasInfluenceChart() {
      const canvas = document.getElementById('biasInfluenceChart');
      if (!canvas || !window.Chart) return;

      const ctx = canvas.getContext('2d');
      const biasLabels = [
        'Confirmation Bias',
        'Anchoring Bias', 
        'Recency Bias',
        'Loss Aversion',
        'Overconfidence',
        'Herd Mentality'
      ];
      const biasValues = [0.45, 0.32, 0.28, 0.51, 0.38, 0.42];

      AppState.chartInstances.biasInfluence = newChart(ctx, {
        type: 'radar',
        data: {
          labels: biasLabels,
          datasets: [{
            label: 'Bias Influence',
            data: biasValues,
            borderColor: '#ff5a5f',
            backgroundColor: 'rgba(255, 90, 95, 0.1)',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.body).getPropertyValue('--soft')
              }
            }
          },
          scales: {
            r: {
              beginAtZero: true,
              max: 1,
              ticks: { color: getComputedStyle(document.body).getPropertyValue('--soft') },
              grid: { color: 'rgba(255, 255, 255, 0.1)' },
              pointLabels: { color: getComputedStyle(document.body).getPropertyValue('--soft') }
            }
          }
        }
      });
    }

    function setupFeatureImportanceChart() {
      const canvas = document.getElementById('featureImportanceChart');
      if (!canvas || !window.Chart) return;

      const ctx = canvas.getContext('2d');
      const features = ['DXY Correlation', 'Real Yields', 'RSI', 'MACD', 'SMA Trend', 'Volume', 'VIX', 'Fed Policy'];
      const importance = [0.23, 0.19, 0.15, 0.12, 0.11, 0.08, 0.07, 0.05];

      AppState.chartInstances.featureImportance = newChart(ctx, {
        type: 'bar',
        data: {
          labels: features,
          datasets: [{
            label: 'Importance',
            data: importance,
            backgroundColor: '#3ab0ff',
            borderColor: '#2196f3',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.body).getPropertyValue('--soft')
              }
            }
          },
          scales: {
            x: {
              ticks: { 
                color: getComputedStyle(document.body).getPropertyValue('--soft'),
                maxRotation: 45
              },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            y: {
              ticks: { color: getComputedStyle(document.body).getPropertyValue('--soft') },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            }
          }
        }
      });
    }

    // ======= ALERT SYSTEM =======
    function setupAlertSystem() {
      // Test alert functionality
      document.getElementById('testAlert')?.addEventListener('click', () => {
        showWarningNotification('This is a test alert! Gold price movement detected at $2,045.30');
      });

      // Refresh alerts
      document.getElementById('refreshAlerts')?.addEventListener('click', refreshAlerts);

      // Start periodic alert checking
      startPeriodicAlerts();
    }

    function refreshAlerts() {
      const alertsList = document.getElementById('alertsList');
      if (!alertsList) return;

      // Add a new mock alert
      const newAlerts = [
        { title: 'Breakout Alert', message: 'Gold broke key resistance level', severity: 'high', time: 'Just now' },
        { title: 'Volume Surge', message: 'Trading volume 150% above average', severity: 'medium', time: '1 min ago' }
      ];

      const randomAlert = newAlerts[Math.floor(Math.random() * newAlerts.length)];
      
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `
        <div>
          <div>${randomAlert.title} <span class="badge bg-${randomAlert.severity === 'high' ? 'danger' : 'warning'}">${randomAlert.severity}</span></div>
          <small class="text-soft">${randomAlert.message}</small>
        </div>
        <small class="text-soft">${randomAlert.time}</small>
      `;
      
      alertsList.insertBefore(li, alertsList.firstChild);
      
      // Remove old alerts if too many
      if (alertsList.children.length > 5) {
        alertsList.removeChild(alertsList.lastChild);
      }

      showSuccessNotification('Alerts refreshed');
    }

    function startPeriodicAlerts() {
      // Simulate periodic price alerts
      setInterval(() => {
        if (Math.random() < 0.1) { // 10% chance every interval
          const priceChange = (Math.random() - 0.5) * 4; // ±2%
          const currentPrice = 2045.30 + priceChange;
          
          if (Math.abs(priceChange) > 1) {
            const direction = priceChange > 0 ? 'up' : 'down';
            showNotification(
              'Price Alert',
              `Gold moved ${direction} to ${currentPrice.toFixed(2)} (${priceChange > 0 ? '+' : ''}${priceChange.toFixed(2)}%)`,
              'warning'
            );
          }
        }
      }, 30000); // Check every 30 seconds
    }

    // ======= PREDICTIVE ANALYSIS =======
    function setupPredictiveAnalysis() {
      document.getElementById('predictBtn')?.addEventListener('click', generatePrediction);
      document.getElementById('biasBtn')?.addEventListener('click', generateBiasAnalysis);
      document.getElementById('refreshPredict')?.addEventListener('click', generatePrediction);
      document.getElementById('refreshBias')?.addEventListener('click', generateBiasAnalysis);
      document.getElementById('refreshBiasInfluence')?.addEventListener('click', () => {
        setupBiasInfluenceChart(); // Refresh the chart
        showSuccessNotification('Bias influence map updated');
      });
    }

    async function generatePrediction() {
      const symbol = document.getElementById('predictSymbol')?.value || 'GLD';
      const resultElement = document.getElementById('predictResult');
      
      resultElement.textContent = 'Generating LSTM prediction...';
      
      try {
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        const basePrice = symbol === 'GLD' ? 188.45 : 2045.30;
        const prediction = {
          symbol: symbol,
          current_price: basePrice,
          predictions: {
            "1_day": {
              price: basePrice * (1 + (Math.random() - 0.4) * 0.02),
              confidence: 0.75 + Math.random() * 0.15,
              direction: Math.random() > 0.3 ? "UP" : "DOWN"
            },
            "7_days": {
              price: basePrice * (1 + (Math.random() - 0.3) * 0.05),
              confidence: 0.60 + Math.random() * 0.15,
              direction: Math.random() > 0.3 ? "UP" : "DOWN"
            },
            "30_days": {
              price: basePrice * (1 + (Math.random() - 0.2) * 0.08),
              confidence: 0.45 + Math.random() * 0.15,
              direction: Math.random() > 0.3 ? "UP" : "DOWN"
            }
          },
          factors: ["DXY weakness", "Fed dovish signals", "Geopolitical tensions", "Inflation concerns"],
          risk_assessment: "Medium volatility expected",
          model_accuracy: `${(80 + Math.random() * 10).toFixed(1)}% (last 30 days)`
        };
        
        prediction.predictions["1_day"].price = prediction.predictions["1_day"].price.toFixed(2);
        prediction.predictions["7_days"].price = prediction.predictions["7_days"].price.toFixed(2);
        prediction.predictions["30_days"].price = prediction.predictions["30_days"].price.toFixed(2);
        
        resultElement.textContent = JSON.stringify(prediction, null, 2);
        showSuccessNotification(`LSTM prediction generated for ${symbol}`);
        
      } catch (error) {
        resultElement.textContent = 'Error generating prediction: ' + error.message;
      }
    }

    async function generateBiasAnalysis() {
      const symbol = document.getElementById('biasSymbol')?.value || 'GLD';
      const resultElement = document.getElementById('biasResult');
      
      resultElement.textContent = 'Analyzing market bias and sentiment...';
      
      try {
        await new Promise(resolve => setTimeout(resolve, 1200));
        
        const analysis = {
          symbol: symbol,
          sentiment_score: 0.5 + Math.random() * 0.4,
          sentiment: Math.random() > 0.3 ? "Bullish" : "Bearish",
          bias_analysis: {
            confirmation_bias: Math.random() * 0.6,
            anchoring_bias: Math.random() * 0.5,
            recency_bias: Math.random() * 0.4,
            loss_aversion: Math.random() * 0.7
          },
          news_sentiment: {
            positive: Math.floor(Math.random() * 40) + 50,
            neutral: Math.floor(Math.random() * 30) + 15,
            negative: Math.floor(Math.random() * 25) + 5
          },
          social_media_buzz: ["High", "Medium", "Low"][Math.floor(Math.random() * 3)],
          institutional_flows: `${Math.random() > 0.5 ? 'Net buying' : 'Net selling'} (${(Math.random() * 5).toFixed(1)}B this week)`,
          recommendation: "Monitor bias levels - validate with technical analysis"
        };
        
        // Ensure percentages add up to roughly 100
        const total = analysis.news_sentiment.positive + analysis.news_sentiment.neutral + analysis.news_sentiment.negative;
        analysis.news_sentiment.positive = Math.round((analysis.news_sentiment.positive / total) * 100);
        analysis.news_sentiment.neutral = Math.round((analysis.news_sentiment.neutral / total) * 100);
        analysis.news_sentiment.negative = 100 - analysis.news_sentiment.positive - analysis.news_sentiment.neutral;
        
        resultElement.textContent = JSON.stringify(analysis, null, 2);
        showSuccessNotification(`Bias analysis completed for ${symbol}`);
        
      } catch (error) {
        resultElement.textContent = 'Error analyzing bias: ' + error.message;
      }
    }

    // ======= FEEDBACK SYSTEM =======
    function setupFeedbackSystem() {
      document.getElementById('feedbackBtn')?.addEventListener('click', submitTradeFeedback);
    }

    async function submitTradeFeedback() {
      const followed = document.getElementById('feedbackFollowed')?.value;
      const exitPrice = document.getElementById('exitPrice')?.value;
      const notes = document.getElementById('feedbackText')?.value;
      
      if (!followed) {
        showWarningNotification('Please select whether you followed the recommendation');
        return;
      }
      
      const resultElement = document.getElementById('feedbackResult');
      resultElement.textContent = 'Submitting feedback...';
      
      try {
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        const feedback = {
          status: 'success',
          message: 'Feedback received and processed',
          feedback_id: 'FB' + Date.now(),
          followed: followed,
          exit_price: exitPrice ? parseFloat(exitPrice) : null,
          notes: notes || '',
          impact: 'Your feedback helps improve AI recommendation accuracy',
          stats: {
            total_feedback: Math.floor(Math.random() * 500) + 200,
            follow_rate: `${Math.floor(Math.random() * 20) + 70}%`,
            avg_performance: `+${(Math.random() * 3 + 1).toFixed(1)}%`,
            accuracy_improvement: '+1.7% this month'
          }
        };
        
        resultElement.textContent = `Your trading feedback helps improve AI recommendations…

Recent feedback summary:
• ${feedback.stats.follow_rate} follow rate on AI recommendations
• Average P&L when followed: ${feedback.stats.avg_performance}
• Most common reasons for not following: "Market volatility", "Risk tolerance"
• AI accuracy improving: ${feedback.stats.accuracy_improvement}

Thank you for helping make GoldMIND AI better!`;
        
        // Clear form
        document.getElementById('feedbackFollowed').value = '';
        document.getElementById('exitPrice').value = '';
        document.getElementById('feedbackText').value = '';
        
        showSuccessNotification('Feedback submitted successfully');
        
      } catch (error) {
        resultElement.textContent = 'Error submitting feedback: ' + error.message;
      }
    }

    // ======= SETTINGS MANAGEMENT =======
    function setupSettings() {
      // Theme toggle
      document.getElementById('themeToggle')?.addEventListener('change', function() {
        applyTheme(this.checked ? 'light' : 'dark');
      });
      
      // Settings save
      document.getElementById('saveSettingsBtn')?.addEventListener('click', saveSettings);
      
      // Notification setup
      document.getElementById('enableNotifications')?.addEventListener('click', requestNotificationPermission);
      document.getElementById('dismissNotifications')?.addEventListener('click', () => {
        document.getElementById('notificationBanner')?.classList.add('d-none');
      });
      
      // Load saved settings
      loadSettings();
    }

    function applyTheme(theme) {
      document.body.classList.toggle('theme-light', theme === 'light');
      AppState.theme = theme;
      localStorage.setItem('goldmind_theme', theme);
      
      // Update chart colors
      updateChartColors();
    }

    function updateChartColors() {
      const softColor = getComputedStyle(document.body).getPropertyValue('--soft').trim();
      
      Object.values(AppState.chartInstances).forEach(chart => {
        if (chart && chart.options) {
          // Update axis colors
          if (chart.options.scales) {
            Object.values(chart.options.scales).forEach(scale => {
              if (scale.ticks) scale.ticks.color = softColor;
              if (scale.pointLabels) scale.pointLabels.color = softColor;
            });
          }
          
          // Update legend colors
          if (chart.options.plugins && chart.options.plugins.legend) {
            chart.options.plugins.legend.labels.color = softColor;
          }
          
          chart.update();
        }
      });
    }

    function saveSettings() {
      const settings = {
        smoothLines: document.getElementById('toggleSmoothLinesSetting')?.checked,
        defaultTradingStyle: document.getElementById('defaultTradingStyle')?.value,
        defaultTimeFrame: document.getElementById('defaultTimeFrame')?.value,
        dailyGoal: document.getElementById('dailyGoalSetting')?.value,
        alertFrequency: document.getElementById('alertFrequency')?.value,
        priceChangeThreshold: document.getElementById('priceChangeThreshold')?.value,
        volatilityAlerts: document.getElementById('volatilityAlerts')?.checked,
        newsAlerts: document.getElementById('newsAlerts')?.checked
      };
      
      localStorage.setItem('goldmind_settings', JSON.stringify(settings));
      document.getElementById('settingsStatus').textContent = 'Settings saved!';
      
      setTimeout(() => {
        document.getElementById('settingsStatus').textContent = '—';
      }, 3000);
      
      showSuccessNotification('Settings saved successfully');
    }

    function loadSettings() {
      try {
        const saved = localStorage.getItem('goldmind_settings');
        if (saved) {
          const settings = JSON.parse(saved);
          
          // Apply saved settings
          if (settings.smoothLines !== undefined) {
            document.getElementById('toggleSmoothLinesSetting').checked = settings.smoothLines;
          }
          if (settings.defaultTradingStyle) {
            document.getElementById('defaultTradingStyle').value = settings.defaultTradingStyle;
            document.getElementById('tradingStyle').value = settings.defaultTradingStyle;
          }
          if (settings.defaultTimeFrame) {
            document.getElementById('defaultTimeFrame').value = settings.defaultTimeFrame;
            document.getElementById('timeFrame').value = settings.defaultTimeFrame;
          }
          if (settings.dailyGoal) {
            document.getElementById('dailyGoalSetting').value = settings.dailyGoal;
            document.getElementById('dailyGoal').value = settings.dailyGoal;
          }
        }
        
        // Load theme
        const savedTheme = localStorage.getItem('goldmind_theme') || 'dark';
        document.getElementById('themeToggle').checked = savedTheme === 'light';
        applyTheme(savedTheme);
        
      } catch (error) {
        console.log('Error loading settings:', error);
      }
    }

    // ======= INITIALIZATION =======
    document.addEventListener('DOMContentLoaded', async () => {
      // Set current year
      document.getElementById('yearNow').textContent = new Date().getFullYear();

      // Check notification permission
      if ('Notification' in window) {
        AppState.notificationPermission = Notification.permission;
        updateNotificationUI();
      }

      // Initialize all systems
      setupSettings();
      setupAssetTypeSelection();
      setupIndicatorSelection();
      setupDecisionEngine();
      setupCharts();
      setupAlertSystem();
      setupPredictiveAnalysis();
      setupFeedbackSystem();

      // Set default active asset
      document.querySelector('.asset-type-card[data-asset-type="spot"]')?.classList.add('active');
      
      // Show welcome notification
      setTimeout(() => {
        showSuccessNotification('Welcome to Enhanced GoldMIND AI! All systems initialized and ready for trading analysis.');
      }, 1000);

      // Add some demo data updates
      setTimeout(() => {
        updateDemoData();
      }, 3000);
    });

    // ======= DEMO DATA UPDATES =======
    function updateDemoData() {
      // Update spot price with small random changes
      setInterval(() => {
        const currentElement = document.getElementById('spotCurrentPrice');
        if (currentElement) {
          const current = parseFloat(currentElement.textContent.replace('$', '').replace(',', ''));
          const change = (Math.random() - 0.5) * 2; // ±$1
          const newPrice = current + change;
          currentElement.textContent = `${newPrice.toFixed(2)}`;
          
          // Update change percentage
          const changePercent = (change / current * 100);
          const changeElement = document.getElementById('spot24hChange');
          if (changeElement) {
            changeElement.textContent = `${changePercent > 0 ? '+' : ''}${changePercent.toFixed(2)}%`;
            changeElement.className = changePercent > 0 ? 'text-success' : 'text-danger';
          }
        }
      }, 10000); // Update every 10 seconds
    }

    // ======= UTILITIES =======
    function formatCurrency(value, decimals = 2) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals
      }).format(value);
    }

    function formatPercentage(value, decimals = 2) {
      return `${value > 0 ? '+' : ''}${value.toFixed(decimals)}%`;
    }

    // Global error handler
    window.addEventListener('error', function(e) {
      console.error('Global error:', e.error);
      showWarningNotification('An error occurred. Please refresh the page if problems persist.');
    });

    // Export for debugging
    window.GoldMindApp = {
      AppState,
      showNotification,
      generateEnhancedRecommendation,
      applySelectedIndicators
    };
  </script>
<!-- GoldMIND AI: Live wiring + theme toggle (do not change layout) -->

<script nonce="gmnnonce-2025">
(function(){
  const CONFIG = {
    NETLIFY_PROXY_BASE: '/api',
    CLOUDRUN_API_BASE: 'https://goldmind-api-884387776097.us-central1.run.app',
    DEFAULT_SYMBOL_XAU: 'XAUUSD',
    DEFAULT_YF_SYMBOL: 'XAUUSD=X',
    TIMEOUT_MS: 15000,
    THEME_STORAGE_KEY: 'gm_theme' // 'light' | 'dark'
  };

  // ===== Theme handling (robust, CSS-agnostic) =====
  function applyTheme(theme){
    const root = document.documentElement; // <html>
    const body = document.body;
    const isLight = theme === 'light';
    // Prefer data-theme to avoid clashing with existing CSS;
    // many dashboards already key off [data-theme="light|dark"]
    root.setAttribute('data-theme', theme);
    body.classList.toggle('theme-light', isLight);
    body.classList.toggle('theme-dark', !isLight);
    try { localStorage.setItem(CONFIG.THEME_STORAGE_KEY, theme); } catch(e){}
    // Reflect UI toggle if present
    const t = document.getElementById('themeToggle');
    if (t && 'checked' in t) t.checked = isLight;
  }
  function currentTheme(){
    try {
      const v = localStorage.getItem(CONFIG.THEME_STORAGE_KEY);
      if (v === 'light' || v === 'dark') return v;
    } catch(e) {}
    // Auto default based on prefers-color-scheme if not stored
    return (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) ? 'light' : 'dark';
  }
  function toggleTheme(){
    const next = currentTheme() === 'light' ? 'dark' : 'light';
    applyTheme(next);
  }
  function wireThemeToggle(){
    const t = document.getElementById('themeToggle');
    if (t) {
      // treat checked = light (so it's visible on both themes)
      t.addEventListener('change', () => applyTheme(t.checked ? 'light' : 'dark'));
      // init position
      t.checked = currentTheme() === 'light';
    }
    // Optional extra triggers (e.g., buttons with data-action="toggle-theme")
    document.querySelectorAll('[data-action="toggle-theme"]').forEach(btn => {
      btn.addEventListener('click', toggleTheme);
    });
    // Apply immediately on load
    applyTheme(currentTheme());
  }

  // ===== Networking helpers =====
  async function fetchJson(url, options = {}){
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(), CONFIG.TIMEOUT_MS);
    try {
      const resp = await fetch(url, { ...options, signal: controller.signal });
      if (!resp.ok) throw new Error(`${resp.status} ${resp.statusText}`);
      return await resp.json();
    } finally {
      clearTimeout(id);
    }
  }
  function showGlobalError(msg){
    const el = document.getElementById('globalError');
    if (!el) return;
    el.textContent = msg;
    el.classList.remove('d-none');
  }
  function hideGlobalError(){
    const el = document.getElementById('globalError');
    if (el) el.classList.add('d-none');
  }
  let API_BASE = CONFIG.NETLIFY_PROXY_BASE;
  async function decideApiBase(){
    try {
      await fetchJson(`${CONFIG.NETLIFY_PROXY_BASE}/health`);
      API_BASE = CONFIG.NETLIFY_PROXY_BASE;
    } catch {
      API_BASE = CONFIG.CLOUDRUN_API_BASE;
    }
    console.log('[GoldMIND] API_BASE =', API_BASE);
  }
  function toast(title, message, type='info'){
    if (window.showNotification) { window.showNotification(title, message, type); }
    else { console.log(`${title}: ${message}`); }
  }

  // ===== Data Loaders =====
  async function loadHealth(){
    const data = await fetchJson(`${API_BASE}/health`);
    const badge = document.getElementById('badgeMarketStatus');
    if (badge) {
      badge.innerHTML = `<span class="status-indicator ${data.status==='ok'?'status-active':'status-warning'}"></span>${data.status==='ok'?'Active':'Degraded'}`;
    }
  }
  async function loadSpot(){
    const data = await fetchJson(`${API_BASE}/market/gold/series`
);
    const fmtUSD = n => (Number(n)||0).toLocaleString('en-US', {style:'currency', currency:'USD'});
    const set = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
    set('spotGoldPrice', data.symbol ?? 'XAUUSD');
    set('spotCurrentPrice', fmtUSD(data.price));
    set('spot24hChange', (data.change_24h ?? 0).toFixed(2) + '%');
    const st = document.getElementById('spotStatus');
    if (st) st.classList.add('bg-success');
  }
  let priceChart;
  function chartOptions(){
    return {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { ticks: { autoSkip: true, maxTicksLimit: 8 } },
        y: { ticks: { callback: v => '$' + Number(v).toLocaleString() } }
      },
      plugins: { legend: { display: false } }
    };
  }
  async function loadSeries(){
    const payload = await fetchJson(`${API_BASE}/market/gold/series`);
    const ctx = document.getElementById('goldPriceChart');
    if (!ctx || !payload || !payload.timestamps) return;
    const labels = payload.timestamps.map(t => new Date(t).toLocaleDateString());
    const smooth = document.getElementById('toggleSmoothLines')?.checked ? 0.35 : 0;
    const data = { labels, datasets: [{ label: (payload.symbol || CONFIG.DEFAULT_SYMBOL_XAU) + ' price', data: payload.prices || [], tension: smooth, fill: false }] };
    if (priceChart) { priceChart.data = data; priceChart.options = chartOptions(); priceChart.update(); }
    else { priceChart = newChart(ctx, { type: 'line', data, options: chartOptions() }); }
  }
  async function loadInsights(){
    try {
      const [structural, midlayer] = await Promise.all([
        fetchJson(`${API_BASE}/api/summary`),
        fetchJson(`${API_BASE}/api/summary`)
      ]);
      const el = document.getElementById('indicatorResult');
      if (el) {
        el.textContent =
`Structural snapshot: ${Array.isArray(structural?.top_factors) ? structural.top_factors.slice(0,5).join(', ') : 'n/a'}
Midlayer regime: ${midlayer?.regime ?? 'n/a'} • Momentum: ${midlayer?.momentum ?? 'n/a'}`;
      }
    } catch(e){ console.warn('Insights load error', e); }
  }
  async function loadFeatureImportance(){
    try {
      const data = await fetchJson(`${API_BASE}/v1/feature-importance`
);
      const ctx = document.getElementById('featureImportanceChart');
      if (!ctx || !data?.features || !data?.importances) return;
      newChart(ctx, { type: 'bar', data: { labels: data.features, datasets: [{ label: 'Importance', data: data.importances }] },
        options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{display:false} } } });
    } catch(e){ console.warn('Feature importance error', e); }
  }
  async function loadBiasInfluence(){
    try {
      const data = await fetchJson(`${API_BASE}/v1/bias/influence`);
      const ctx = document.getElementById('biasInfluenceChart');
      if (!ctx || !data?.labels || !data?.values) return;
      newChart(ctx, { type: 'radar', data: { labels: data.labels, datasets: [{ label: 'Bias Influence', data: data.values, pointRadius:2 }] },
        options: { responsive:true, maintainAspectRatio:false } });
    } catch(e){ console.warn('Bias influence error', e); }
  }
  async function loadAlerts(){
    try {
      const res = await fetchJson(`${API_BASE}/v1/alerts`);
      const ul = document.getElementById('alertsList');
      if (!ul || !Array.isArray(res?.alerts)) return;
      ul.innerHTML='';
      res.alerts.slice(0,8).forEach(a => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `<div><div>${a.title} ${a.severity ? `<span class="badge bg-warning">${a.severity}</span>`:''}</div><small class="text-soft">${a.message||''}</small></div><small class="text-soft">${a.when||''}</small>`;
        ul.appendChild(li);
      });
    } catch(e){ console.warn('Alerts error', e); }
  }
async function renderInsightsFromSummary(API_BASE) {
  try {
    const r = await fetch(`${API_BASE}/api/summary`);
    if (!r.ok) throw new Error('HTTP '+r.status);
    const data = await r.json();

    let text = '';
    if (Array.isArray(data?.signals)) {
      text = 'Selected Indicators Impact:\n' +
        data.signals.map(s => `• ${(s.name||s.label||'signal')}: ${(s.note||s.value||'')}`).join('\n');
    } else if (typeof data?.summary === 'string') {
      text = data.summary;
    } else {
      text = Object.keys(data||{}).slice(0,6)
        .map(k => `• ${k}: ${typeof data[k]==='string'?data[k]:''}`).join('\n');
    }

    const el = document.querySelector('#indicatorResult');
    if (el && text) el.textContent = text;
  } catch(e) {
    console.warn('insights summary adapter:', e.message);
  }
}

// call this during init:
renderInsightsFromSummary(API_BASE);

  // ===== Actions =====
  async function doPredict(){
    const _selInd = (window.__gmIndicators && typeof window.__gmIndicators.selectedIndicators==='function')
      ? window.__gmIndicators.selectedIndicators().join(',')
      : '';

    const sym = (document.getElementById('predictSymbol')?.value || CONFIG.DEFAULT_SYMBOL_XAU).trim();
    try {
      const res = await fetchJson(`${API_BASE}/v1/predict?symbol=${encodeURIComponent(sym)}`);
      const out = document.getElementById('predictResult'); if (out) out.textContent = JSON.stringify(res, null, 2);
      toast('Prediction', `Updated prediction for ${sym}`, 'success');
    } catch(e){ showGlobalError(`Prediction error: ${e.message}`); }
  }
  async function doBiasAnalyze(){
    const _selInd = (window.__gmIndicators && typeof window.__gmIndicators.selectedIndicators==='function')
      ? window.__gmIndicators.selectedIndicators().join(',')
      : '';

    const sym = (document.getElementById('biasSymbol')?.value || CONFIG.DEFAULT_SYMBOL_XAU).trim();
    try {
      const res = await fetchJson(`${API_BASE}/v1/bias?symbol=${encodeURIComponent(sym)}`);
      const out = document.getElementById('biasResult'); if (out) out.textContent = JSON.stringify(res, null, 2);
    } catch(e){ showGlobalError(`Bias analysis error: ${e.message}`); }
  }
  async function loadTrace(){
    const id = document.getElementById('traceIdInput')?.value?.trim();
    if (!id) return;
    try {
      const res = await fetchJson(`${API_BASE}/v1/trace?id=${encodeURIComponent(id)}`);
      const out = document.getElementById('traceResult'); if (out) out.textContent = JSON.stringify(res, null, 2);
    } catch(e){ showGlobalError(`Trace load error: ${e.message}`); }
  }
  async function saveSettings(){
    const style = document.getElementById('defaultTradingStyle')?.value || '';
    const tf = document.getElementById('defaultTimeFrame')?.value || '1h';
    const goal = Number(document.getElementById('dailyGoalSetting')?.value || 0);
    try {
      await fetchJson(`${API_BASE}/v1/settings`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ default_style: style, default_timeframe: tf, daily_goal: goal }) });
      const st = document.getElementById('settingsStatus'); if (st) st.textContent = 'Saved ✓';
      toast('Settings', 'Saved to server', 'success');
    } catch(e){
      const st = document.getElementById('settingsStatus'); if (st) st.textContent = 'Save failed';
      showGlobalError(`Settings error: ${e.message}`);
    }
  }

  // ===== Wire UI =====
  function wireUI(){
    document.getElementById('predictBtn')?.addEventListener('click', doPredict);
    document.getElementById('refreshPredict')?.addEventListener('click', doPredict);
    document.getElementById('biasBtn')?.addEventListener('click', doBiasAnalyze);
    document.getElementById('refreshBias')?.addEventListener('click', doBiasAnalyze);
    document.getElementById('loadTraceBtn')?.addEventListener('click', loadTrace);
    document.getElementById('refreshAlerts')?.addEventListener('click', loadAlerts);
    document.getElementById('saveSettingsBtn')?.addEventListener('click', saveSettings);
    const smoothToggles = [document.getElementById('toggleSmoothLines'), document.getElementById('toggleSmoothLinesSetting')];
    smoothToggles.forEach(t => t && t.addEventListener('change', () => loadSeries()));
  }

  // ===== Init =====
  (async function init(){
    hideGlobalError();
    wireThemeToggle();
    await decideApiBase();
    wireUI();
    await Promise.all([loadHealth(), loadSpot(), loadSeries(), loadInsights(), loadFeatureImportance(), loadBiasInfluence(), loadAlerts()]);
    const y = document.getElementById('yearNow'); if (y) y.textContent = new Date().getFullYear();
    console.log('[GoldMIND] Dashboard ready');
  })();
})();
</script>
<!-- /GoldMIND AI wiring -->

</script>
<!-- /GoldMIND AI walkthrough -->
<!-- Indicator selection wiring (non-invasive) -->
<script nonce="gmnnonce-2025">
(function(){
  // Helpers to locate elements without changing layout
  function qs(sel){return document.querySelector(sel);}
  function qsa(sel){return Array.from(document.querySelectorAll(sel));}

  // Try to find indicator checkboxes: prefer data-indicator, fallback to role and surrounding labels
  function findIndicatorBoxes(){
    let boxes = qsa('input[type="checkbox"][data-indicator]');
    if (boxes.length === 0) boxes = qsa('[data-role="indicator"] input[type="checkbox"]');
    if (boxes.length === 0) boxes = qsa('#indicatorGrid input[type="checkbox"], .indicator-grid input[type="checkbox"]');
    if (boxes.length === 0) boxes = qsa('input[type="checkbox"][name^="indicator"], input[type="checkbox"].indicator');
    return boxes;
  }

  function nameFor(box){
    if (!box) return '';
    return box.getAttribute('data-indicator')
        || box.getAttribute('data-name')
        || (box.id && (document.querySelector('label[for="'+box.id+'"]')?.innerText.trim()))
        || box.name
        || box.closest('.card, .form-check, div')?.querySelector('h5, h6, .title, .card-title')?.innerText?.trim()
        || 'Indicator';
  }

  function selectedIndicators(){
    return findIndicatorBoxes()
      .filter(b => b.checked)
      .map(b => nameFor(b))
      .filter(Boolean);
  }

  function updateImpactPanel(summary){
    const el = qs('#indicatorResult');
    if (!el) return;
    el.textContent = summary;
  }

  function summarize(){
    const sel = selectedIndicators();
    const head = 'Selected: ' + (sel.join(', ') || 'None');
    const bullets = [];
    // very light heuristics; non-binding
    if (sel.some(s => /RSI|MACD|Stochastic/i.test(s))) bullets.push('• Technical momentum signals enabled.');
    if (sel.some(s => /SMA|EMA|Bollinger/i.test(s))) bullets.push('• Trend/MA filters active.');
    if (sel.some(s => /DXY/i.test(s))) bullets.push('• USD correlation considered.');
    if (sel.some(s => /Real Yields|TIPS/i.test(s))) bullets.push('• Real yields impact integrated.');
    if (sel.some(s => /COT/i.test(s))) bullets.push('• Positioning context (COT) applied.');
    if (sel.some(s => /VIX/i.test(s))) bullets.push('• Volatility correlation considered.');
    const body = bullets.length ? ('\n' + bullets.join('\n')) : '';
    return head + body;
  }

  // Buttons: prefer data-action attrs; fallback by text
  function btn(sel, text){
    let el = qs(sel);
    if (el) return el;
    // fallback: find button by its text content
    return Array.from(document.querySelectorAll('button')).find(b => (b.textContent||'').trim().toLowerCase() === text.toLowerCase());
  }

  const selectAllBtn = btn('[data-action="indicators-select-all"]', 'Select All');
  const clearAllBtn  = btn('[data-action="indicators-clear-all"]',  'Clear All');
  const applyBtn     = btn('[data-action="indicators-apply"]',      'Apply Selection');

  function selectAll(){
    findIndicatorBoxes().forEach(b => b.checked = true);
    updateImpactPanel(summarize());
  }
  function clearAll(){
    findIndicatorBoxes().forEach(b => b.checked = false);
    updateImpactPanel(summarize());
  }

  async function applySelection(){
    const sel = selectedIndicators();
    // Update panel immediately
    updateImpactPanel(summarize());
    // Try to persist to backend settings (non-breaking if endpoint absent)
    const API_BASE = window.__GMAI_API_BASE__ || '/api';
    try {
      const resp = await fetch(`${API_BASE}/v1/settings`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ selected_indicators: sel })
      });
      if (!resp.ok) throw new Error('HTTP '+resp.status);
      (window.showNotification||console.log)('Indicators','Selection saved','success');
    } catch(e){
      console.warn('Indicator save skipped:', e.message);
    }
  }

  // Wire events if buttons exist
  if (selectAllBtn) selectAllBtn.addEventListener('click', selectAll);
  if (clearAllBtn)  clearAllBtn.addEventListener('click', clearAll);
  if (applyBtn)     applyBtn.addEventListener('click', applySelection);

  // Also update summary live when any box changes
  findIndicatorBoxes().forEach(b => b.addEventListener('change', () => updateImpactPanel(summarize())));

  // Initialize on load
  updateImpactPanel(summarize());

  // Expose minimal API for debugging
  window.__gmIndicators = { selectedIndicators, summarize, selectAll, clearAll, applySelection };
})();
</script>
<!-- /Indicator selection wiring -->
<script nonce="gmnnonce-2025">
(function(){
  // Upgrade "Focus" info box visibility without changing layout
  // Try common selectors; also add class heuristically when text starts with "Focus:"
  const candidates = [
    '#focusNote', '[data-role="focus-note"]', '.focus-box', '.note-focus', '.alert-info'
  ];
  let applied = false;
  for (const sel of candidates){
    document.querySelectorAll(sel).forEach(el => {
      if (!applied && /\bFocus\b/i.test(el.textContent||'')) {
        el.classList.add('focus-note'); applied = true;
      }
    });
  }
  if (!applied){
    // Heuristic: find a box with "Focus:" at the start
    const all = Array.from(document.querySelectorAll('.card, .alert, .note, div'));
    const hit = all.find(el => /^\s*Focus\s*:/i.test((el.textContent||'').trim()));
    if (hit) hit.classList.add('focus-note');
  }

  // Make "Clear All" button high-contrast in both themes
  function markClearAll(btn){
    if (!btn) return;
    btn.classList.add('btn-contrast');
    btn.setAttribute('data-enhanced','contrast');
  }
  // Prefer data-action, else match by text content
  let clearBtn = document.querySelector('[data-action="indicators-clear-all"]');
  if (!clearBtn){
    clearBtn = Array.from(document.querySelectorAll('button, a.btn'))
      .find(b => (b.textContent||'').trim().toLowerCase() === 'clear all');
  }
  markClearAll(clearBtn);
})();
</script>
<footer>© GoldMIND AI • Foster Wealth Ventures LLC. All rights reserved. • 
  <a href="https://fwvgoldmindai.com/terms" target="_blank">Terms of Use</a> • 
  <a href="https://fwvgoldmindai.com/privacy" target="_blank">Privacy Policy</a> • 
  <a href="https://console.cloud.google.com/run/detail/us-central1/goldmind-api/revisions?project=884387776097" target="_blank">View revision traffic split</a></footer>
<script nonce="gmnnonce-2025">
(function(){
  // Find the "Enhanced Alert Center" header block first to scope the search
  function findAlertCenter(){
    // try explicit id or data-role
    let el = document.querySelector('#alertCenter, [data-role="alert-center"]');
    if (el) return el;
    // fallback: search for the nearest container that has the heading text
    const headings = Array.from(document.querySelectorAll('h2,h3,h4,div,section')).filter(n =>
      /Enhanced\s+Alert\s+Center/i.test((n.textContent||'').trim())
    );
    if (!headings.length) return document;
    // prefer the closest container element
    return headings[0].closest('.card, .panel, section, div') || headings[0].parentElement || document;
  }

  function markTestButton(scope){
    // Prefer explicit selectors first
    let btn = scope.querySelector('#testAlerts, #testAlertBtn, [data-action="alerts-test"]');
    if (!btn){
      // fallback by text content "Test"
      btn = Array.from(scope.querySelectorAll('button, a.btn')).find(b => 
        /^(test)$/i.test((b.textContent||'').trim())
      );
    }
    if (btn) btn.classList.add('btn-test-alert');
  }

  const scope = findAlertCenter();
  markTestButton(scope);
})();
</script>
<script nonce="gmnnonce-2025">
(function() {
  const root = document.documentElement;
  const stored = localStorage.getItem("theme");
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  const theme = stored || (prefersDark ? "dark" : "light");
  root.dataset.theme = theme;

  window.toggleTheme = function() {
    const current = root.dataset.theme === "dark" ? "light" : "dark";
    root.dataset.theme = current;
    localStorage.setItem("theme", current);
  };

  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.querySelector("#themeToggle, [data-action='toggle-theme']");
    if (btn) btn.addEventListener("click", window.toggleTheme);
  });
})();
</script>
<script>
// Global Chart wrapper that safely reuses canvases.
// Accepts either a 2D context, a canvas element, or a canvas id string.
(function(){
  if (!window.Chart) return;
  window.newChart = function(ctxOrElOrId, config) {
    let canvasEl = null;
    let ctx = null;
    if (typeof ctxOrElOrId === "string") {
      canvasEl = document.getElementById(ctxOrElOrId);
      if (!canvasEl) return null;
      ctx = canvasEl.getContext("2d");
    } else if (ctxOrElOrId && typeof ctxOrElOrId.getContext === "function") {
      canvasEl = ctxOrElOrId;
      ctx = canvasEl.getContext("2d");
    } else if (ctxOrElOrId && ctxOrElOrId.canvas) {
      ctx = ctxOrElOrId;
      canvasEl = ctx.canvas;
    }
    if (!canvasEl || !ctx) return null;

    // Destroy any existing chart bound to this canvas
    const prev = (window.Chart && window.Chart.getChart)
      ? window.Chart.getChart(canvasEl)
      : (canvasEl._chart || null);
    if (prev && typeof prev.destroy === "function") {
      try { prev.destroy(); } catch (e) { console.debug("chart destroy:", e); }
    }

    // Create a new chart with the native constructor
    const chart = new window.Chart(ctx, config);
    if (!window.Chart.getChart) canvasEl._chart = chart; // for older Chart.js
    return chart;
  };
})();
</script>
<script nonce="gmnnonce-2025">

(function(){
  const STYLE = `
  .gmwth-overlay{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.7);
    backdrop-filter: saturate(120%) blur(3px);
    z-index: 2147483646;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    animation: fadeIn 0.3s ease-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  .gmwth-card{
    background: var(--card, #1a1a2e); #1a1a2e);
    color: var(--text, #ffffff); #fff);
    max-width: 550px;
    width: 100%;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,.4);
    padding: 0;
    line-height: 1.6;
    position: relative;
    overflow: hidden;
    animation: slideIn 0.4s ease-out;
    border: 2px solid rgba(255, 215, 0, 0.3);
  }
  
  @keyframes slideIn {
    from { 
      opacity: 0;
      transform: translateY(30px) scale(0.95);
    }
    to { 
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  [data-theme="light"] .gmwth-card{
    --card-bg: #ffffff;
    --card-fg: #1a1a2e;
    box-shadow: 0 20px 60px rgba(0,0,0,.15);
  }
  
  .gmwth-header{
    background: linear-gradient(135deg, #4f46e5, #7c3aed);
    padding: 24px;
    position: relative;
    overflow: hidden;
  }
  
  .gmwth-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
    opacity: 0.3;
  }
  
  .gmwth-header-content {
    position: relative;
    z-index: 1;
  }
  
  .gmwth-step-indicator{
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }
  
  .gmwth-step-number{
    background: rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.1rem;
    color: white;
  }
  
  .gmwth-step-info{
    color: rgba(255,255,255,0.9);
    font-size: 0.9rem;
    font-weight: 500;
  }
  
  .gmwth-title{
    font-weight: 800;
    font-size: 1.4rem;
    margin: 0;
    color: white;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .gmwth-icon{
    font-size: 1.8rem;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  .gmwth-body{
    padding: 28px;
  }
  
  .gmwth-description{
    font-size: 1.05rem;
    margin-bottom: 20px;
    color: var(--card-fg);
    opacity: 0.9;
  }
  
  .gmwth-features{
    background: rgba(79, 70, 229, 0.05);
    border: 1px solid rgba(79, 70, 229, 0.2);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 20px;
  }
  
  [data-theme="light"] .gmwth-features{
    background: rgba(79, 70, 229, 0.03);
  }
  
  .gmwth-features h6{
    color: #4f46e5;
    margin-bottom: 10px;
    font-weight: 700;
    font-size: 0.95rem;
  }
  
  .gmwth-feature-list{
    list-style: none;
    margin: 0;
    padding: 0;
  }
  
  .gmwth-feature-item{
    padding: 6px 0;
    color: var(--card-fg);
    opacity: 0.85;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .gmwth-feature-item:before{
    content: "✓";
    color: #10b981;
    font-weight: bold;
    font-size: 0.8rem;
  }
  
  .gmwth-try-this{
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 193, 7, 0.05));
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 20px;
  }
  
  .gmwth-try-this h6{
    color: #ffd700;
    margin-bottom: 8px;
    font-weight: 700;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .gmwth-try-this p{
    margin: 0;
    color: var(--card-fg);
    opacity: 0.9;
    font-size: 0.9rem;
  }
  
  .gmwth-actions{
    border-top: 1px solid rgba(255,255,255,0.1);
    padding: 20px 28px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(0,0,0,0.02);
  }
  
  [data-theme="light"] .gmwth-actions{
    border-top-color: rgba(0,0,0,0.1);
    background: rgba(0,0,0,0.01);
  }
  
  .gmwth-progress-section{
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .gmwth-progress{
    width: 120px;
    height: 6px;
    background: rgba(255,255,255,0.2);
    border-radius: 3px;
    overflow: hidden;
  }
  
  [data-theme="light"] .gmwth-progress{
    background: rgba(0,0,0,0.1);
  }
  
  .gmwth-progress-fill{
    height: 100%;
    background: linear-gradient(90deg, #ffd700, #ffed4a);
    border-radius: 3px;
    transition: width 0.4s ease;
  }
  
  .gmwth-progress-text{
    font-size: 0.85rem;
    color: var(--card-fg);
    opacity: 0.7;
    font-weight: 500;
  }
  
  .gmwth-nav{
    display: flex;
    gap: 10px;
  }
  
  .gmwth-btn{
    border: 0;
    border-radius: 12px;
    padding: 12px 20px;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .gmwth-btn:before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
  }
  
  .gmwth-btn:hover:before {
    left: 100%;
  }
  
  .gmwth-btn.primary{
    background: linear-gradient(135deg, #ffd700, #ffed4a);
    color: #1a1a2e;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
  }
  
  .gmwth-btn.primary:hover{
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
  }
  
  .gmwth-btn.secondary{
    background: rgba(255,255,255,0.1);
    color: var(--card-fg);
    border: 1px solid rgba(255,255,255,0.2);
  }
  
  .gmwth-btn.secondary:hover{
    background: rgba(255,255,255,0.2);
    transform: translateY(-1px);
  }
  
  .gmwth-btn.danger{
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
  }
  
  .gmwth-btn.danger:hover{
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
  }
  
  .gmwth-spot{
    position: relative;
    outline: 4px solid #ffd700;
    border-radius: 16px;
    transition: all 0.4s ease;
    outline-offset: 12px;
    z-index: 9999;
    box-shadow: 
      0 0 0 99999px rgba(0,0,0,0.6),
      0 0 30px rgba(255, 215, 0, 0.5),
      inset 0 0 0 2px rgba(255, 215, 0, 0.3);
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0%, 100% { 
      outline-color: #ffd700;
      box-shadow: 
        0 0 0 99999px rgba(0,0,0,0.6),
        0 0 30px rgba(255, 215, 0, 0.5),
        inset 0 0 0 2px rgba(255, 215, 0, 0.3);
    }
    50% { 
      outline-color: #ffed4a;
      box-shadow: 
        0 0 0 99999px rgba(0,0,0,0.6),
        0 0 40px rgba(255, 215, 0, 0.7),
        inset 0 0 0 2px rgba(255, 215, 0, 0.5);
    }
  }
  
  .gmwth-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.9);
    color: white;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 0.8rem;
    white-space: nowrap;
    margin-bottom: 10px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  
  .gmwth-tooltip:after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid rgba(0,0,0,0.9);
  }
  
  .gmwth-spot:hover .gmwth-tooltip {
    opacity: 1;
  }
  
  @media (max-width: 768px) {
    .gmwth-card {
      max-width: 95%;
      margin: 10px;
    }
    
    .gmwth-header {
      padding: 20px;
    }
    
    .gmwth-body {
      padding: 20px;
    }
    
    .gmwth-actions {
      padding: 16px 20px;
      flex-direction: column;
      gap: 16px;
    }
    
    .gmwth-progress-section {
      order: 2;
    }
    
    .gmwth-nav {
      order: 1;
      width: 100%;
      justify-content: space-between;
    }
    
    .gmwth-btn {
      flex: 1;
      text-align: center;
    }
  }
  `;

  const ADVANCED_STEPS = [
    { 
      sel: "#spotGoldPrice", 
      title: "Multi-Asset Gold Universe",  
      description: "Your gateway to comprehensive gold market analysis across four distinct asset classes.",
      features: [
        "Real-time spot gold prices (XAUUSD) - the foundation of all gold trading",
        "Gold futures contracts (GC) with expiry tracking and volume analysis", 
        "Options market sentiment via implied volatility and put/call ratios",
        "ETF premium/discount analysis for GLD and IAU tracking"
      ],
      tryThis: "Click any asset card to switch analysis focus. Notice how the AI recommendations adapt to different asset characteristics and trading mechanics.",
      icon: "🏆"
    },
    { 
      sel: "#goldPriceChart",   
      title: "Live Market Pulse",    
      description: "Real-time price visualization with multiple data source redundancy and technical analysis integration.",
      features: [
        "Live price updates every 30 seconds during market hours",
        "Multi-source data pipeline: Twelve Data → Alpha Vantage → Yahoo Finance",
        "Integrated technical indicators overlay capability",
        "Historical pattern recognition for trend analysis"
      ],
      tryThis: "Toggle the 'Smooth lines' option to see how different chart styles can reveal or hide market patterns. Watch for volume spikes that often precede major moves.",
      icon: "📈"
    },
    { 
      sel: "#alertsList",       
      title: "Intelligent Alert Ecosystem",           
      description: "AI-powered notification system that learns your trading patterns and filters noise from signal.",
      features: [
        "Price breakout detection using dynamic support/resistance levels",
        "Volume anomaly alerts when trading exceeds statistical norms",
        "Economic calendar integration for Fed announcements and data releases",
        "Smart notification batching to prevent alert fatigue"
      ],
      tryThis: "Click 'Test' to experience the alert system, then enable browser notifications. Set your price change threshold in Settings to customize sensitivity.",
      icon: "🚨"
    },
    { 
      sel: "#resolveBtn",       
      title: "Neural Decision Architecture",    
      description: "Advanced AI engine combining machine learning, risk management, and behavioral finance for personalized trading insights.",
      features: [
        "Multi-factor model weighing 50+ market variables simultaneously",
        "Personal risk tolerance integration with Kelly Criterion position sizing",
        "Behavioral bias detection and mitigation strategies",
        "Real-time confidence scoring with transparent reasoning chains"
      ],
      tryThis: "Configure your risk tolerance and investment amount, then generate a recommendation. Study the reasoning section to understand how the AI weighs different factors.",
      icon: "🧠"
    },
    { 
      sel: "#indicatorGrid",    
      title: "Adaptive Technical Analysis",        
      description: "Customize which technical indicators influence AI decisions, creating your personalized analysis framework.",
      features: [
        "Traditional momentum indicators: RSI, MACD, Stochastic oscillators",
        "Gold-specific correlations: DXY inverse relationship, real yields impact",
        "Market structure analysis: COT positioning, VIX fear gauge correlation",
        "Dynamic indicator weighting based on current market regime"
      ],
      tryThis: "Start with default selections, then experiment with gold-specific indicators like DXY correlation. Notice how different combinations change AI confidence levels.",
      icon: "🔧"
    },
    { 
      sel: "#predictBtn",       
      title: "LSTM Neural Forecasting",    
      description: "Deep learning price predictions using Long Short-Term Memory networks trained on decades of gold market data.",
      features: [
        "1, 7, and 30-day price forecasts with confidence intervals",
        "Feature importance analysis showing key prediction drivers",
        "Model performance tracking with rolling accuracy metrics",
        "Ensemble predictions combining multiple neural network architectures"
      ],
      tryThis: "Generate predictions for different symbols (try XAUUSD, GLD, or GC). Compare confidence levels and note how volatility affects prediction accuracy.",
      icon: "🔮"
    },
    { 
      sel: "#biasInfluenceChart",    
      title: "Behavioral Finance Guard",        
      description: "Psychological bias detection system designed to improve decision-making by identifying cognitive traps.",
      features: [
        "Real-time bias scoring across six key psychological dimensions",
        "Confirmation bias detection when seeking supporting evidence",
        "Loss aversion analysis affecting position sizing decisions",
        "Recency bias alerts when overweighting recent market events"
      ],
      tryThis: "Watch how the bias radar changes as you interact with different features. High scores indicate areas where psychology might be affecting your judgment.",
      icon: "🧭"
    },
    { 
      sel: "#feedbackBtn",      
      title: "Continuous Learning Engine", 
      description: "Machine learning system that evolves based on real trading outcomes, improving recommendations over time.",
      features: [
        "Trade outcome tracking with performance attribution analysis",
        "Recommendation accuracy measurement and model retraining",
        "Personal trading pattern recognition and adaptation",
        "Collective intelligence from anonymized user feedback integration"
      ],
      tryThis: "After following any recommendation, submit feedback about the outcome. This trains the AI to better match your trading style and risk preferences.",
      icon: "📊"
    }
  ];

  function $(q){ return document.querySelector(q); }
  
  function ensureStyle(){
    if (document.getElementById("gmwth-style")) return;
    const s = document.createElement("style");
    s.nonce = 'gmnnonce-2025';
    s.id="gmwth-style"; 
    s.textContent = STYLE;
    document.head.appendChild(s);
  }

  function highlight(sel){
    const el = $(sel);
    if (!el) return null;
    
    // Add tooltip
    const tooltip = document.createElement('div');
    tooltip.className = 'gmwth-tooltip';
    tooltip.textContent = 'This is the feature being explained';
    el.style.position = 'relative';
    el.appendChild(tooltip);
    
    el.classList.add("gmwth-spot");
    
    // Smooth scroll with offset
    const rect = el.getBoundingClientRect();
    const offset = window.innerHeight / 2 - rect.height / 2;
    const targetY = window.pageYOffset + rect.top - offset;
    
    window.scrollTo({
      top: Math.max(0, targetY),
      behavior: 'smooth'
    });
    
    return el;
  }

  function removeHighlight(sel){
    const el = $(sel);
    if (!el) return;
    el.classList.remove("gmwth-spot");
    
    // Remove tooltip
    const tooltip = el.querySelector('.gmwth-tooltip');
    if (tooltip) tooltip.remove();
  }

  function makeOverlay(stepIdx){
    const step = ADVANCED_STEPS[stepIdx];
    const progress = ((stepIdx + 1) / ADVANCED_STEPS.length) * 100;
    
    const overlay = document.createElement("div");
    overlay.className = "gmwth-overlay";
    overlay.innerHTML = `
      <div class="gmwth-card" role="dialog" aria-modal="true">
        <div class="gmwth-header">
          <div class="gmwth-header-content">
            <div class="gmwth-step-indicator">
              <div class="gmwth-step-number">${stepIdx + 1}</div>
              <div class="gmwth-step-info">Step ${stepIdx + 1} of ${ADVANCED_STEPS.length} • GoldMIND AI Tour</div>
            </div>
            <h3 class="gmwth-title">
              <span class="gmwth-icon">${step.icon}</span>
              ${step.title}
            </h3>
          </div>
        </div>
        
        <div class="gmwth-body">
          <div class="gmwth-description">${step.description}</div>
          
          <div class="gmwth-features">
            <h6>🔍 Key Capabilities:</h6>
            <ul class="gmwth-feature-list">
              ${step.features.map(feature => `<li class="gmwth-feature-item">${feature}</li>`).join('')}
            </ul>
          </div>
          
          <div class="gmwth-try-this">
            <h6>💡 Try This Now:</h6>
            <p>${step.tryThis}</p>
          </div>
        </div>
        
        <div class="gmwth-actions">
          <div class="gmwth-progress-section">
            <div class="gmwth-progress">
              <div class="gmwth-progress-fill" style="width: ${progress}%"></div>
            </div>
            <span class="gmwth-progress-text">${Math.round(progress)}% Complete</span>
          </div>
          
          <div class="gmwth-nav">
            <button class="gmwth-btn danger" data-act="close">Skip Tour</button>
            ${stepIdx > 0 ? '<button class="gmwth-btn secondary" data-act="prev">Previous</button>' : ''}
            ${stepIdx < ADVANCED_STEPS.length - 1 ? 
              '<button class="gmwth-btn primary" data-act="next">Continue →</button>' : 
              '<button class="gmwth-btn primary" data-act="done">Complete Tour ✓</button>'
            }
          </div>
        </div>
      </div>`;
    return overlay;
  }

  function startWalkthrough(){
    ensureStyle();
    let idx = 0, overlay;

    function show(i){
      // Clear previous
      if (overlay) overlay.remove();
      if (ADVANCED_STEPS[idx]) removeHighlight(ADVANCED_STEPS[idx].sel);
      
      idx = i;
      
      // Skip steps whose element isn't present
      while (idx < ADVANCED_STEPS.length && !document.querySelector(ADVANCED_STEPS[idx].sel)) {
        idx++;
      }
      
      if (idx >= ADVANCED_STEPS.length){
        showCompletionMessage();
        return;
      }
      
      const spot = highlight(ADVANCED_STEPS[idx].sel);
      overlay = makeOverlay(idx);
      document.body.appendChild(overlay);
      
      // Add click handlers
      overlay.addEventListener('click', (e)=>{
        const act = e.target?.getAttribute('data-act');
        if (act === 'close'){
          overlay.remove(); 
          removeHighlight(ADVANCED_STEPS[idx].sel);
          showSkipMessage();
        } else if (act === 'done'){
          overlay.remove(); 
          removeHighlight(ADVANCED_STEPS[idx].sel);
          showCompletionMessage();
        } else if (act === 'next'){ 
          show(idx + 1); 
        } else if (act === 'prev'){ 
          let p = idx - 1;
          while (p >= 0 && !document.querySelector(ADVANCED_STEPS[p].sel)) p--;
          if (p >= 0) show(p);
        }
      });

      // Keyboard navigation
      const handleKeys = (e) => {
        if (e.key === 'Escape') {
          overlay.remove();
          removeHighlight(ADVANCED_STEPS[idx].sel);
          document.removeEventListener('keydown', handleKeys);
        } else if (e.key === 'ArrowRight' && idx < ADVANCED_STEPS.length - 1) {
          show(idx + 1);
        } else if (e.key === 'ArrowLeft' && idx > 0) {
          let p = idx - 1;
          while (p >= 0 && !document.querySelector(ADVANCED_STEPS[p].sel)) p--;
          if (p >= 0) show(p);
        }
      };
      document.addEventListener('keydown', handleKeys);
    }
    
    show(0);
  }

  function showCompletionMessage(){
    // Create completion celebration
    const completionOverlay = document.createElement('div');
    completionOverlay.className = 'gmwth-overlay';
    completionOverlay.innerHTML = `
      <div class="gmwth-card">
        <div class="gmwth-header">
          <div class="gmwth-header-content">
            <h3 class="gmwth-title">
              <span class="gmwth-icon">🎉</span>
              Tour Complete!
            </h3>
          </div>
        </div>
        <div class="gmwth-body">
          <div class="gmwth-description">
            Congratulations! You've mastered the GoldMIND AI platform. You're now equipped to:
          </div>
          <div class="gmwth-features">
            <h6>✅ Your New Capabilities:</h6>
            <ul class="gmwth-feature-list">
              <li class="gmwth-feature-item">Analyze gold markets across multiple asset classes</li>
              <li class="gmwth-feature-item">Generate AI-powered trading recommendations</li>
              <li class="gmwth-feature-item">Customize technical analysis to your style</li>
              <li class="gmwth-feature-item">Manage risk with advanced position sizing</li>
              <li class="gmwth-feature-item">Avoid psychological trading pitfalls</li>
            </ul>
          </div>
          <div class="gmwth-try-this">
            <h6>🚀 Ready to Trade?</h6>
            <p>Start by configuring your risk tolerance in the AI Decision Engine, then generate your first personalized recommendation!</p>
          </div>
        </div>
        <div class="gmwth-actions">
          <div></div>
          <button class="gmwth-btn primary" data-act="finish">Start Trading →</button>
        </div>
      </div>
    `;
    
    document.body.appendChild(completionOverlay);
    
    completionOverlay.addEventListener('click', (e) => {
      if (e.target.getAttribute('data-act') === 'finish') {
        completionOverlay.remove();
        // Focus on the AI Decision Engine
        const engine = document.getElementById('resolveUserId');
        if (engine) {
          engine.scrollIntoView({ behavior: 'smooth', block: 'center' });
          engine.focus();
        }
      }
    });
    
    // Auto-close after 10 seconds
    setTimeout(() => {
      if (completionOverlay.parentElement) {
        completionOverlay.remove();
      }
    }, 10000);
    
    if (window.showSuccessNotification) {
      window.showSuccessNotification('GoldMIND AI tour completed! You\'re ready to start advanced gold trading analysis.');
    }
  }

  function showSkipMessage(){
    if (window.showNotification) {
      window.showNotification('Tour skipped', 'You can restart the tour anytime from the Help menu.', 'info');
    }
  }

  function wireWalkButton(){
    const WALK_IDS = ["walkthroughBtn","helpBtn","startWalkthrough","helpWalkthrough","startTour","helpButton"];
    let wired = false;
    
    WALK_IDS.forEach(id => {
      const btn = document.getElementById(id);
      if (btn && !wired){
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          startWalkthrough();
        });
        wired = true;
      }
    });
    
    document.querySelectorAll('[data-action="walkthrough"]').forEach(el => {
      el.addEventListener('click', (e) => {
        e.preventDefault();
        startWalkthrough();
      });
      wired = true;
    });
  }

  // Initialize
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', wireWalkButton);
  } else {
    wireWalkButton();
  }

  // Expose for manual triggering
  window.startGoldMindTour = startWalkthrough;
})();

</script>
<script defer="" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// GoldMIND Walkthrough — Singleton 1.0.3
// Fixes: robust button clicks (use closest()), ultra-high z-index, kill conflicts, auto-wire.
(function(){
  function nuke(){
    [
      '.gm-wt-overlay','.gm-wt-card','#gm-wt-style','#gm-fab',
      '.modal-backdrop','.shepherd-modal-overlay-container','.shepherd-element',
      '#walkthrough-tooltip','#walkthrough-overlay','.tour-overlay','.tour-tooltip',
      '.introjs-overlay','.introjs-helperLayer','.driver-overlay','.driver-popover',
      '#keyCapabilities','#keyCapabilitiesPanel','.key-capabilities','.walkthrough-panel',
      '#TourPanel','#tourPanel','#startWalkthroughPanel','.feature-guide','#featureGuide'
    ].forEach(sel=>document.querySelectorAll(sel).forEach(n=>n.remove()));
    [...document.querySelectorAll('h1,h2,h3,.modal-title,.card-title,strong,header,section,div')]
      .filter(el=>/key\s*capabilities/i.test(el.textContent||''))
      .forEach(el => (el.closest('.modal,.offcanvas,.drawer,.panel,.sheet,.card,section,article,div')||el).remove());
    document.body.classList.remove('modal-open');
    document.body.style.removeProperty('overflow');
    document.body.style.removeProperty('padding-right');
  }

  // styles (very high z-index, 40/30vh card body)
  if(!document.getElementById('gm-wt-style')){
    const css=document.createElement('style'); css.id='gm-wt-style';
    css.textContent = `
      .gm-wt-overlay{position:fixed;inset:0;z-index:2147483000;pointer-events:none;
        background:radial-gradient(220px 220px at var(--gm-x,50%) var(--gm-y,30%),
        transparent 0,transparent 28%,rgba(0,0,0,.55) 32%,rgba(0,0,0,.65) 100%);}
      .gm-wt-card{position:fixed;z-index:2147483001;max-width:560px;width:min(92vw,560px);
        background:var(--card,#111827);color:var(--text,#e5e7eb);
        border:1px solid #27324b;border-radius:16px;box-shadow:0 20px 50px rgba(0,0,0,.45);
        pointer-events:auto;}
      .gm-wt-header{font-weight:800;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.08);}
      .gm-wt-body{padding:10px 16px;max-height:40vh;overflow:auto;}
      @media (max-height:740px){.gm-wt-body{max-height:30vh;}}
      .gm-wt-actions{display:flex;gap:8px;justify-content:flex-end;padding:10px 16px;border-top:1px solid rgba(255,255,255,.08);}
      .gm-btn{border-radius:10px;padding:.45rem .9rem;font-weight:700;border:2px solid transparent;cursor:pointer;}
      .gm-btn-primary{background:linear-gradient(135deg,#ffd700,#e6c200);color:#141414;}
      .gm-btn-secondary{background:transparent;color:inherit;border-color:#6c757d;}
    `;
    document.head.appendChild(css);
  }

  const S = { // flexible selectors
    spot:'#spotGoldPrice,[data-wt="spot-price"],.spot-price,[data-spot="xauusd"]',
    chart:'#goldPriceChart,canvas#goldPriceChart,[data-wt="gold-chart"],canvas[data-chart="gold"]',
    alerts:'#alertsList,[data-wt="alerts"]',
    help:'#helpBtn,[data-wt="help-btn"]',
    settings:'[data-bs-target="#settingsPanel"],#settingsBtn,[data-wt="settings-btn"]'
  };
  const STEPS=[
    { sel:S.spot, title:'Live Spot Price', html:'Live XAUUSD spot (Yahoo fallback). Use the refresh icon to update.' },
    { sel:S.chart, title:'Price Performance', html:'Inspect trend & volatility. Toggle smoothing/period to explore.' },
    { sel:S.alerts, title:'Enhanced Alert Center', html:'Configure price/breakout/risk alerts with browser & sound notifications.' },
    { sel:S.help, title:'Help & Guide', html:'Open Help anytime for explanations & FAQs.' },
    { sel:S.settings, title:'Settings', html:'Tune chart smoothing, defaults, thresholds & theme.' },
  ];
  const $=(s,r=document)=>r.querySelector(s);

  const State={overlay:null,card:null,tEl:null,bEl:null,i:0,running:false};

  function buildDOM(){
    const overlay=document.createElement('div'); overlay.className='gm-wt-overlay';
    const card=document.createElement('div'); card.className='gm-wt-card';
    card.innerHTML=`
      <div class="gm-wt-header"><span id="gm-t"></span></div>
      <div class="gm-wt-body"><div id="gm-b"></div></div>
      <div class="gm-wt-actions">
        <button class="gm-btn gm-btn-secondary" id="gm-close" type="button"><span>Close</span></button>
        <button class="gm-btn gm-btn-primary"  id="gm-next"  type="button"><span>Next</span></button>
      </div>`;
    document.body.appendChild(overlay); document.body.appendChild(card);
    State.overlay=overlay; State.card=card; State.tEl=card.querySelector('#gm-t'); State.bEl=card.querySelector('#gm-b');

    // robust click: accept clicks on child spans/icons via closest()
    card.addEventListener('click', (e)=>{
      const nextBtn = e.target.closest('#gm-next');
      const closeBtn= e.target.closest('#gm-close');
      if(nextBtn){ e.stopImmediatePropagation(); e.preventDefault(); next(); }
      if(closeBtn){ e.stopImmediatePropagation(); e.preventDefault(); stop(); }
    }, true);

    // keyboard nav
    document.addEventListener('keydown',(e)=>{
      if(!State.running) return;
      if(e.key==='Escape') { e.preventDefault(); stop(); }
      if(e.key==='ArrowRight') { e.preventDefault(); next(); }
      if(e.key==='ArrowLeft')  { e.preventDefault(); prev(); }
    });
    window.addEventListener('resize', ()=>{ if(State.running) reflow(); }, {passive:true});
  }
  function ensureDOM(){ if(!State.card || !document.body.contains(State.card)) buildDOM(); }

  function place(t){
    const r=t.getBoundingClientRect(), m=12, cw=State.card.offsetWidth||360, ch=State.card.offsetHeight||200;
    let top=r.bottom+m, left=r.left;
    left=Math.max(m,Math.min(left,window.innerWidth-cw-m));
    top =Math.max(m,Math.min(top ,window.innerHeight-ch-m));
    left+=window.scrollX; top+=window.scrollY;
    State.card.style.left=left+'px'; State.card.style.top=top+'px';
    State.overlay.style.setProperty('--gm-x',(r.left+r.width/2)+'px');
    State.overlay.style.setProperty('--gm-y',(r.top +r.height/2)+'px');
  }
  function show(k,reflow=false){
    if(k<0||k>=STEPS.length){ stop(); return; }
    const s=STEPS[k], t=$(s.sel); if(!t){ next(); return; }
    if(!reflow){
      State.tEl.textContent=s.title; State.bEl.innerHTML=s.html;
      t.scrollIntoView({behavior:'smooth',block:'center',inline:'center'});
    }
    requestAnimationFrame(()=>place(t));
    State.overlay.style.display='block'; State.card.style.display='block'; State.running=true;
  }
  function reflow(){ const s=STEPS[State.i], t=$(s.sel); if(t) place(t); }
  function start(){ nuke(); ensureDOM(); State.i=0; show(State.i); }
  function next(){ State.i++; show(State.i); }
  function prev(){ State.i--; show(State.i); }
  function stop(){ if(!State.running) return; State.overlay.style.display='none'; State.card.style.display='none'; State.running=false; }

  // Expose
  window.WT = { start, next, prev, stop, version:'singleton-1.0.3', check: () => STEPS.map((s,i)=>({i,title:s.title,found:!!$(s.sel)})) };

  // Auto-wire the top-right button or add a small FAB if missing
  function wireBtn(){
    const btn=document.getElementById('walkthroughBtn');
    if(btn){ btn.removeAttribute('onclick'); btn.onclick=null; btn.addEventListener('click', ()=>start(), {passive:true}); }
    else{
      if(!document.getElementById('gm-fab')){
        const fab=document.createElement('button'); fab.id='gm-fab'; fab.textContent='Start Tour';
        fab.style.cssText='position:fixed;right:14px;top:14px;z-index:2147483002;background:#111827;color:#e5e7eb;border:1px solid #334155;border-radius:999px;padding:.45rem .75rem;font-weight:700;box-shadow:0 8px 30px rgba(0,0,0,.35)';
        fab.addEventListener('click', ()=>start()); document.body.appendChild(fab);
      }
    }
  }
  document.addEventListener('DOMContentLoaded', wireBtn);https://github.gallerycdn.vsassets.io/extensions/github/copilot-chat/0.31.5/1759771009685/Microsoft.VisualStudio.Services.Icons.Default

  // Optional: auto-start for validation if ?tour=1
  if(new URLSearchParams(location.search).get('tour')==='1'){
    document.addEventListener('DOMContentLoaded', ()=>start());
  }
})();
</script>
</body>
</html>
